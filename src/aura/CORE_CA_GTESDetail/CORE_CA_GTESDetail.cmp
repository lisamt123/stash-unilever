<!--
  Component Name: Core_CA_GTESDetail
  Author : Mindtree
  Date: 03 June 2016
  Requirement/Description: GTES Detail Section of approval app. 
-->
<aura:component controller="Core_CA_ApprovalsController">
    <!--<aura:handler name="init" value="{!this}" action="{!c.doInit}" />-->
    <ltng:require styles="/resource/ApprovalsLightning,/resource/Lightning_designing_style/assets/styles/salesforce-lightning-design-system.min.css,/resource/Lightning_designing_style/assets/fonts/" afterScriptsLoaded="{!c.doInit}"/>
    <aura:attribute name="ApprovalDetail" type="Core_CA_WrapperUtility.RequestDetailResponseAribaGTES[]"/>
    <aura:attribute name="RequestId" type="String"/>
    <aura:attribute name="ApproverId" type="String"/>
    <aura:attribute name="Sourcesystem" type="String"/>
    <aura:attribute name="sourcePage" type="String"/>
    <aura:attribute name="isDetail" type="Boolean" default="true"/>
    <aura:attribute name="isFeed" type="Boolean" />
    <aura:attribute name="filterValue" type="string" />
    <aura:attribute name="PreTripDetails" type="Core_CA_WrapperUtility.RequestDetailResponseAribaGTES[]" />
    <aura:handler event="c:CORE_CA_FeedbackEvent" action="{!c.gotoApp}"/>
    <aura:attribute name="showApprove" type="Boolean" default="true"/>
    <aura:attribute name="showReject" type="Boolean" default="true"/>
    
    <style>      
        .homePageHeader{
        background:#4F6A92;
        height: 150px;
        padding-top: 13px;
        }
        .headerBarIconStyle{
        width: 40px;
        margin-top: -9px;
        }
        .backIconStyle{
        width: 36px;
        margin-top: 5px;
        padding-left: 13px;
        margin-bottom: 5px;
        }
        .hiddenClass{
        color: red;
        display: none;
        }
                .action_bar{
        background: #fff;
        height: 50px;
        Position: fixed;
        bottom: 0;
        width: 100%;
        }
        .icons{ 
        width: 20%;
        text-align:center;
        float: left;
        } 
        .alignCenter{
        text-align:center;       
        }
        .actionBarWidth {
        width: 100%;
        }
        .img{    
        width: 40px;
        }
        .actionBarHeight {
        padding-top: 5px;
        padding-bottom: 5px;
        text-align:center; 
        }
    </style>
    <!-- Back button Functionlaity-->
    <div>
        <div onclick="{!c.goToHomePage}" class="topBackBar">
            <img src="/resource/Lightning_designing_style/assets/icons/utility/back_60.png" alt="Back" class="backIconStyle" />
        </div>
    </div>
    <!-- Detail Header--> 
    <div class="homePageHeader">
        <div class="defaultLeftSpace" style="text-align:center;">
            <br/>
            <img src="/resource/ApprovalsLightning/images/Approvals_Logo.svg" alt="Approvals_Logo" class="headerBarIconStyle" />&nbsp;&nbsp;
            <br/>
            <div class="slds-text-heading--medium clarity-header">
                <aura:iteration items="{!v.ApprovalDetail}" var="detailData">
                    {!detailData.RequestName}
                    <br/>
                    <div class="slds-text-heading--small preparedby">{!detailData.RequestedBy}</div> <div class="slds-text-heading--small currency">{!detailData.Currencies} {!detailData.TotalAmount}</div>                    
                </aura:iteration>                
            </div>
        </div>
    </div>
    <!-- Chatter Navigation Error -->
    <div>
        <aura:iteration items="{!v.ApprovalDetail}" var="detailData">
            <aura:if isTrue="{!detailData.accessStatus == False}">
                Insufficient Previleges
            </aura:if>
        </aura:iteration>
    </div>
    <!-- Detail Main Content --> 
    <aura:if isTrue="{!v.accessStatus}">
    <div>
        <!-- Tab-->
        <div class="slds-tabs--default">
            <ul class="slds-tabs--default__nav pending-header" role="tablist">
                <li class="slds-tabs--default__item  pending" title="Item Two"
                    role="presentation" onclick="{!c.NavigateToDetail}"><a class="slds-tabs--default__link closed-text" href="" role="tab" tabindex="-1" aria-selected="false" aria-controls="tab-default-2" id="tab-default-2__item">{!$Label.c.CORE_LBL_DETAILS}</a></li>
                <li class="slds-tabs--default__item closed " title="Item Three"
                    role="presentation" onclick="{!c.NavigateToFeed}"><a class="slds-tabs--default__link closed-text" href="" role="tab" tabindex="-1" aria-selected="false" aria-controls="tab-default-3" id="tab-default-3__item">{!$Label.c.CORE_LBL_FEED}</a></li>
            </ul>
        </div>
        
        <aura:iteration items="{!v.ApprovalDetail}" var="detailData">
            
                <!--Detail-->
                <aura:if isTrue="{!v.isDetail}">
                    <div class="ProjectInformationSection">
                        <div class="slds-section__title sectionTitle" id="claim" onclick="{!c.showHide}">
                            {!$Label.c.CORE_LBL_DETAIL_CLAIM_DETAILS}
                        </div>
                        <hr></hr>
                        <div class="DetailSectionTable" id="claim1">
                            <div>
                                <div class="slds-text-heading--small DetailHeading">{!$Label.c.CORE_LBL_EXP_DETAIL_REQUEST_ID}</div>
                            </div>
                            <div>
                                <div class="slds-text-body--regular DetailData">{!detailData.RequestName}</div>
                            </div>
                            <div>
                                <div class="slds-text-heading--small DetailHeading splitAcc">{!$Label.c.CORE_LBL_STATUS}</div>
                            </div>
                            <div>
                                <div class="slds-text-body--regular DetailData fieldValueAlign">{!detailData.RequestStatus}</div>
                            </div>
                            <div>
                                <div class="slds-text-heading--small DetailHeading">{!$Label.c.CORE_LBL_EXP_DETAIL_REQUESTED_BY}</div>
                            </div>
                            <div>
                                <div class="slds-text-body--regular DetailData">{!detailData.RequestedBy}</div>
                            </div>
                            <div>
                                <div class="slds-text-heading--small DetailHeading fieldAlign">{!$Label.c.CORE_LBL_EXP_DETAIL_REPORT_NAME}</div>
                            </div>
                            <div>
                                <div class="slds-text-body--regular DetailData fieldValueAlign">{!detailData.ReportName}</div>
                            </div>
                            <div>
                                <div class="slds-text-heading--small DetailHeading ">{!$Label.c.CORE_LBL_EXP_DETAIL_PURPOSE}</div>
                            </div>
                            <div>
                                <div class="slds-text-body--regular DetailData" style="width=100%">{!detailData.Purpose}</div>
                            </div>
                        </div>
                        
                    </div>
                    
                    <div class="ProjectInformationSection">
                        <div class="slds-section__title sectionTitle" id="amount" onclick="{!c.showHide}">
                            {!$Label.c.CORE_LBL_EXP_LINEITEM_DETAIL_AMOUNT} &amp; {!$Label.c.CORE_LBL_INV_COST_CENTER}
                        </div>
                        <hr></hr>
                        <div class="DetailSectionTable" id="amount1">
                            <div>
                                <div class="slds-text-heading--small DetailHeading">{!$Label.c.CORE_LBL_EXP_DETAIL_TOTAL_AMOUNT}</div>
                            </div>
                            <div>
                                <div class="slds-text-body--regular DetailData">{!detailData.TotalAmount}</div>
                            </div>
                            <div>
                                <div class="slds-text-heading--small DetailHeading fieldAlign">{!$Label.c.CORE_LBL_EXP_DETAIL_CURRENCY}</div>
                            </div>
                            <div>
                                <div class="slds-text-body--regular DetailData fieldValueAlign">{!detailData.Currencies}</div>
                            </div>
                            <div>
                                <div class="slds-text-heading--small DetailHeading">{!$Label.c.CORE_LBL_EXP_DETAIL_ADVANCE_AMOUNT}</div>
                            </div>
                            <div>
                                <div class="slds-text-body--regular DetailData">{!detailData.AdvanceAmount}</div>
                            </div>
                            <div>
                                <div class="slds-text-heading--small DetailHeading fieldAlign">{!$Label.c.CORE_LBL_EXP_DETAIL_NET_AMOUNT}</div>
                            </div>
                            <div>
                                <div class="slds-text-body--regular DetailData fieldValueAlign">{!detailData.NetAmount}</div>
                            </div>
                            <div>
                                <div class="slds-text-heading--small DetailHeading ">{!$Label.c.CORE_LBL_EXP_DETAIL_NON_REIMBURSABLE}</div>
                            </div>
                            <div>
                                <div class="slds-text-body--regular DetailData">{!detailData.NonReimbursable}</div>
                            </div>
                        </div>
                        
                    </div>
                    <div class="ApprovalHistorySection">
                        <div class="slds-section__title sectionTitle" id="line" onclick="{!c.showHide}"> {!$Label.c.CORE_LBL_EXP_DETAIL_LINE_ITEMS}</div><hr></hr>
                        <div id="line1">
                        <aura:iteration items="{!detailData.LineItems}" var="lineItem" indexVar="indx">
                            <a class="slds-section__title textHighlight" data-index="{!indx}" onclick="{!c.goToLineItemDetail}">
                                {!lineItem.ItemName}
                            </a><hr></hr>
                            <a class="slds-section__title textLineItem" data-index="{!indx}" onclick="{!c.goToLineItemDetail}">
                                            {!lineItem.Currencies} {!lineItem.Amount}
                                        </a>
                        </aura:iteration>
                            </div>
                    </div>
                    <div class="ProjectInformationSection">
                        <div class="slds-section__title sectionTitle" id="claimexp" onclick="{!c.showHide}">
                            {!$Label.c.CORE_LBL_EXP_DETAIL_CLAIM_EXCEPTIONS}
                        </div>
                        <hr></hr>
                        <div class="DetailSectionTable" id="claimexp1">
                            <div>
                                <div class="slds-text-body--regular fieldValueRichTextFormate">{!detailData.ClaimExceptions}</div>
                            </div>
                        </div>
                        
                    </div>
                    <div class="ProjectInformationSection">
                        <div class="slds-section__title sectionTitle" id="preTrip" onclick="{!c.showHide}">
                            {!$Label.c.CORE_LBL_EXP_DETAIL_PRE_TRIP_DETAILS}
                        </div>
                        <hr></hr>
                        <aura:iteration items="{!v.PreTripDetails}" var="PreTripDetails">
                            <div class="DetailSectionTable" id="preTrip1">
                                <div>
                                    <div class="slds-text-heading--small DetailHeading ">{!$Label.c.CORE_LBL_EXP_DETAIL_PRE_TRIP_ID} </div>
                                </div>
                                <div>
                                    <div class="slds-text-body--regular DetailData">{!PreTripDetails.Id}</div>
                                </div>
                                <div>
                                    <div class="slds-text-heading--small DetailHeading ">{!$Label.c.CORE_LBL_EXP_DETAIL_PRE_TRIP_PASSENGER_INFO} </div>
                                </div>
                                <div>
                                    <div class="slds-text-body--regular DetailData">{!PreTripDetails.PassengerInfo}</div>
                                </div>
                                <div>
                                    <div class="slds-text-heading--small DetailHeading ">{!$Label.c.CORE_LBL_EXP_DETAIL_PRE_TRIP_LOCATION_DETAILS}</div>
                                </div>
                                <div>
                                    <div class="slds-text-body--regular DetailData">{!PreTripDetails.LocationDetails}</div>
                                </div>
                            </div>
                        </aura:iteration>
                    </div>
                    
                    <div class="ProjectInformationSection">
                        <div class="slds-section__title sectionTitle" id="comments" onclick="{!c.showHide}">
                            {!$Label.c.CORE_LBL_EXP_LINEITEM_DETAIL_COMMENTS}
                        </div>
                        <hr></hr>
                        <div class="DetailSectionTable" id="comments1">
                            <div>
                                <div class="slds-text-body--regular DetailData">{!detailData.Comments}</div>
                            </div>
                        </div>
                    </div>
                    <div class="ApprovalHistorySection">
                        <div class="slds-section__title sectionTitle" id="approvalHist" onclick="{!c.showHide}"> {!$Label.c.CORE_LBL_EXP_DETAIL_APPROVAL_HISTORY}</div><hr></hr>
                        <aura:iteration items="{!detailData.ApprovalHistory}" var="appHistoryData">
                            <div class="DetailSectionTable" id="approvalHist1">
                                <div>
                                    <div class="slds-text-body--regular DetailData">{!appHistoryData.ApproverName}</div>
                                </div>
                                <div>
                                    <div class="slds-text-body--regular DetailData">{!appHistoryData.AribaRole}</div>
                                </div>
                                <div>
                                    <div class="slds-text-body--regular DetailData">{!appHistoryData.ApproverAction}</div>
                                </div>
                            </div>
                            <br/>
                        </aura:iteration>
                    </div>
                </aura:if> 
                <!-- Feed Tab -->
                <aura:if isTrue="{!v.isFeed}">  
                    <!--<div class="hiddenClass"> {!detailData.RequestId} </div>
                    <c:ChatterPublisherCmp subjectId="{!detailData.RequestId}" feedType="Record"/>  
                    <c:ChatterFeedCmp subjectId="{!detailData.RequestId}" feedType="Record"/> -->
                </aura:if>
            
            <!--Action Bar-->
            <div style="position:fixed; bottom:0;">
            <div class="action_bar">
                <div class="actionBarHeight">                  
                    <table class="actionBarWidth">
                        <tr class="alignCenter"> 
                            <td class="alignCenter" onclick="{!c.gotoFeedback}"><img class="img" src="/resource/ApprovalsLightning/images/feedbackIcon.svg"/></td>
                            <td class="alignCenter"><img class="img" src="/resource/ApprovalsLightning/images/Comment.svg"/></td>
                            <aura:if isTrue="{!v.showReject}">
                                <td class="alignCenter" onclick ="{!c.RejectAction}"><img class="img" src="/resource/ApprovalsLightning/images/Return.svg" /></td>
                            </aura:if>
                            <aura:if isTrue="{!v.showApprove}">   
                                <td class="alignCenter" onclick ="{!c.ApproveAction}"><img class="img" src="/resource/ApprovalsLightning/images/Approve.svg" /></td>
                            </aura:if>   
                        </tr>
                    </table>
                </div>  
            </div>        
         </div> 
        </aura:iteration>
    </div>
    <!-- Approval action popup -->
        <aura:if isTrue="{!v.isActionPopup}">
            <aura:iteration items="{!v.ApprovalDetail}" var="detailData">
                <div class="slds-backdrop slds-backdrop--open">
                    <c:CORE_CA_ApprovalAction actionTaken="{!v.actTaken}" ApprovalDetail="{!detailData}" sourcePage="{!v.sourcePage}" filterValue="{!v.filterValue}"></c:CORE_CA_ApprovalAction>
                </div>
            </aura:iteration>
        </aura:if>
        <!-- FeedBack popup -->
        <aura:if isTrue="{!v.isFeedBack}">          
            <div class="slds-backdrop slds-backdrop--open">
                <c:Feedback Appname="Approval" EventName="CORE_CA_FeedbackEvent"></c:Feedback>
            </div>  
        </aura:if>
        </aura:if>
</aura:component>