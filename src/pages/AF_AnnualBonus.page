<apex:page controller="AF_AnnualBonus" showHeader="false" sidebar="false" docType="HTML-5.0">
<style>
body .pbBody table.list tr th {
background: #61A631;
color: #FFFFFF;
font-size: 16px;
font-weight: bold;
text-align: center;
 }

body .pbBody table.list tr td {
    background: none repeat scroll 0 0 #D3e6b8 !important;
    color: black !important;
    text-align: center;
}

 .submit_btn1{
background: none repeat scroll 0 0 #E400A7 !important;
border: 1px solid red!important;
border-radius: 5px !important;
color: #FFFFFF!important;
font-size: 14px!important;
height: 30px;
width: 100px;
margin-left: 10px !important;
float: left;
margin-right: 0px!important;
 }
  .submit_btn2{
background: none repeat scroll 0 0 #E400A7 !important;
border: 1px solid red!important;
border-radius: 5px !important;
color: #FFFFFF!important;
font-size: 14px!important;
height: 30px;
width: 100px;
margin-left: 10px !important;
float: left;
 }
 
.values1 {
    background: none repeat scroll 0 0 #FFFFFF;
    border: 2px solid #74AE00;
    border-radius: 5px;
    color: #000000;
    font-size: 16px;
    height: 30px;
    margin-top: 10px;
    padding: 2px 0 0 5px;
    text-align: center;
    width: 120px !important;
}
.heading_main{
    margin-left: 0;
    margin-right: 0;
    margin-top: 0;
    padding-bottom:5px;
    padding-left: 0;
    padding-right: 0;
    width: 100%;
    }
.heading_text{
    color: black;
    font-size: 20px;
    margin-right: 20px;
    padding: 7px 1px 8px 8px;
}

.odd { 
         background-color: #FCF7F7;
}
.even {
         background-color: #DFF0D8;
}

body .pbBody table.list tr.headerRow td, body .pbBody table.list tr.headerRow th {
background: #61A631;
color: #FFFFFF;
font-size: 16px;
font-weight: bold;
width: 80px!important;
word-break: normal;
white-space: normal;
 }
 

body .bPageBlock {
    background: #F8F8F8 !important;
    border:none!important;

}
</style>
 <script>
 
  function isNumberKey(evt)
       {
          var charCode = (evt.which) ? evt.which : event.keyCode;
          var result = false;
          var errorMsg = document.getElementById("regTitle");
          if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)&& charCode != 45)
          {
             errorMsg.innerHTML = "<b>Please use numerical characters only.</b>";
             result = false;
          }
          else
          {
           errorMsg.innerHTML = "";
           result = true;         
          }             
          return result;
       }
 
 function isNumberKeyforRenum(evt)
       {
          var charCode = (evt.which) ? evt.which : event.keyCode;
          var result = false;
          var errorMsg = document.getElementById("regTitle1");
          if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57 && charCode != 45))
          {
             errorMsg.innerHTML = "<b>Please use numerical characters only.</b>";
             result = false;
          }
          else
          {
           errorMsg.innerHTML = "";
           result = true;         
          }             
          return result;
       }
 
  function emptybox(id)
     {
       var temp=document.getElementById(id).value;
       var errorMsg = document.getElementById("regTitle");
       
       if(temp==null||temp==''){
         errorMsg.innerHTML = "<b>Please enter</b>";
         return false;
       }else{
         return true;
       }
     }
  
     
 </script>
  <apex:message />
  <div class="row">           
        <div class="col-lg-12 charttable1">         
            <apex:image url="{!$Resource.header_new}" style="width:100%;height:37px;" />            
        </div>          
    </div>
   <div class="heading_main">
       <h1 class="heading_text"> Enter overall results </h1>
      </div>
   <apex:pageMessages id="pmsg" >
   </apex:pageMessages>
 <apex:outputpanel rendered="{!!AF_Pilot_Model}">
 <apex:pageBlock id="pg1" rendered="{!showmainblock}">

 <apex:form id="frm">
 
<apex:actionFunction name="call_calculate_bonus" action="{!Calculate_Bonus}" reRender="bonus1,bonus2,totals,totalbonus,bonus6,bonus7,totalQualValue1,totalQualPer1,totalQualValue,totalQualPer,totalQuant_Qual_Val,totalQuant_Qual_Per"/>
 
 <div style="float: left;font-size: 16px;font-weight: bold;">Bonusable Fees </div>
  <apex:outputPanel >
  <div style="font-size: 16px;margin-left: 248px;font-weight:bold;">
    
      <span style="margin-left: 4px;">Digital 
        <span style="margin-left: 61px;">&euro;</span>
        <apex:outputText value="{0,number,###,###,###}" >
        <apex:param value="{!Totals_BonusMeasureDigital}"/>
       </apex:outputText> </span> <br/>
  </div>
  <div style="font-size: 16px; margin-left: 248px;font-weight:bold;">
         
          <span style="margin-left: 2px;">Traditional
           <span style="margin-left: 30px;">&euro;</span>
         <apex:outputText value="{0,number,###,###,###}">
          <apex:param value="{!Totals_BonusMeasureTrad}"/>
       </apex:outputText> </span> 
  </div>
 
 </apex:outputPanel>
 <br/>
 

  <div style="font-size: 16px;">
 
 <apex:pageblockTable value="{!QuartelyBonus}" var="QB" id="pbt" style="text-align: center;font-size: 16px;width:130%; overflow-y: scroll" rowClasses="even,odd">
 
  <apex:column headerValue="Bonus Measure" rendered="{!!AF_Pilot_Model}">
   <apex:outputText value="{!QB.bonusMeasureMatrix}"/>
  </apex:column>
  <apex:column headerValue="Country" rendered="{!!AF_Pilot_Model}">
  <apex:outputText value="{!QB.Countryname}"/>
   <apex:facet name="footer">
    <apex:outputText value="Totals"/>
  </apex:facet>
 </apex:column>
 <apex:column headerValue="Bonusable Fees" style="width:50px;" >
<!--<apex:outputText value="{0,number,###,###,###}">
          <apex:param value="{!QB.total_bonus_fees}"/>
 </apex:outputText>-->
 <apex:outputPanel rendered="{!AND(IsEditable,NOT(QB.bonusResObj.AF_Locked__c))}">
 <apex:inputText value="{!QB.total_bonus_fees}" rendered="{!IF(QB.countryCount>1,'true','false')}">
    <apex:actionSupport event="onchange"  action="{!Calculate_Bonus}" reRender="bonus1,totalbonusper,bonus2,totals,totalbonus,bonus6,bonus7,totalQualValue1,totalQualPer1,totalQualValue,totalQualPer,totalQuant_Qual_Val,totalQuant_Qual_Per,totalBonusableFees" >
    </apex:actionSupport>
 </apex:inputText>
 <apex:outputText value="{!QB.total_bonus_fees}" rendered="{!IF(QB.countryCount==1,'true','false')}"/>
 </apex:outputPanel>
 <apex:outputPanel rendered="{!QB.bonusResObj.AF_Locked__c}">
  <apex:outputText value="{!QB.total_bonus_fees}" rendered="{!IF(QB.countryCount>1,'true','false')}"/>
 <apex:outputText value="{!QB.total_bonus_fees}" rendered="{!IF(QB.countryCount==1,'true','false')}"/>
 </apex:outputPanel>
  <apex:facet name="footer">
   
   <apex:outputText value="{0,number,###,###,###}" id="totalBonusableFees">
          <apex:param value="{!sum_of_bonusable_fees}" />
   </apex:outputText>
  </apex:facet>
  </apex:column>
 <apex:column headerValue="Minimum (5%)" rendered="{!!AF_Pilot_Model}">
  <apex:outputText value="{!QB.Minimum_bonus}"/>
 </apex:column>
 <apex:column headerValue="Stretching (10%)" rendered="{!!AF_Pilot_Model}">
  <apex:outputText value="{!QB.Streching_bonus}"/>
 </apex:column>
 <apex:column headerValue="Outstanding (15%)" rendered="{!!AF_Pilot_Model}">
  <apex:outputText value="{!QB.Outstanding_bonus}"/>
 </apex:column>
 
 <apex:column headerValue="Quant Result" rendered="{!AND(IsEditable,!AF_Pilot_Model)}" id="c1" >

 <apex:outputPanel >

  <apex:outputField value="{!QB.bonusResObj.AF_Quant__c}"  id="txtquant1" rendered="{!AND(IsEditable,QB.bonusResObj.AF_Locked__c)}" />
 <apex:outputPanel layout="block" styleClass="requiredBlock">
 <apex:inputfield value="{!QB.bonusResObj.AF_Quant__c}" id="txtquant"  style="text-align: center;width: 50px;" onFocus="javascript:this.maxLength=5;"  onkeypress="return isNumberKey(event)" rendered="{!AND(IsEditable,NOT(QB.bonusResObj.AF_Locked__c),NOT(ISNULL(QB.total_bonus_fees)))}">
  <div style="font-family:arial;color:red;font-size:16px;text-align:center" id="regTitle"></div>
 <apex:actionSupport event="onchange"  action="{!Calculate_Bonus}" reRender="bonus1,totalbonusper,bonus2,totals,totalbonus,bonus6,bonus7,totalQualValue1,totalQualPer1,totalQualValue,totalQualPer,totalQuant_Qual_Val,totalQuant_Qual_Per,totalBonusableFees" >
 </apex:actionSupport>
 
  </apex:inputfield>
 </apex:outputPanel>
  
  </apex:outputPanel>
 </apex:column>
  
 <apex:column headerValue="Quant (%)" rendered="{!!AF_Pilot_Model}">
 <apex:facet name="footer">
    <apex:outputText value="{!sum_of_bonus_per}" id="totalbonusper"/>
  </apex:facet>
 <apex:outputPanel id="bonus2">
  <apex:outputText value="{!QB.bonusResObj.AF_Quant_Bonus__c}"/>
  </apex:outputPanel>
 </apex:column>
 
 <apex:column headerValue="Quant Value (€)" rendered="{!!AF_Pilot_Model}" >
 <apex:facet name="footer">
 <apex:outputText value="{0,number,###,###,###}" id="totalbonus">
          <apex:param value="{!sum_of_bonus_val}" />
   </apex:outputText>
   
  </apex:facet>
 <apex:outputpanel id="bonus1">
 <apex:outputText value="{0,number,###,###,###}" >
 <apex:param value="{!QB.bonusResObj.AF_Quant_Bonus_Value__c}" />
  </apex:outputText>
  </apex:outputpanel>
 </apex:column>
 
 
 
 <apex:column headervalue="Qual Result" rendered="{!!AF_Pilot_Model}" style="width:50px;">
  <apex:outputpanel id="bonus3" >
 <apex:outputText value="{!QB.bonusResObj.AF_Qual__c}" rendered="{!AND(IsEditable,QB.bonusResObj.AF_Locked__c)}"/>
  <apex:inputfield value="{!QB.bonusResObj.AF_Qual__c}"   id="txtqual1" onkeypress="return isNumberKey(event)" rendered="{!AND(IsEditable,NOT(QB.bonusResObj.AF_Locked__c))}" style="text-align: center;width:50px;">
  <div style="font-family:arial;color:red;font-size:14px;text-align:center" id="regTitle"></div>
 <apex:actionSupport event="onchange" action="{!Calculate_Qual}" reRender="bonus1,bonus3,totalbonusper,bonus2,bonus4,totals,totalbonus,bonus5,bonus6,bonus7,totalQualValue1,totalQualPer1,totalQualValue,totalQualPer,totalQuant_Qual_Val,totalQuant_Qual_Per" >
 
 </apex:actionSupport>
 
  </apex:inputfield>
  </apex:outputpanel>
 </apex:column>
 <apex:column headerValue="Qual (%)" rendered="{!!AF_Pilot_Model}" >
   <apex:facet name="footer">
    <apex:outputText value="{!sum_of_qual_percent}" id="totalQualPer"/>
  </apex:facet>
 <apex:outputPanel id="bonus5">
  <apex:outputText value="{!QB.QualPercent}"/>
  </apex:outputPanel>
 </apex:column>

 

 
 
 

 <apex:column headerValue="Qual Value" rendered="{!!AF_Pilot_Model}" >
    <apex:facet name="footer">
    <apex:outputText value="{0,number,###,###,###}" id="totalQualValue">
     <apex:param value="{!sum_of_qual_value}" />
    </apex:outputText>
   </apex:facet>
 <apex:outputPanel id="bonus4">
   <apex:outputText value="{0,number,###,###,###}" >
     <apex:param value="{!QB.QualValue}" />
    </apex:outputText>
  </apex:outputPanel>
 </apex:column>

  
  <apex:column headerValue="Total Bonus (%)" rendered="{!!AF_Pilot_Model}">
  <apex:facet name="footer">
  <apex:outputText value="{!sum_of_quant_qual_percent}" id="totalQuant_Qual_Per"/>
  </apex:facet>
 <apex:outputPanel id="bonus7">
  <apex:outputText value="{!QB.bonusResObj.AF_Total_Bonus__c}"/>
  </apex:outputPanel>
 </apex:column>
 
  <apex:column headerValue="Total Bonus Value"  rendered="{!!AF_Pilot_Model}">
    <apex:facet name="footer">
    <apex:outputText value="{0,number,###,###,###}" id="totalQuant_Qual_Val">
     <apex:param value="{!sum_of_quant_qual_value}" />
    </apex:outputText>
    </apex:facet>
 <apex:outputPanel id="bonus6">
   <apex:outputText value=""/>
   <apex:outputText value="{0,number,###,###,###}" >
     <apex:param value="{!QB.bonusResObj.AF_Total_Bonus_Value__c}" />
    </apex:outputText>
  </apex:outputPanel>
 </apex:column>
 
 <apex:column headerValue="Comment"  rendered="{!!AF_Pilot_Model}">
    <apex:outputText value="{!QB.bonusResObj.AF_Comment__c}" title="{!QB.bonusResObj.AF_Comment__c}" rendered="{!AND(IsEditable,QB.bonusResObj.AF_Locked__c)}" style="
   white-space: nowrap; width:100px; overflow: hidden; text-overflow: ellipsis; float:left; display:block"/>
    <apex:inputfield value="{!QB.bonusResObj.AF_Comment__c}"  rendered="{!AND(IsEditable,NOT(QB.bonusResObj.AF_Locked__c))}"/>
 </apex:column>
 </apex:pageblockTable>
 
 </div>

 
 

 <div style="font-size:16px; float: left;margin-left: 10px;"> Note: On Submit, these records will be locked. Please contact to CMCO Super User to unlock. </div>
 <br/>
 <br/>
 <apex:outputPanel rendered="{!IsEditable}">
 <div id="Savebutton">
 <apex:commandButton id="UpdateBonus"  action="{!UpdateBonus}" Value="Save" reRender="pbt,pmsg" styleClass="submit_btn1" rendered="{!IsDraft}" status="status"/>
 </div>
 <apex:commandButton id="Confirm" action="{!ConfirmBonus}" value="Submit" reRender="pbt,pmsg" styleClass="submit_btn2" oncomplete="calldisable()" status="status"/>
 </apex:outputPanel>
 </apex:form>
 
  </apex:pageBlock>
  </apex:outputpanel>
 <apex:form >
    <apex:outputpanel rendered="{!AF_Pilot_Model}">
    <apex:pageBlock id="pg2">
    <div style="float: left;font-size: 16px;font-weight: bold;">Bonusable Fees </div>
        
  

 <br/><br/>
    <apex:pageblockTable value="{!renumBonus}" var="renum" id="pbt3" style="text-align: center;width:60%;" rendered="{!noDisplay}">
        <apex:column headerValue="Bonusable Fees" style="width:135px">
             <apex:outputText value="{0,number,###,###,###}" style="font-size: 16px;">
              <apex:param value="{!renum.bonusableFees}"/>
             </apex:outputText>
        </apex:column>
        <apex:column headervalue="Remuneration Rating" style="width:135px" >
            <apex:outputpanel id="panel1">
                <apex:outputText value="{!renum.renumRating}"  id="renum7" rendered="{!AND(IsEditable,renum.Locked)}" style="font-size: 16px;"/>
               
                <apex:inputtext value="{!renum.renumRating}" rendered="{!!renum.Locked}" onFocus="javascript:this.maxLength=2;"   id="renum2" onkeypress="return isNumberKey(event)"  style="text-align: center;font-size: 16px;width:60px;">
                    <div style="font-family:arial;color:red;font-size:14px;text-align:center" id="renum3"></div>
                       <!-- <apex:actionSupport event="onchange" action="{!Calculate_Remun2}" reRender="renum4,renum6" >
                        </apex:actionSupport>-->
                </apex:inputtext>
            </apex:outputpanel>
        </apex:column>
        <apex:column headerValue="Remuneration %" style="width:135px">
            <apex:outputPanel id="renum4">
                <apex:outputText value="{!renum.renumPercentage}"  id="renum8" rendered="{!AND(IsEditable,renum.Locked)}"/>
                <apex:inputtext value="{!renum.renumPercentage}" rendered="{!!renum.Locked}" onFocus="javascript:this.maxLength=5;"  onkeypress="return isNumberKeyforRenum(event)" style="text-align: center;font-size: 16px;width:60px;">
                    <apex:actionSupport event="onchange" action="{!Calculate_Remun_Per2}"   reRender="renum6" >
                        <div style="font-family:arial;color:red;font-size:14px;text-align:center" id="renum5"></div>
                    </apex:actionSupport>
                </apex:inputtext>
            </apex:outputPanel>
        </apex:column>
        <apex:column headerValue="Remuneration €" style="width:135px">
            <apex:outputPanel id="renum6">
            <apex:outputText value="{0,number,###,###,###.##}" style="font-size: 16px;">
              <apex:param value="{!renum.renumCalcAmount}"/>
             </apex:outputText>
             
            </apex:outputPanel>
        </apex:column>
        </apex:pageblockTable>
    </apex:pageBlock>
 
 <div style="font-size:16px; float: left;margin-left: 10px;"> Note: On Submit, these records will be locked. Please contact to CMCO Super User to unlock. </div>
 <br/>
 <br/>
 <div id="Savebutton">
 <apex:commandButton id="UpdateBonus"  action="{!UpdateBonus2}" Value="Save" reRender="pmsg" styleClass="submit_btn1" rendered="{!IsDraft}"/>
 </div>
 <apex:commandButton id="Confirm" action="{!ConfirmBonus2}" value="Submit" reRender="pmsg" styleClass="submit_btn2" oncomplete="calldisable()" />
 </apex:outputpanel>
 <apex:ActionStatus id="status" >
        <apex:facet name="start">
            <c:AF_Spinner BackColor="#efefef" borderColor="#efefef" borderSize="3" height="50px" width="180px" Message="Please wait" messageStyle="color:darkred;font-size:10pt;font-family:arial;font-weight:bold;" ImageUrl="/img/loading.gif"/>
        </apex:facet>
        </apex:ActionStatus>
 </apex:form>
  <script>
  function calldisable(){
          
            document.getElementById('Savebutton').style.visibility = "hidden";
            console.log('hi');
  }
  function callcalculateBonus(){
    alert('Hi');
    call_calculate_bonus();
    alert('Hi2');
  }
  </script>
</apex:page>