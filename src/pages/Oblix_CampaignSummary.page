<apex:page showHeader="false" docType="html-5.0" sidebar="false" controller="Oblix_CampaignSummaryController" standardStylesheets="true">
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/s/bs-3.3.5/jqc-1.11.3,dt-1.10.10/datatables.min.css" />
    <script type="text/javascript" src="https://cdn.datatables.net/s/bs-3.3.5/jqc-1.11.3,dt-1.10.10/datatables.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/css/unilever-style.css')}" />
    <link rel="stylesheet" type="text/css" href="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/css/multi-select.css')}" />
    <script src="{!URLFOR($Resource.Oblix_JQueryBlockUI)}"></script>
    <script src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/js/jquery.multi-select.js')}" type="text/javascript"></script>
    <script src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/js/jquery.quicksearch.js')}" type="text/javascript"></script>
    <script src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/js/biMap.js')}" type="text/javascript"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
    <script src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/js/readmore.min.js')}" />
    <script type="text/javascript">
        $(document).ready(function() { 
            /*var table = $('#swopTable').DataTable({"dom": 'rt6'});
            $('#searchBox').on( 'keyup', function () {
                table.search( this.value ).draw();
            } );*/
            var table = $('#sowListTable').DataTable({
                "dom": 'lrtip',
                'pagingType': 'full_numbers'
            });
            var historyTable = $('#historyListTable').DataTable({

                "dom": 'rt6'
            });
        });

        </script>
        <script>
            $ = jQuery.noConflict();
            $('.read_more').click(function() {
                alert( "Handler for .click() called." );
                return false;
            });
            $(document).ready(function() {
                $('.asset_description').readmore({
                    moreLink: '<a href="#">Read more</a>',
                    lessLink: '<a href="#">Close</a>',
                    collapsedHeight: 20,
                    blockCSS: 'display: block; width: 100px;',
                    afterToggle: function(trigger, element, expanded) {
                        if( expanded) { // The "more" link was clicked
                            $(this).width("width","100px");
                        }
                    }
                });
                // var table = $('#sowListTable').DataTable({
                //     "dom": 'lrtip',
                //     "pagingType": "full_numbers",
                //     "bAutoWidth": false,
                //     "aoColumns": [
                //       { "sWidth": "0%" },
                //       { "sWidth": "100px" },
                //       { "sWidth": "50px" },
                //       { "sWidth": "100px" },
                //       { "sWidth": "50px" },
                //       { "sWidth": "450px" },
                //       { "sWidth": "50px" },
                //       { "sWidth": "100px" }
                //    ]
                // });
                $('#sowListTable tbody').on('click', 'tr', function() {
                    //blockme();
                    $(this).toggleClass('selected');
                    $(this).addClass('bg_selected');
                });
            });
    </script>
    <script src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/js/swopJS.js')}" />



    <apex:form >
        <div class="Oblix_header_bkgd">
            <header class="Oblix_header_panel">
                <img src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/images/Oblix_Unilever_logo.png')}" width="54" height="60" />
                <div class="header_divider_vertical"></div>
                <div class="header_panel_text">
                    <h2>Hi  {!$User.FirstName} {!$User.LastName }, Welcome to SWOP the Scope of Work Online Planner</h2>
                    <p><a href="/apex/oblix_sowmain">SWOP Home</a>&nbsp;<span>&#9658;</span>&nbsp;<a href="#">SOW name</a>&nbsp;<span>&#9658;</span>&nbsp;<a href="#">Add new campaign</a>
                    </p>
                </div>
                <apex:commandButton styleClass="btn btn-xs pull-right btn_cross btn_exit_swop" action="{!exitSwop}" value="DONE FOR TODAY? EXIT SWOP">
                </apex:commandButton>

            </header>
        </div>
        <div class="container SOW_body">
            <div class="row">
                <apex:pageMessages />
                <apex:outputPanel id="capmaign_fee_container">
                    <div class="col-lg-6 col-md-6">
                        <h1 class="SOW_header_title">{!selected_project.Name} summary</h1>
                        <p class="SOW_body_option_links"><apex:outputLink value="/apex/Oblix_CampaignCreate?projectId={!selected_project.Id}" >Edit Campaign</apex:outputLink>
                        <!-- <a href="">Edit Campaign</a> -->&nbsp;&nbsp;|&nbsp;&nbsp;<a href="">Clone Campaign</a>&nbsp;&nbsp;|&nbsp;&nbsp;<a href="">Delete Campaign</a></p>
                    </div>
                    <table class="SOW_header_value_summary">
                        <tr>
                            <td rowspan="2"><button type="button" class="btn btn-danger btn-xs create_SOW_button">ADJUST %<img src="images/chevron.png" width="12" height="12"/></button></td>
                            <td class="SOW_header_value_title">Campaign Fees Total</td>
                            <td class="SOW_header_value"><h2>€{!stage_identifier.sow_project_in_scope.Campaign_Fees_Total__c}</h2></td>
                        </tr>
                        <tr>
                            <td class="SOW_header_value_subtitle">Fees to be Paid in Current FY</td>
                            <td class="SOW_header_value_subvalue">€{!stage_identifier.i_fees_for_this_financial_year}</td>
                        </tr>
                    </table>
                </apex:outputPanel>
            </div>
            <hr class="divider" />    
            <div class="row">
                <div class="col-lg-9 confirm_assets_accordion">
                    <c:Oblix_CampaignStage StageIdentifier="{!stage_identifier}" AutoSave="true" Id="campaign_stage_component" />              
                        <div class="col-lg-6 campaign_summary_info_table">
                            <table class="campaign_summary_information">
                                <tr>
                                    <td class="campaign_summary_information_titles">Last Updated</td>
                                    <td colspan="2">
                                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}">
                                            <apex:param value="{!selected_project.LastModifiedDate}" /> 
                                        </apex:outputText> by {!selected_project.LastModifiedBy.Name}</td>
                                
                                </tr>
                                <tr>
                                    <td class="campaign_summary_information_titles cell_text_top_align">Agency Hub Split</td>
                                    <td>
                                        <apex:repeat value="{!selected_project.Marketing_SOW_Project_Splits__r}" var="hub_splits" >
                                            {!hub_splits.OblixCountry__r.Name}<br/>
                                        </apex:repeat>
                                    </td>
                                    <td>
                                        <apex:repeat value="{!selected_project.Marketing_SOW_Project_Splits__r}" var="hub_splits" >
                                            {!hub_splits.Percentage__c}%<br/>
                                        </apex:repeat>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="campaign_summary_information_titles">Countries / Regions</td>
                                    <td colspan="2">{!selected_project.OblixCountries__c}</td>
                                </tr>
                                <tr>
                                    <td class="campaign_summary_information_titles">Investment Priority</td>
                                    <td colspan="2">{!selected_project.Innovation_Projects__c}</td>
                                     <td><apex:outputText value="{!mapTurnoverToSize[selected_project.Brand_Led_Growth__c]}" rendered="{!selected_project.Brand_Led_Growth__c <> null}"></apex:outputText></td>
                                </tr>
                                <tr>
                                    <td class="campaign_summary_information_titles">Campaign idea</td>
                                    <td colspan="2">{!selected_project.Campaign_Idea__c}</td>
                                </tr>
                                <tr>
                                    <td class="campaign_summary_information_titles">Geographic scale</td>
                                    <td colspan="2">{!selected_project.Project_Scale_1__c}</td>
                                </tr>
                                <tr>
                                    <td class="campaign_summary_information_titles">Agency hubs</td>
                                    <td colspan="2">{!selected_project.Total_Locations__c}</td>
                                </tr>
                                <tr>
                                    <td class="campaign_summary_information_titles cell_text_top_align">Attachments</td>
                                    <td colspan="2">
                                        <apex:repeat value="{!liso_attachments}" var="attachments" >
                                            <img src="images/redcross.png" class="attachement_redcross" height="12" width="12" />{!attachments.Name}<br/>
                                        </apex:repeat>
                                    </td>
                                </tr>
                            </table>
                            </div>
                            <div class="col-lg-6">
                            <table class="campaign_summary_information">
                                <tr>
                                    <td class="campaign_summary_information_titles">Platform</td>
                                    <td colspan="2">{!selected_project.Platform__c}</td>
                                </tr>
                                <tr>
                                    <td class="campaign_summary_information_titles">Campaign priority</td>
                                    <td colspan="2">{!selected_project.Project_Priority__c}</td>
                                </tr>
                                <tr>
                                    <td class="campaign_summary_information_titles cell_text_top_align">Timeline dates</td>
                                    <td>
                                        <apex:outputText value="Campaign start" rendered="{!NULL<>selected_project.Project_Start_Date__c}"><br/></apex:outputText>
                                        <apex:outputText value="Campaign completion" rendered="{!NULL<>selected_project.Project_Completion_Date__c}"><br/></apex:outputText>
                                        <apex:outputText value="First air date" rendered="{!NULL<>selected_project.First_Air_Date__c}"><br/></apex:outputText>
                                        <apex:outputText value="Production completion " rendered="{!NULL<>selected_project.Production_Completion_Date__c}"><br/></apex:outputText>
                                        <apex:outputText value="BET first release" rendered="{!NULL<>selected_project.BET_first_release__c}"><br/></apex:outputText>
                                        <apex:outputText value="Date for assets in BET" rendered="{!NULL<>selected_project.Date_for_Assets_to_be_in_BET__c}"><br/></apex:outputText>
                                        <apex:outputText value="Preview Date" rendered="{!NULL<>selected_project.Preview_Date__c}"><br/></apex:outputText>
                                        <apex:outputText value="Start of TV production" rendered="{!NULL<>selected_project.Start_of_TV_production__c}"><br/></apex:outputText>
                                        <apex:outputText value="Final release" rendered="{!NULL<>selected_project.Final_release__c}"><br/></apex:outputText>
                                        <apex:outputText value="Live date" rendered="{!NULL<>selected_project.Live_Date__c}"><br/></apex:outputText>
                                        <apex:outputText value="Live date/asset delivery" rendered="{!NULL<>selected_project.Live_date_Asset_delivery__c}"><br/></apex:outputText>

                                    </td>
                                    <td>

                                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}" rendered="{!NULL<>selected_project.Project_Start_Date__c}">
                                            <apex:param value="{!selected_project.Project_Start_Date__c}" /> <br/>
                                        </apex:outputText>


                                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}" rendered="{!NULL<>selected_project.Project_Completion_Date__c}">
                                            <apex:param value="{!selected_project.Project_Completion_Date__c}" /> <br/>
                                        </apex:outputText>


                                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}" rendered="{!NULL<>selected_project.First_Air_Date__c}">
                                            <apex:param value="{!selected_project.First_Air_Date__c}" /> <br/>
                                        </apex:outputText>

                                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}" rendered="{!NULL<>selected_project.Production_Completion_Date__c}">
                                            <apex:param value="{!selected_project.Production_Completion_Date__c}" /> <br/>
                                        </apex:outputText>

                                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}" rendered="{!NULL<>selected_project.BET_first_release__c}">
                                            <apex:param value="{!selected_project.BET_first_release__c}" /> <br/>
                                        </apex:outputText>

                                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}" rendered="{!NULL<>selected_project.Date_for_Assets_to_be_in_BET__c}">
                                            <apex:param value="{!selected_project.Date_for_Assets_to_be_in_BET__c}" /> <br/>
                                        </apex:outputText>

                                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}" rendered="{!NULL<>selected_project.Preview_Date__c}">
                                            <apex:param value="{!selected_project.Preview_Date__c}" /> <br/>
                                        </apex:outputText>

                                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}" rendered="{!NULL<>selected_project.Start_of_TV_production__c}">
                                            <apex:param value="{!selected_project.Start_of_TV_production__c}" /> <br/>
                                        </apex:outputText>

                                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}" rendered="{!NULL<>selected_project.Final_release__c}">
                                            <apex:param value="{!selected_project.Final_release__c}" /> <br/>
                                        </apex:outputText>

                                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}" rendered="{!NULL<>selected_project.Live_Date__c}">
                                            <apex:param value="{!selected_project.Live_Date__c}" /> <br/>
                                        </apex:outputText>

                                        <apex:outputText value="{0,date,MM'/'dd'/'yyyy}" rendered="{!NULL<>selected_project.Live_date_Asset_delivery__c}">
                                            <apex:param value="{!selected_project.Live_date_Asset_delivery__c}" /> <br/>
                                        </apex:outputText>

                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="3"><span class="campaign_summary_information_titles" >Description</span><br/>
                                    {!selected_project.Description__c}<!-- <a href="">more</a> --></td>
                                </tr>
                                <tr>
                                    <td colspan="3"><span class="campaign_summary_information_titles" >Jobs to be done</span><br/>
                                    {!selected_project.Jobs_to_be_Done__c}<!-- <a href="">more</a> --></td>
                                </tr>
                            </table>
                        </div>    
                    </div>   
                </div>
                <hr class="divider" />
            <div class="row">
                <apex:outputPanel id="assets_panel" >
                <div class="col-lg-12 ">
                    <p class="page_bold_subheading">Campaign Assets</p>
                    <apex:commandButton value="Add Asset" action="{!addAssetAction}" styleClass="btn btn-primary btn-xs create_SOW_button pull-right" onclick="blockme()" />
                        <div class="Oblix_table" id="Oblix_DashId">
                            <table class="table table-striped" id="sowListTable">
                                <thead>
                                        <tr>
                                            <apex:repeat value="{!$ObjectType.Oblix_Project_Assets__c.FieldSets.Oblix_Campaign_Summary}" var="field_name">
                                                <th>
                                                    <apex:outputLabel value="{!field_name.label}"/>
                                                </th>
                                            </apex:repeat>
                                            <th></th>
                                        </tr>
                                </thead>
                                <tbody>
                                    <apex:repeat value="{!liso_assets}" var="asset">
                                            <tr>
                                                <apex:repeat value="{!$ObjectType.Oblix_Project_Assets__c.FieldSets.Oblix_Campaign_Summary}" var="field_name">
                                                    <td>
                                                        <apex:outputText value="{0, number, ###,###.##}" rendered="{!(asset[field_name] != null && field_name.Type =='double')}">
                                                            <apex:param value="{!asset[field_name]}" />
                                                        </apex:outputText> 

                                                        <apex:outputText value="{0,date,E','dd MMM yyyy}" rendered="{!(asset[field_name] != null && field_name.Type =='dateTime')}" style="tableRow">
                                                            <apex:param value="{!asset[field_name]}" />
                                                        </apex:outputText>

                                                        <apex:outputText value="{!asset[field_name]}" rendered="{!(asset[field_name] != null && field_name.Type !='date' && field_name.Type !='double' && !contains(field_name.Label,'Name'))}" style="tableRow" styleClass="asset_description" />
                                                        <apex:outputLink value="{!$Page.Oblix_CampaignAddAsset}?projectId={!project_id}&assetId={!asset['Id']}" rendered="{!(asset[field_name] != null && field_name.Type !='date' && field_name.Type !='double' && contains(field_name.Label,'Name'))}" style="tableRow" target="_blank" >{!asset[field_name]}</apex:outputLink>
                                                    </td>
                                                </apex:repeat>
                                                <td>
                                                    <apex:image onclick="if (confirm('are you sure you want to delete this asset?')) removeAsset('{!asset.Id}');" url="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/images/redcross.png')}" width="12" height="12" />
                                                    <!-- <img src="images/redcross.png" width="12" height="12">
                                                        <apex:actionSupport event="onclick" rerender="sowListTable"  action="{!removeAsset}">
                                                        </apex:actionSupport>
                                                    </img> -->

                                                </td>
                                            </tr>
                                    </apex:repeat>
                                </tbody>
                            </table>
                        </div>                  
                </div>
            </apex:outputPanel> 
            </div>
        </div>
        <apex:actionFunction action="{!removeAsset}" name="removeAsset" rerender="assets_panel">
            <apex:param name="selected_asset_id" assignTo="{!selected_asset_id}" value="" />
        </apex:actionFunction>
 
<!--         <div class="container">
            <div class="row history_table">
                <div class="col-lg-12 history_gradient_background">
                    <p class="history_table_title">History of Changes</p>
                    <c:Oblix_CmpAuditTracking recordId="{!project_id}" objApiName="Oblix_SOW_Projects__c" />
                </div>
            </div>
        </div> -->
     </apex:form>

    
</apex:page>