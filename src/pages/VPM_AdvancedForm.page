<apex:page standardController="VPM_PurchasingRequests__c"  extensions="VPM_SearchVendor,VPM_PurchaseRequestsControllerExtension" standardStylesheets="true" sidebar="false" language="{!userlang}">
<!--apex:stylesheet value="{!URLFOR($Resource.vpmbootstrapresources, 'vpmbootstrapresources/bootstrap.css')}" /-->
<apex:stylesheet value="{!URLFOR($Resource.vpmstyles, 'vpmstyles.css')}" />
<apex:stylesheet value="{!URLFOR($Resource.vpmadvancedformcss)}" />
<apex:includeScript value="{!$Resource.vpmjqueryresources}"/>
<apex:includeScript value="{!URLFOR($Resource.vpmjqueryresources, 'vpmjqueryresources/jquery-1.12.4.js')}"/>
 <chatter:feedWithFollowers entityid="{!VPM_PurchasingRequests__c.Id}" id="ChatterBlock"  />
<script type = "text/javascript">
      $(document).ready(function(){
        var flag; 
        var criteria1 = "{!VPM_PurchasingRequests__c.VPM_Status__c}"; 
        var criteriaId = "{!VPM_PurchasingRequests__c.Id}";
        var flsInCountry = "{!VPM_PurchasingRequests__c.VPM_FLSInCountryReqVendor__c}";
        var Islock = "{!VPM_PurchasingRequests__c.VPM_IsLock__c}";
        //$('input[type="submit"],input[type="button"]').css('background-color','#0275d8 !important');
         /* Remoting Manager Methods*/
         /*Visualforce.remoting.Manager.invokeAction('VPM_PurchaseRequestsControllerExtension.checkLoggedInUserRole',
            function(userRole, event){
               debugger;
            });*/
          
          
         Visualforce.remoting.Manager.invokeAction('VPM_PurchaseRequestsControllerExtension.checkForBusinessReqUser',
            function(results, event){
                debugger;
                if(results.userRole=="FLS" && criteria1=="FLS Review") {
                     debugger;
                    removeStyleSheets();
                    $("#detailPage").show();
                    //var a= '{!$Label.VPM_ApprovReject}';
                    alert('{!$Label.VPM_ApprovReject}');
                 }
                 else if(flsInCountry=="true" && results.brUser=="true" && criteria1=="Draft Request")
                 {
                     debugger;
                    //document.getElementById('{!$Component.theForm}').elements['{!$Component.hiddenField}'].value = flag;
                    //$($('input[id*="hdnField"]')[0]).attr("value",flag);
                    // if((document.referrer.indexOf('apex/VPM_AdvancedForm') == -1 && document.referrer.indexOf('VPM_GoldenData1') == -1)|| localStorage.getItem("cancelClicked"))
                       if(document.URL.indexOf("back=true")==-1) 
                        {
                            debugger;
                         flag = confirm('{!$Label.VPM_BypassFrontlineTeam}');
                    
                         if(flag){
                          //    localStorage.removeItem("cancelClicked");
                             $("#advForm").show();
                             domManipulations();
                             }
                        else{
                            debugger;
                          //    localStorage.setItem("cancelClicked",true);
                            removeStyleSheets();
                            $("#detailPage2").show();
                            }
                        }
                        else
                        {
                            debugger;
                         $("#advForm").show();
                         domManipulations();
                        }
                }
                else if (!Islock)
                {
                    alert('Record is in Approval...');
                    //return false;
                }
                    else{ //if(criteria1!="FLS Review")
                    domManipulations();
                    $("#advForm").show(); 
                    //$("#detailPage").hide();
               
                } 
           });
    });
    function removeStyleSheets(){
            $('link[href*="vpmadvancedformcss"]').remove();
           // $('link[href*="bootstrap"]').remove();
            $('link[href*="vpmstyles"]').remove();
    }
    function domManipulations(){
        var el = $('tr>td.pbTitle');
        var savedRow = '';
        var numberOfTextFields = $('.detailList input[type="text"]').length;
        //var spanToAlign = $('span[id*="VPM_MaintainTypeInfo"]');
        //var maintainRadioBtns =$('span[id*="VPM_MaintainTypeInfo"]').length>0 ? $('span[id*="VPM_MaintainTypeInfo"]') : $('span[id*="VPM_Maintain2TypeInfo"]');
        var vendorDetailHeader = $('span[id*="VPM_CreateVendorDetailInfo"]');
        var maintainVendorHeader= $('span[id*="VPM_Maintain1VendorDetailsScreenInfo"]');
        var purchasingTab = $('#tabBar>li[class*="VPM_PurchasingRequests"]');
        var alignErrorMsg = $('span[id*="VPM_UnBlockUndeleteMessage"]');
        debugger;
       
        
        $('span[id*="VendorSearchInstr"],span[id*="VPM_MaintainExtendInstr"]').find('i').css("font-style","normal");
        //$(purchasingTab).css("background-color","#0275D8");
        $('input[type="button"],input[type="submit"],button').addClass("btn-primary");
        
        $(vendorDetailHeader).find("b").addClass('emphasizeHeader');
        $(maintainVendorHeader).find("b").addClass('emphasizeHeader');
        $('span[id*="VPM_ReqestBriefDisplayText"]').find("b").addClass("emphasizeHeader");
        $('span[id*="VPM_BankDetailDisplaName"]').find("b").addClass("emphasizeHeader");
        $('span[id*="VPM_PaymentTermDisplay"]').find("b").addClass("emphasizeHeader");
        $('span[id*="VPM_FinancailDisplayText"]').find("b").addClass("emphasizeHeader");
        $('span[id*="CreateRegionSpecific"]').addClass("emphasizeHeader").css('font-weight','bold');
        
        $(".FlowPageBlockBtns").siblings().remove();
        /*  to align status and type side by side instead of one stacking both one above the other  */
       /* $(spanToAlign).css("float","left");
        var allDivs =$(spanToAlign).find('div');
        if($(allDivs[2]).find('font').text().indexOf('Status')!=-1)
            $(allDivs[2]).css({"float":"left"},{"margin-left":"6em"});
         
         if($(".interviewDisplayTextRow b").text().indexOf("Type") > -1){
                savedRow = $(".interviewDisplayTextRow")[1];
                savedRow && savedRow!=null ? $(savedRow ).remove():'';
             $(savedRow).insertBefore($(".interviewDisplayTextRow")[0]);
             $($(".interviewDisplayTextRow")[0]).css("display","table-cell");
            
             }
         if($(maintainRadioBtns).find("span").text().indexOf("Maintain") > -1){
            savedRow = $(maintainRadioBtns).find("span");
            if($(maintainRadioBtns).find("div").text().indexOf("Status") > -1){
                $(savedRow).insertBefore($(maintainRadioBtns).find("div:last-child"));
            }
            $(maintainRadioBtns).find("div:nth-child(3)").addClass("statusAlignment");
            $(maintainRadioBtns).find("span").addClass("typeAlignment");
              if($(".interviewDisplayTextRow font").text().indexOf("Extend") > -1){
                    $($(".interviewDisplayTextRow")[1]).css({"float": "right",
                                                          "position": "relative",
                                                          "right": "22.5em"});
             }
            else{
                 $(maintainRadioBtns).find("span").css({"left":"12em","top":"-1em"});
            }
        }
        */
        /*  *****  */
        /* to divide fields into 2 columns */
        if(numberOfTextFields > 10){
            var remainingRows = [];
            var toRemove ='';
            for(var i=(Math.round(numberOfTextFields/2));i<numberOfTextFields;i++){
                toRemove = $('.detailList input[type="text"]')[i]; 
                remainingRows.push($(toRemove).closest('tr'));
            }

            for(var j=0,i=2;j<remainingRows.length,i<=$('.detailList tr').length;j++,i++){
                 var row = ($('.detailList tr')[i]);
                if(row && row!=[]){
                 $(row).find(".labelCol.last.empty").remove();
                 $(row).find(".dataCol.last.empty").remove();
                 if(remainingRows[j] && remainingRows[j].children()){
                    $(row).append(remainingRows[j].children());
                 }
               }
            }
        }
        /*  *****  */
         /*  Change text of 'Previous Button'   */
         var buttonLength = $('input[type="submit"],input[type="button"],button').length;
         for(var i=0;i<buttonLength;i++){
            if($('input[type="submit"],input[type="button"],button')[i].value == 'Previous')
                $('input[type="submit"],input[type="button"],button')[i].value = 'Menu/Previous';                
         }
        /*  *****  */
        
         if($(alignErrorMsg) && $(alignErrorMsg)!=[]){
                $(alignErrorMsg).closest('tr').css('display','table-row').append('<br>');
                $(alignErrorMsg).closest('td').append('<br>');
        }
    }
    function openPopup(page){
        window.open('/apex/VPM_AttachmentSectionPopUp','Table','toolbar=yes, scrollbars=no, toolbar=no, menubar=no, height=500,width=1230, top=70, left=70');
        return false;
    }
    function showAttachments(id){
        window.open('/apex/VPM_AttachFiles?id='+id,'Table','toolbar=yes, scrollbars=no, toolbar=no, menubar=no, height=500,width=1230, top=70, left=70'); 
    }
    </script>
 <div id="advForm" style="display: none;">
   <apex:form >
    
    <apex:pageBlock title="" id="Block1">
    <apex:pagemessages id="pageMessages"/><br/>
     <apex:pageBlockButtons >  
     <apex:commandButton action="{!backBtnAction}" value="Back" rendered="{!renderBackBtn }" reRender="Block1" status="actStatusId" immediate="true"/>     
            <apex:commandButton action="{!getVendorDetailList}" rendered="{!showSearchVendor}" value="{!$Label.VPM_Next}" reRender="Block1" status="actStatusId" /> 
            <apex:commandButton action="{!VendorSelected}" value="{!$Label.VPM_Next}" rendered="{!hideSearchVendor}" reRender="Block1" status="actStatusId"/>  
             <apex:commandButton action="{!processRequestType}" value="{!$Label.VPM_Next}"  rendered="{!LaunchScreen}" reRender="Block1" status="actStatusId"/> 
              <!--<apex:commandButton action="{!VendorSelected}" value="{!$Label.VPM_Send_Button}" reRender="Block1"  status="actStatusId" rendered="{!sendWebFormScreen}"/>-->
              <apex:commandButton action="{!VendorSelected}" value="{!sendWebFormLabel}" reRender="thePageBlock,Block1"  status="actStatusId" rendered="{!sendWebFormScreen}"/> 
        </apex:pageBlockButtons>
        <apex:pageBlock id="hiddenBlock" rendered="false"></apex:pageBlock> 
        <apex:pageBlockSection columns="2" rendered="{!LaunchScreen}">
            <apex:outputText label="Type" value="{!screenType}"/>
            <apex:outputText Label="Status" value="{!VPMStatus}"/> 
        </apex:pageBlockSection>
        
     <apex:pageBlockSection columns="1" rendered="{!showSearchVendor}">
      <apex:pageBlockSectionItem labelStyle="width: 300px" dataStyle="width: 200px" >
               <apex:outputText value="{!$Label.VPM_Vendor_Search_message}"  />
 

                 </apex:pageBlockSectionItem> 
      <apex:pageBlockSectionItem >
                <apex:outputLabel value="{!$Label.VPM_VendorName}"  /><apex:outputPanel layout="block" styleClass="requiredInput">
                <apex:outputpanel layout="block" styleClass="requiredBlock"/>
                <apex:inputText value="{!VendorName}" label="{!$Label.VPM_VendorName}" required="true"/>
                 </apex:outputPanel>  
                 </apex:pageBlockSectionItem> 
                 
     

    <!--apex:inputText value="{!VendorName}" label="{!$Label.VPM_VendorName}" required="true"/-->
     <apex:inputText value="{!Street1}" label="{!$ObjectType.VPM_PurchasingRequests__c.fields.VPM_Street1__c.Label}" />
     <apex:inputText value="{!ZIPPostcode}" label="{!$ObjectType.VPM_PurchasingRequests__c.fields.VPM_ZIPPostcode__c.Label}" />
     <apex:inputText value="{!TaxCode}" label="{!$Label.VPM_TaxCode}" />
     <!--apex:inputField value="{!VPM_PurchasingRequests__c.VPM_Country__c}" label="{!$Label.VPM_MDMCountry}" required="true"/-->
      <apex:pageBlockSectionItem >
                 <apex:outputLabel value="{!$Label.VPM_MDMCountry}"  />
                 <apex:outputPanel layout="block" styleClass="requiredInput">
                 <apex:outputpanel layout="block" styleClass="requiredBlock"/>
                 <apex:selectList value="{!CountryName}" multiselect="false" label="VPM MDM Country" size="1">
            <apex:selectOptions value="{!CountryNameList}"/>
        </apex:selectList>
                  
                   </apex:outputPanel>  
                 </apex:pageBlockSectionItem> 
      
     

      </apex:pageBlockSection>                
     
   <apex:pageBlockSection columns="1" rendered="{!hideSearchVendor}">
      <apex:repeat value="{!mdmDetailList}" var="mdmDetail" id="theRepeat">

        <input type="radio" name="Letters" value="{!mdmDetail.UniqueId}" onclick="changeValue(this,'{!$Component.RadioButtonValue}');" /> {!mdmDetail.DetailOption}<br/>

    </apex:repeat>
    <apex:inputHidden value="{!MDMVendor}" id="RadioButtonValue" />
    </apex:pageBlockSection>   

    <apex:pageBlockSection columns="1" rendered="{!LaunchScreen}">
     <br/>
       <apex:outputText value="{!$Label.VPM_Block_Delete_message}" rendered="{!isMaintain2}" style="color:blue">
     </apex:outputText>
     <br/>
      <apex:repeat value="{!RequestTypeList}" var="requestType" id="theRepeat" >

        <input type="radio"  name="Letters" value="{!requestType.UniqueId}" onclick="changeValue(this,'{!$Component.RadioButtonValue}');" /> {!requestType.DetailOption}<br/>

    </apex:repeat>
    <apex:inputHidden value="{!MDMVendor}" id="RadioButtonValue" />
    </apex:pageBlockSection> 
   <center> 
     <apex:pageBlockSection columns="1" rendered="{!VendorNotFound}" > 
             {!$Label.VPM_Vendor_Not_Found}   
     </apex:pageBlockSection> 
   </center>
  <apex:pageBlockSection columns="1" id="thePageBlock" rendered="{!sendWebFormScreen}">                
               <apex:outputText Value="{!$Label.VPM_SendWebformRequestInfo}" ></apex:outputText>  
                  <apex:pageBlockSectionItem >  
    <apex:outputLabel value="{!$Label.VPM_SendWebformRequestToVendor}" for="options"/>
    <apex:outputPanel styleClass="requiredInput" layout="block">
    <apex:outputPanel styleClass="requiredBlock" layout="block"/> 
        <apex:actionRegion >
   <apex:selectList id="options" size="1" label="{!$Label.VPM_SendWebformRequestToVendor}"  value="{!positions}" required="true">
                    <apex:selectoption itemLabel="Yes" itemValue="Yes"/>  
                    <apex:selectoption itemLabel="No" itemValue="No"/>
          <apex:actionSupport event="onchange" action="{!newMethod}"  reRender="thePageBlock,Block1"/>
       </apex:selectList>
      
              </apex:actionRegion>
   </apex:outputPanel>
</apex:pageBlockSectionItem> 

              <apex:inputField label="{!$ObjectType.VPM_PurchasingRequests__c.fields.VPM_VendorContactDetail__c.Label}" value="{!VPM_PurchasingRequests__c.VPM_VendorContactDetail__c}" required="{!isRequiredField}" rendered="{!isRequiredField}" />
          </apex:pageBlockSection> 
          
    
       
    </apex:pageBlock>     
    <script>
        function changeValue(input, textid) {
        debugger;
            document.getElementById(textid).value = input.value;
        }
    </script>       
    </apex:form>
 </div>
 <c:VPM_LoadingComponent />
  
       
       <br/>
      
   
    
    <div id="detailPage" style="display:none;">
        <!--apex:detail subject="{!VPM_PurchasingRequests__c.Id}"  showChatter="true" /-->
        <apex:detail subject="{!VPM_PurchasingRequests__c.Id}" rendered="{!VPM_PurchasingRequests__c.VPM_Status__c == 'FLS Review'}"/>
    </div>
    <div id="detailPage2" style="display:none;">
        <apex:detail subject="{!VPM_PurchasingRequests__c.Id}" />
    </div>  
     <apex:outputLink onclick="showAttachments('{!VPM_PurchasingRequests__c.Id}'); return false;"
         rendered="{!VPM_PurchasingRequests__c.Id != null && VPM_PurchasingRequests__c.Id != '' && 
                   VPM_PurchasingRequests__c.VPM_Status__c != 'FLS Review'}">Upload supporting documents</apex:outputLink>
       <br/>
       <apex:outputLink onclick="openPopup('{!$Page.VPM_AttachmentSectionPopUp}');return false;"
                         rendered="{!VPM_PurchasingRequests__c.VPM_Status__c != 'FLS Review'}">Help for uploading documents</apex:outputLink> 
    
 
</apex:page>