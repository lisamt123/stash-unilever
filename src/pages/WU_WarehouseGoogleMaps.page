<!--
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Visualforce page to display Master Warehouse records on google map fillter by user selection. 
 Release : Sprint 1 
 Author : Suresh D S
 Created Date : 2/11/2016
 
@History:  
Modified By: 
Description: 
Date: 
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
*/ -->
<apex:page standardController="WU_Master_Warehouse__c"  extensions="WU_WarehouseSearchGooglemapController" tabStyle="WU_Warehouse_Maps__tab" action="{!getWarehouseList}">
<apex:form >
<apex:pageblock >

    <!--Style to give white background to LookUp Fields -->
    <style>
        .emptyDependentLookup {
            background-color: White !important;
        }
    </style>
  
    <table width="85%" Position = "Fixed">
         <tr> 
             <td vertical-align="center">
                <apex:outputLabel value="{!$Label.WU_SAPCode}"></apex:outputLabel>
                <apex:inputfield value="{!warehouseCapacity.WU_SAPCode_s__c}" id="ipSAP"/>
            </td>
            <td></td>
            <td >
                <apex:outputLabel value="{!$Label.WU_Region}"></apex:outputLabel>&nbsp;&nbsp;
                 <apex:inputfield value="{!warehouseCapacity.WU_Region__c}" id="ipregion"  >
                    <apex:actionsupport event="onchange" rerender="wareList"/>
                </apex:inputfield>
            </td>
            <td></td>
             <td align="center">
                 <apex:outputLabel value="{!$Label.WU_MCO}"></apex:outputLabel>&nbsp;&nbsp;
                 <apex:inputfield value="{!warehouseCapacity.WU_MCO__c}" id="ipMCO">
                     <apex:actionsupport event="onchange" rerender="wareList"/>
                 </apex:inputfield>
             </td>
             <td></td>
             <td></td>
            <td>
                 <apex:outputLabel value="{!$Label.WU_Category}"></apex:outputLabel>&nbsp;&nbsp;
                 <apex:inputfield value="{!warehouseCapacity.WU_Network__c}" id="ipCategory">
                     <apex:actionsupport event="onchange" rerender="wareList"/>
                 </apex:inputfield>
             </td>
            <td></td>
            
            <td>
                 <apex:outputLabel value="{!$Label.WU_Building_ContractType}"></apex:outputLabel>&nbsp;&nbsp;
                 <apex:inputfield value="{!warehouseCapacity.WU_Building_ContractType__c}" id="ipBCT" >
                     <apex:actionsupport event="onchange" rerender="wareList"/>
                 </apex:inputfield>
             </td>
             <td></td>
             <td>
                 <apex:outputLabel value="{!$Label.WU_Country}"></apex:outputLabel>&nbsp;&nbsp;
                 <apex:inputfield value="{!warehouseCapacity.WU_Country__c}" id="ipCountry" >
                     <apex:actionsupport event="onchange" rerender="wareList"/>
                 </apex:inputfield>
             </td>
             <td></td>
             <td>
                 <apex:outputLabel value="{!$Label.WU_City}"></apex:outputLabel>&nbsp;&nbsp;
                 <apex:inputfield value="{!warehouseCapacity.WU_CityName__c}" id="ipCity" style="width: 91px">
                     <apex:actionsupport event="onchange" rerender="wareList"/>
                 </apex:inputfield>
            </td>
            <td></td>
            
            <td>
                 <apex:outputLabel value="{!$Label.WU_Active_WH}"></apex:outputLabel>&nbsp;&nbsp;
                 <apex:inputfield value="{!warehouseCapacity.WU_Active_WH__c}" id="ipWH">
                     <apex:actionsupport event="onchange" rerender="wareList"/>
                 </apex:inputfield>
            </td>
            <td></td>
            
           
            <td>
                <br></br>
                <apex:commandButton value="Search" action="{!SearchRecords}" style="height:20px;width:70px;text-align:center;" onclick="Initialize()"/>
            </td>
            <td>&nbsp;&nbsp;</td><td>&nbsp;&nbsp;</td>
            
            <td>&nbsp;&nbsp;</td>
           
        </tr>
       
        <tr>
            <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
        </tr>
    </table>
   <strong>
                <apex:outputText style="font-style:italic;color:red;" rendered="{!(AllSearchRecords.size = 0)}" value="There are no records to display for search Criteria." /></strong>
    <apex:pageBlockSection > 
        
    </apex:pageBlockSection>
  
  </apex:pageblock>

<script 
        type="text/javascript"
        src="//maps.google.com/maps/api/js?sensor=false&v=3.5">
    </script>

    <style>  
        #map {
            font-family: Arial;
            font-size:12px;
            line-height:normal !important;
            height:400px;      
            padding: 20px;
        }     
        .roundCornerCss{
            /* outer shadows  (note the rgba is red, green, blue, alpha) */
            -webkit-box-shadow: 0px 0px 12px rgba(0, 0, 0, 0.4);
            -moz-box-shadow: 0px 1px 6px rgba(23, 69, 88, .5);
          
            /* rounded corners */
            -webkit-border-radius: 12px;
            -moz-border-radius: 7px;
            border-radius: 7px;
          
            /* gradients */
            background: -webkit-gradient(linear, left top, left bottom,
            color-stop(0%, white), color-stop(15%, white), color-stop(100%, #D7E9F5));
            background: -moz-linear-gradient(top, white 0%, white 55%, #D5E4F3 130%);
        } 
    </style>
  
    <script type="text/javascript">
        var geocoder;
        var map;
        var infowindow = new google.maps.InfoWindow();
        var places = [];
        var title_content = new Array();
        var popup_content = new Array();
        var address = new Array();
        var address_position = 0;
        var timeout = 600;
      
        function initialize(){
            geocoder = new google.maps.Geocoder();
            var latlng = new google.maps.LatLng(29.01, 77.38);
            var myOptions = {
                zoom: 2,
                center: latlng,
                mapTypeId: 'roadmap'
            }
            <!--alert({!listsize});-->
            <apex:repeat value="{!AllSearchRecords}" var="Warehouse">
                
                title_content.push(
                
                    "SAP Code: {!Warehouse.WU_SAPCode_s__c}"
                    
                );                
               
                address.push(
                    "{!Warehouse.WU_Region__c}," + 
                    "{!Warehouse.WU_CityName__c}," +
                    "{!Warehouse.WU_Country__c}"
                );
               
                popup_content.push(
                    "<b>City:</b> {!Warehouse.WU_CityName__c}"+
                    "<br/><b>Country:</b> {!Warehouse.WU_Country__c}"+
                    "<br/><b>MCO:</b> {!Warehouse.WU_MCO__c}"+
                    "<br/><b>Site:</b> {!Warehouse.WU_Network__c}"+
                    "<br/><b>Inhouse Or 3PL Managed:</b> {!Warehouse.WU_SAPCode_s__c}"+
                    "<br/><b>Product Categories:</b> {!Warehouse.WU_SAPCode_s__c}"+
                    "<br/><b>UL Owned facility Or 3PL:</b> {!Warehouse.WU_SAPCode_s__c}"+
                    "<br/><b>WH Type:</b> {!Warehouse.WU_SAPCode_s__c}"+
                    "<br/><b>WH Available Capacity (Pallets):</b> {!Warehouse.WU_Average_Pallet_Utilization_Count__c}"+
                    "<br/><b>Current Pallet Utilization Count:</b> {!Warehouse.WU_Current_Utilization__c}"
                );
            </apex:repeat>
            
            map = new google.maps.Map(document.getElementById("map"), myOptions);
            addMarker(address_position);
        }      
      
        function addMarker(position){
            geocoder.geocode(
                {
                    'address': address[position]
                }, 
                function(results, status){
                    if (status == google.maps.GeocoderStatus.OK) {
                        places[position] = results[0].geometry.location;
                        
                        var marker = 
                            new google.maps.Marker(
                                {
                                    position: places[position],
                                    title:title_content[position],
                                    map: map
                                }
                            );
      
                        google.maps.event.addListener(
                            marker, 
                            'click', 
                            function() {
                                if (!infowindow) {
                                    infowindow = new google.maps.InfoWindow();
                                }
                                infowindow.setContent(popup_content[position]);
                                infowindow.open(map, marker);
                            }
                        );
                    }
                    else{
                        if (status == google.maps.GeocoderStatus.OVER_QUERY_LIMIT){
                            setTimeout(
                                function() { 
                                    addMarker(position); 
                                }, 
                                (timeout * 3)
                            );
                        }
                    }
                    
                    address_position++;
                    
                    if (address_position < address.length){
                        setTimeout(
                            function() { 
                                addMarker(address_position); 
                            }, 
                            (timeout)
                        );
                    }
                }
            );
        }
    </script>
  
    <div id="map" class="roundCornerCss"></div> 
    <script>
         initialize();
    </script>

</apex:form>  
</apex:page>