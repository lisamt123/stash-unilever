<apex:page standardController="VPM_PurchasingRequests__c"  sidebar="false" >
    <apex:stylesheet value="{!URLFOR($Resource.vpmbootstrapresources, 'vpmbootstrapresources/bootstrap.css')}" />
<apex:stylesheet value="{!URLFOR($Resource.vpmstyles, 'vpmstyles.css')}" />
<apex:stylesheet value="{!URLFOR($Resource.vpmadvancedformcss)}" />
<apex:includeScript value="{!$Resource.vpmjqueryresources}"/>
<apex:includeScript value="{!URLFOR($Resource.vpmjqueryresources, 'vpmjqueryresources/jquery-1.12.2.min.js')}"/>
<script type = "text/javascript">
     $(document).ready(function(){
        var criteria1 = "{!VPM_PurchasingRequests__c.VPM_Status__c}"; 
        var Islock = "{!VPM_PurchasingRequests__c.VPM_IsLock__c}";
         
         if(criteria1!="FLS Approved" && criteria1!="Draft Request"){
            $('link[href*="vpmadvancedformcss"]').remove();
            $('link[href*="bootstrap"]').remove();
            $('link[href*="vpmstyles"]').remove();
         }
        if(criteria1=="FLS Review") {
            alert("Please Approve / Reject the Request before completing the Advanced Form");
        }
        else if (!Islock)
        {
            alert('Record is in Approval...');
            //return false;
        }
        else if(criteria1=='FLS Approved' || criteria1 =='Draft Request') {  
        //navigateToUrl('flow/VPM_PurchasingRequestAdvancedForm?VPM_PurchasingRequestID={!VPM_PurchasingRequests__c.Id}'); 
        //window.location = 'apex/VPM_AdvancedForm';
               domManipulations();
        }
    });
    function domManipulations(){
        var el = $('tr>td.pbTitle');
        var savedRow = '';
        var numberOfTextFields = $('.detailList input[type="text"]').length;
        var spanToAlign = $('span[id*="VPM_MaintainTypeInfo"]');
        var maintainRadioBtns =$('span[id*="VPM_MaintainTypeInfo"]').length>0 ? $('span[id*="VPM_MaintainTypeInfo"]') : $('span[id*="VPM_Maintain2TypeInfo"]');
        var vendorDetailHeader = $('span[id*="VPM_CreateVendorDetailInfo"]');
        var maintainVendorHeader= $('span[id*="VPM_Maintain1VendorDetailsScreenInfo"]');
        
        $("#01r190000000Jj6_Tab").css("background-color","#0275D8");
        $('input[type="button"],input[type="submit"],button').addClass("btn-primary");
        $(vendorDetailHeader).find("b").addClass('emphasizeHeader');
        $(maintainVendorHeader).find("b").addClass('emphasizeHeader');
        $(".FlowPageBlockBtns").siblings().remove();
        /*  to align status and type side by side instead of one stacking both one above the other  */
        $(spanToAlign).css("float","left");
        var allDivs =$(spanToAlign).find('div');
        if($(allDivs[2]).find('font').text().indexOf('Status')!=-1)
            $(allDivs[2]).css({"float":"left"},{"margin-left":"6em"});
         
         if($(".interviewDisplayTextRow b").text().indexOf("Type") > -1){
                savedRow = $(".interviewDisplayTextRow")[1];
                $(".interviewDisplayTextRow")[1].remove();
             $(savedRow).insertBefore($(".interviewDisplayTextRow")[0]);
             $($(".interviewDisplayTextRow")[0]).css("display","table-cell");
            
             }
         if($(maintainRadioBtns).find("span").text().indexOf("Maintain") > -1){
            savedRow = $(maintainRadioBtns).find("span");
            if($(maintainRadioBtns).find("div").text().indexOf("Status") > -1){
                $(savedRow).insertBefore($(maintainRadioBtns).find("div:last-child"));
            }
            $(maintainRadioBtns).find("div:nth-child(3)").addClass("statusAlignment");
            $(maintainRadioBtns).find("span").addClass("typeAlignment");
              if($(".interviewDisplayTextRow font").text().indexOf("Extend") > -1){
                    $($(".interviewDisplayTextRow")[1]).css({"float": "right",
                                                          "position": "relative",
                                                          "right": "22.5em"});
             }
            else{
                 $(maintainRadioBtns).find("span").css({"left":"12em","top":"-1em"});
            }
        }
        
        /*  *****  */
        /* to divide fields into 2 columns */
        if(numberOfTextFields > 10){
            var remainingRows = [];
            var toRemove ='';
            for(var i=(Math.round(numberOfTextFields/2));i<numberOfTextFields;i++){
                toRemove = $('.detailList input[type="text"]')[i]; 
                remainingRows.push($(toRemove).parent().parent());
            }

            for(var j=0,i=2;j<remainingRows.length,i<$('.detailList tr').length;j++,i++){
                 var row = ($('.detailList tr')[i]);
                 $(row).find(".labelCol.last.empty").remove();
                 $(row).find(".dataCol.last.empty").remove();
                 if(remainingRows[j] && remainingRows[j].children()){
                    $(row).append(remainingRows[j].children());
                 }
            }
        }
        /*  *****  */
         /*  Change text of 'Previous Button'   */
         var buttonLength = $('input[type="submit"],input[type="button"],button').length;
         for(var i=0;i<buttonLength;i++){
            if($('input[type="submit"],input[type="button"],button')[i].value == 'Previous')
                $('input[type="submit"],input[type="button"],button')[i].value = 'Menu/Previous';                
         }
        /*  *****  */
    }
    function openPopup(page){
        window.open('/apex/VPM_AttachmentSectionPopUp','Table','toolbar=yes, scrollbars=no, toolbar=no, menubar=no, height=500,width=1230, top=70, left=70');
        return false;
    }
    </script>
<flow:interview name="VPM_PurchasingRequestAdvanceForm" finishLocation="/{!VPM_PurchasingRequests__c.Id}">
        <apex:param name="VPM_PurchasingRequestID" value=""/>    
</flow:interview>
<div>
    <apex:outputLink onclick="openPopup('{!$Page.VPM_AttachmentSectionPopUp}');return false;">Help for uploading documents</apex:outputLink>
    </div>

</apex:page>