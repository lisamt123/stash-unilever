<!--
*************************************************************
*@Description: Page To add / Edit Milestones for any project.
*@Author: Cognizant
*@Created Date: 17/02/2015
*@Copyright ï¿½ 2015  Unilever  
*************************************************************
-->
<apex:page standardController="IPM_Milestone__c" extensions="IPM_Milestone,IPM_GetHelpDoc"  sidebar="false" standardStylesheets="true" showHeader="false">    
    <apex:stylesheet value="{!URLFOR($Resource.IPM_Resource, 'css/bootstrap.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.IPM_Resource, 'css/IPM_Buttons.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.IPM_Resource, 'assets/font-awesome/css/font-awesome.min.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.IPM_Resource, 'css/IPM_EditMilestoneWizard.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.IPM_Resource, 'css/datepicker.css')}"/>   
    <apex:stylesheet value="{!URLFOR($Resource.IPM_Resource, 'css/IPM_HomePage.css')}"/>     
    <div class="container-fluid">
        <div class="row" id="EditTask">
            <apex:form id="form">
                <apex:pageMessages id="messages"/> 
                <!-- Milestone name will be editable for Adhoc Milestone --> 
                <div class="row inlineEdit">
                    <div class="col-xs-3">
                            <apex:outputPanel rendered="{!!editMsNameFlag}">
                                <apex:outputField id="mName" value="{!milestoneObj.IPM_Name__c}"  styleClass="fieldFont" />
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!editMsNameFlag}">
                                <apex:inputField value="{!milestoneObj.IPM_Name__c}"  styleClass="fieldFont" />
                            </apex:outputPanel> 
                    </div>
                    <!-- Milestone Phase name will be editable for Adhoc Milestone -->
                    <div class="col-xs-offset-2 col-xs-2 mPhaseEditDiv">
                            <apex:outputPanel rendered="{!!editPhaseFlag}">
                                <apex:outputField id="mPhase" value="{!milestoneObj.IPM_Phase__c}" styleClass="fieldFont mPhaseEdit"/>
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!editPhaseFlag}">
                                <apex:inputField value="{!milestoneObj.IPM_Phase__c}" styleClass="fieldFont mPhaseEdit"/>
                            </apex:outputPanel>
                    </div>
                    <!--------- Milestone Due date column  ----------->
                    <div class="col-xs-1 dateDropDown">
                        <div class="inputField">
                            <apex:inputField value="{!milestoneObj.IPM_Due_Date__c}" id="DateP" styleClass="dateInputBox calendar marginL100P">
                            </apex:inputField>                     
                        </div>
                    </div>
                    <!-- To place the help symbol in the top right hand corner of page -->
                    <apex:outputPanel layout="block" styleClass="SecButtonSet delete pull-right" >
                        <apex:outputLink value="{!URL}" id="theLink" styleClass="icoButton question" target="_blank" title="{!$Label.IPM_Help}">?</apex:outputLink>
                    </apex:outputPanel>     
                    <div class="buttonmarRight ipmButtonGroup pull-right"> 
                        <div class="pull-right"> 
                            <apex:commandLink value="{!$Label.IPM_CANCEL}" styleClass="ipmButton buttonmarRight" onClick="pageclose();"/>  
                            <!------ Save button while editing milestones  -->
                            <apex:commandLink value="{!$Label.IPM_SAVE}" styleClass="ipmButton green" action="{!saveMilestones}" reRender="messages,form,displaymessage"  rendered="{!AND( OR(adhocmilestoneFlag, miniMilestoneFlag),milestoneFlag)}"  oncomplete="{!if(validateSuccess,'pageclose();','')}" />
                            <!-- Save button while editing current standard milestone -->
                            <apex:commandLink value="{!$Label.IPM_SAVE}" styleClass="ipmButton green" action="{!promptForTaskUpdate}" reRender="messages,form,displaymessage"  rendered="{!AND(stndMilestoneFlag, milestoneFlag)}" oncomplete="{!if(validateSuccess,'pageclose();','')}" />                                                 
                        </div> 
                    </div>
                </div>               
            </apex:form>            
            <apex:form >
            	<!------ Below code is to prompt user to update the task while updating the curent phase of standard milestone --------->
                <apex:outputPanel id="displaymessage">
                    <apex:outputPanel styleClass="popupBg" layout="block" rendered="{!displayPopUp}"/>
                    <apex:outputPanel styleClass="popup" layout="block" rendered="{!displayPopUp}">
                        <div class="buttonMarginRight popupContent ipmButtonGroup noPadding">
                            <span class="buttonMarginRight">{!$Label.IPM_DO_WE_NEED_TO_UPDATE_TASKS}</span>
                            <apex:commandLink value="{!$Label.IPM_CONFIRM_MODAL_NO}" styleClass="ipmButton grey buttonMarginRight" action="{!saveMilestones}" rerender="displaymessage" oncomplete="{!if(validateSuccess,'pageclose();','')}" />
                            <apex:commandLink value="{!$Label.IPM_CONFIRM_MODAL_YES}" styleClass="ipmButton green" action="{!saveMilestoneAndTasks}" rerender="displaymessage" oncomplete="{!if(validateSuccess,'pageclose();','')}" />
                        </div> 
                        <div class="ipmButtonGroup pull-center"></div>
                    </apex:outputPanel>
                </apex:outputPanel>
                <apex:outputPanel id="popup"> 
                    <apex:outputPanel styleClass="popupBg" layout="block" rendered="{!displayPopUp}"/>
                    <apex:outputPanel styleClass="popup" layout="block" rendered="{!displayPopUp}">
                        <div class="popupContent">{!$Label.IPM_DO_YOU_WANT_TO_CRT_PRO_RESOURCE}
                        </div>
                        <div class="ipmButtonGroup pull-center"></div>
                    </apex:outputPanel>
                </apex:outputPanel>
            </apex:form>
        </div>
    </div>  
    <script src="{!URLFOR($Resource.IPM_Resource, 'js/jquery.js')}" type="text/javascript"></script>
    <script src="{!URLFOR($Resource.IPM_Resource, 'js/bootstrap.min.js')}" type="text/javascript"></script>
    <script src="{!URLFOR($Resource.IPM_Resource, 'js/bootstrap-datepicker.js')}" type="text/javascript"></script>
    <script src="{!URLFOR($Resource.IPM_Resource, 'js/IPM_EditMstoneWizard.js')}" type="text/javascript"></script> 
    <script>
    var IPMAppWizard = {ProjectWizard:'{!JSINHTMLENCODE(ProjectWizard)}', projectId:'{!projectId}', ProjectSetupUrl:'{!$Page.IPM_ProjectSetUpView}' };
        document.getElementById('{!$Component.mName}').disabled = {!if(milestoneObj.IPM_Type_of_Milestone__c == 'Standard',true,false)};
        document.getElementById('{!$Component.mPhase}').disabled = {!if(milestoneObj.IPM_Type_of_Milestone__c == 'Standard',true,false)};
        document.getElementById('{!$Component.DateP}').disabled = {!if(AND(milestoneObj.IPM_Type_of_Milestone__c == 'Standard',IsDateEdit='false'),'true','false')}; 
    </script>
</apex:page>
