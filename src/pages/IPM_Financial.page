<!-- 
************************************************************************************
*@Description: To manage and display the financials  associated with the IPM project 
*@Author: Cognizant
*@Created Date: 13/05/2015             
*@Copyright Â© 2015  Unilever  
************************************************************************************
-->
<apex:page controller="IPM_FinancialController" sidebar="false" standardStylesheets="false" extensions="IPM_GetHelpDoc">   
    <apex:stylesheet value="{!URLFOR($Resource.IPM_Resource, 'css/IPM_Filter.css')}"/>  
    <apex:stylesheet value="{!URLFOR($Resource.IPM_Resource, 'css/IPM_Financial.css')}"/>
    <apex:composition template="IPM_TemplateRevamp">
        <apex:define name="body">
            <apex:form >
                <apex:pageMessages />
                <div class="gradientbg">                  
                        <c:IPM_ProjectDetails project="{!project}" activeItem="rolloutPlan"/>                   
                </div>    
                <!--------------------------------------------- Page Head & Toolbar ----------------------------------------------->
                <div class="row finwrapper">
                    <div class="col-sm-12">
                        <div class="panel-group pageHeadToolbar clearfix">
                            <div class="row">
                                <!-- To place the help symbol in the top right hand corner of page -->
                                 <apex:outputPanel layout="block" styleClass="SecButtonSet delete pull-right" >
                                    <apex:outputLink value="{!URL}" id="theLink" styleClass="icoButton question" target="_blank" title="{!$Label.IPM_Help}">?</apex:outputLink>
                                </apex:outputPanel> 
                                <div class="finTitle pull-left">
                                    <h2 class="pageTitle">{!$Label.IPM_FINANCIALS}</h2> 
                                </div>
                                <apex:outputPanel layout="block" styleClass="whiteSpace pull-left" rendered="{!(project.IPM_White_Space_Project__c)}">
                                   <span>{!$Label.IPM_Whitespace_Financials}</span> 
                                </apex:outputPanel>                                 
                                <div class="col-sm-7 pull-right clearfix">
                                     
                                    <div class="SecButtonSet pull-right">
                                        <apex:outputPanel layout="block" styleClass="copyFBC" rendered="{!AND(isEditable,NOT(isRolloutError))}">
                                            <apex:commandbutton value="Copy from FBC xls" action="{!CopyPasteTemplate}" styleClass="ipmButton primary" title="Copy Paste Financial Update" rendered="true"/>
                                        </apex:outputPanel>
                                        <!-- 
                                        <apex:outputPanel rendered="{!AND(NOT(isError),project.IPM_Phase__c <> 'PLE')}">
                                            <apex:commandLink action="{!uploadDownloadTemplate}" styleClass="icoButton download" title="{!$Label.IPM_FINANCIALS}" rendered="{!IF($ObjectType.IPM_Financial__c.updateable, IF(AND(project.IPMProject_Span__c == 'Global', project.IPM_Phase__c <> 'Ideas'), false, AND(NOT(isEditMode))), false)}"/>
                                        </apex:outputPanel>
                                         -->
                                    </div>
                                </div>                                                                  
                            </div>
                        </div>
                    </div>
                </div>
                <!-------------------------------------------------/ Page Head & Toolbar ------------------------------------------------>
                <apex:outputPanel id="errorPanel" rendered="{!AND(project.IPM_Project_Type__c != 'Operational',project.IPMProject_Span__c != 'Local' ,(isError))}">
                    <div class="finGreyBG">
                        <apex:outputText value="{!errorMessage}"/>
                        
                    </div>
                    <apex:outputPanel rendered="{!isRolloutError}">
                        <div class="finErrMsg">
                            {!$Label.IPM_PLEASE_NAVIGATE_TO} <a href="{!URLFOR($Page.IPM_RolloutPlans,null,[id=project.Id])}">{!$Label.IPM_ROLLOUTS}</a> {!$Label.IPM_START_ADD_ROLLOUT}
                        </div>                        
                    </apex:outputPanel>
                </apex:outputPanel>
                <div class="row">
                    <div class="col-sm-12">
                        <div class="panel-group pageContent clearfix">
                            <!-------------------------------------- SIDE PANEL ----------------------------->
                         <apex:outputPanel id="rolloutPanel" rendered="{!AND(project.IPM_Project_Type__c != 'Operational' ,NOT(isError))}" layout="block" styleClass="col-sm-2 pull-left leftSideBar noPadleft noPadright">     
                            <apex:outputText rendered="{!AND(project.IPM_Project_Type__c != 'Operational' ,NOT(isError))}">
                                <div class="finArrow"><span class="fa fa-angle-left"></span></div>
                            </apex:outputText>
                            <div class="finFilter">
                                   <div class="ipmAccordion">
                                      <div class="projectContainer">   
                                         <apex:outputPanel layout="block" styleClass="pHead" rendered="{!AND(project.IPMProject_Span__c == 'Global',renderMapGlobal)}">
                                              <div class="filterTitle {!IF(currentFinancialId == mapConsolidatedFinancials['Global'].Id, 'selected', '')}" >  
                                                    <span class='expico fa fa-minus'></span>
                                                    <apex:commandLink value="Global" action="{!refreshFinancials}" reRender="rolloutPanel,tabContentPanel" rendered="{!AND(project.IPMProject_Span__c == 'Global')}" status="loadingStatus" oncomplete="finScriptCallBack()">
                                                        <apex:param name="currentFinancialId" value="{!mapConsolidatedFinancials['Global'].Id}" assignTo="{!currentFinancialId}"/>
                                                    </apex:commandLink>
                                                </div> 
                                             </apex:outputPanel>
                                            <div class="ipmAcrdnExpand"> 
                                               <ul class="docFilter accordionFilters">
                                                   <apex:repeat value="{!lstRolloutWrappers}" var="rolloutWrapper">
                                                   <li>
                                                       <div class="projectContainer">
                                                            <div class="pHead accrHead filterSubTitle {!IF(currentFinancialId == mapConsolidatedFinancials[rolloutWrapper.regionName].Id, 'selected', '')}">
                                                            <apex:outputText rendered="{!project.IPMProject_Span__c != 'Local'}" >
                                                                <span class='expico-square fa fa-minus'></span>
                                                                    <apex:commandLink value="{!rolloutWrapper.regionName}" action="{!refreshFinancials}" reRender="rolloutPanel,tabContentPanel" rendered="{!if(project.IPMProject_Span__c != 'Local',true,false)}" status="loadingStatus" oncomplete="finScriptCallBack()">
                                                                        <apex:param name="currentFinancialId" value="{!mapConsolidatedFinancials[rolloutWrapper.regionName].Id}" assignTo="{!currentFinancialId}"/>
                                                                    </apex:commandLink>
                                                             </apex:outputText>        
                                                            </div> 
                                                            <div class="ipmAcrdnExpand"> 
                                                             <ul class="docFilter accordionFilters">
                                                                    <apex:repeat value="{!rolloutWrapper.lstFinancials}" var="financial">  
                                                                        <li class="{!IF(financial.Status__c == $Label.IPM_SUBMITTED, $Label.IPM_SUBMIT_CODE, IF(financial.Status__c == $Label.IPM_IN_PROGRESS, $Label.IPM_PROGRESS_CODE, $Label.IPM_NOT_STARTED_CODE))} {!IF(currentFinancialId == financial.Id, $Label.IPM_Selected, '')} finRecord">
                                                                            <div class="incHeight" id="flagID">              
                                                                                <span class="key wordwrap">
                                                                                    <apex:image styleClass="wid26" value="{!URLFOR($Resource.IPM_Resource, 'images/flag.svg')}" rendered="{!IF(AND(NOT(CONTAINS(financial.Financial_External_ID__c, '_NONKEY')),project.IPM_Phase__c == 'Ideas'), TRUE, FALSE)}"/>
                                                                                </span>
                                                                            
                                                                            <apex:commandLink value="{!financial.Financial_External_ID__c}" action="{!refreshFinancials}" reRender="rolloutPanel,tabContentPanel,flagID" status="loadingStatus" oncomplete="finScriptCallBack()">
                                                                                <apex:param name="currentFinancialId" value="{!financial.Id}" assignTo="{!currentFinancialId}"/>
                                                                            </apex:commandLink>
                                                                            </div>
                                                                        </li>           
                                                                   </apex:repeat>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </li>
                                                    </apex:repeat>
                                                </ul>
                                            </div>   
                                        </div>
                                    </div>
                                    <div class="finLegends">
                                        <p><i class="fa fa-minus progresstatus"></i> {!$Label.IPM_IN_PROGRESS}</p>
                                        <p><i class="fa fa-minus notstarted"></i> {!$Label.IPM_NOT_STARTED}</p>
                                        <p><i class="flag"></i> Key Country</p>                                        
                                    </div>
                                
                            </div>
                            </apex:outputPanel>
                            <!----------------------------------------------------- MAIN PANEL ------------------------------------------->
                            <div class="{!IF(project.IPM_Project_Type__c != 'Operational','col-sm-10','col-sm-12')} pull-right tempWrapper finTableData">                               
                               
                                <div class="row">                                                           
                                    <div class="col-sm-12 noPadright">                    
                                        <div class="panel">
                                            <div role="tabpanel" class="tab-panel">
                                                 
                                                <!-------------------------------------------- Nav tabs ------------------------------------>
                                                <apex:outputText rendered="{!NOT(isError)}">
                                                <div class="clearfix ipmFinancialNavbarDiv">
                                                <div class="col-xs-9 noPadright noPadleft">
                                                
                                                    <nav class="navbar navbar-default" role="navigation">
                                                        <div class="collapse navbar-collapse ipmFinancialNavbar">
                                                            <ul class="nav navbar-nav finNavTab" role="tablist">
                                                                <li role="presentation" class="tabOdd active">
                                                                    <a href="#myView" aria-controls="myView" role="tab" data-toggle="tab" onclick="changeTabs('myview');"><span>{!tabLabelMyView}</span></a>
                                                                </li>
                                                                <apex:outputText rendered="{!showTopDownTab}">
                                                                    <li role="presentation" class="tabEven">
                                                                        <a href="#topDown" aria-controls="topDown" role="tab" data-toggle="tab" onclick="changeTabs('topdown');"><span>{!tabLabelTopDown}</span></a>
                                                                    </li>
                                                                </apex:outputText>
                                                                <apex:outputText rendered="{!showRollupTab}">
                                                                    <li role="presentation" class="tabOdd">
                                                                        <a href="#rollup" aria-controls="rollup" role="tab" data-toggle="tab" onclick="changeTabs('rollup');"><span>{!tabLabelRollup}</span></a>
                                                                    </li>
                                                                </apex:outputText>
                                                            </ul>
                                                        </div>
                                                    </nav>
                                                </div>
                                                <div class="col-xs-3 finDropdown noPadright noPadleft pull-right">
                                                    <div class="inputField blockPos">
                                                        <apex:outputText rendered="{!NOT(isError)}">
                                                            <div class="requiredInput">
                                                                <div class="requiredBlock"></div>
                                                                <apex:selectList styleClass="fieldFont drpfield" value="{!selectedDocumentSection}" multiselect="false" size="1">
                                                                    <apex:selectOptions value="{!documentSections}" />
                                                                    <apex:actionSupport event="onchange" action="{!goToSection}" status="loadingStatus"/>
                                                                </apex:selectList>
                                                            </div>    
                                                        </apex:outputText>
                                                    </div> 
                                                </div>
                                                </div>
                                                </apex:outputText>
                                                <apex:actionFunction name="changeTabs" action="{!changeTabs}" reRender="rolloutPanel,tabContentPanel,headerPanel" status="loadingStatus" oncomplete="finScriptCallBack()">
                                                    <apex:param name="currentTab" value="" assignTo="{!currentTab}"/>
                                                </apex:actionFunction>
                                                <!------------------------------------------------- Tab Content ------------------------------------------->
                                                <apex:outputPanel layout="block" id="tabContentPanel" rendered="{!NOT(isError)}">
                                                    <div class="tab-content">
                                                        <!-- My View Tab -->
                                                        <div class="col-sm-6">
                                                                <div class="ipmfinHeading1">Financial Business Case - {!currentFinancial.Display_Name__c}</div>                                                                                                                             
                                                         </div>
                                                            <div role="tabpanel" class="tab-pane {!IF(currentTab == 'myview', 'active', '')}" id="myView">
                                                            <!-- Project Name Header -->
                                                            <div class="row">
                                                             
                                                                <div class="col-sm-6 noPadleft finBtnDiv finTabHeaderExt">
                                                                    <!-- Variables -->
                                                                    <apex:variable value="{!IF(CONTAINS(currentFinancial.Financial_External_ID__c, '_CONSOLIDATED'), TRUE, FALSE)}" var="isConsolidated"/>
                                                                    
                                                                    <apex:outputPanel rendered="{!AND(currentFinancial.Misaligned__c,showMisalignment, NOT(isEditMode), NOT(isConsolidated), project.IPMProject_Span__c == 'Regional', isEditable)}">
                                                                        <div class="ipmButton secondary confirmAction" data-target="#ipmDeleteModal" data-toggle="modal" data-backdrop="static" data-keyboard="false" onclick="refreshFromLocalJs('{!$Label.IPM_OVERWRITE_FIN_BUSINESS_CASE}', '{!$Label.IPM_ABOUT_TO_REFRESH_LOC_FIN_BUSINESS_CASE}');">{!$Label.IPM_ACCEPT_LOCAL_BC}</div>
                                                                        <apex:actionFunction name="refreshFromLocal" action="{!refreshFromLocal}" reRender="tabContentPanel" status="loadingStatus" oncomplete="finScriptCallBack()"/>
                                                                    </apex:outputPanel>
                                                                    
                                                                    <apex:outputPanel rendered="{!AND(currentFinancial.Misaligned__c,showMisalignment, NOT(isEditMode), NOT(isConsolidated), project.IPMProject_Span__c == 'Local', isEditable)}">
                                                                        <div class="ipmButton secondary confirmAction" data-target="#ipmDeleteModal" data-toggle="modal" data-backdrop="static" data-keyboard="false" onclick="refreshFromRegionalJs('{!$Label.IPM_OVERWRITE_FIN_BUSINESS_CASE}', '{!$Label.IPM_ABOUT_TO_REFRESH_REG_FIN_BUSINESS_CASE}');">{!$Label.IPM_ACCEPT_REGIONAL_BC}</div>
                                                                        <apex:actionFunction name="refreshFromRegional" action="{!refreshFromRegional}" reRender="tabContentPanel" status="loadingStatus" oncomplete="finScriptCallBack()"/>
                                                                    </apex:outputPanel>
                                                        
                                                                    <apex:outputPanel rendered="{!IF($ObjectType.IPM_Financial__c.updateable, IF(AND(project.IPMProject_Span__c == 'Global', project.IPM_Phase__c <> 'Ideas'), false, AND(NOT(isEditMode))), false)}">
                                                                        
                                                                        <apex:outputPanel rendered="{!AND(isEditable,project.IPM_Phase__c <> 'PLE',project.IPM_Project_Type__c != 'Operational')}">
                                                                         <div class="ipmButton primary" onclick="editRecord();">{!$Label.IPM_EDIT}</div>
                                                                        <apex:actionFunction name="editRecord" action="{!editFinancials}" reRender="tabContentPanel" status="loadingStatus" oncomplete="finScriptCallBack()">
                                                                            <apex:param name="isEditMode" value="true" assignTo="{!isEditMode}"/>
                                                                        </apex:actionFunction>
                                                                        </apex:outputPanel>
                                                                    </apex:outputPanel>
                                                                        
                                                                    <apex:outputPanel rendered="{!AND($ObjectType.IPM_Financial__c.updateable,NOT(isEditMode))}">   
                                                                        <apex:outputPanel rendered="{!AND(isEditable,project.IPM_Phase__c <> 'PLE',project.IPM_Project_Type__c == 'Operational')}">
                                                                         <div class="ipmButton primary" onclick="editRecord();">{!$Label.IPM_EDIT}</div>
                                                                        <apex:actionFunction name="editRecord" action="{!editFinancials}" reRender="tabContentPanel" status="loadingStatus" oncomplete="finScriptCallBack()">
                                                                            <apex:param name="isEditMode" value="true" assignTo="{!isEditMode}"/>
                                                                        </apex:actionFunction>
                                                                       </apex:outputPanel>
                                                                   </apex:outputPanel> 
                                                        
                                                                    <apex:outputPanel rendered="{!IF($ObjectType.IPM_Financial__c.updateable, isEditMode, false)}">
                                                                        <div class="ipmButton" onclick="cancel();">{!$Label.IPM_CANCEL}</div>
                                                                        <apex:actionFunction name="cancel" reRender="rolloutPanel,tabContentPanel" status="loadingStatus" oncomplete="finScriptCallBack()">
                                                                            <apex:param name="isEditMode" value="false" assignTo="{!isEditMode}"/>
                                                                        </apex:actionFunction>
                                                        
                                                                        <div class="ipmButton primary" onclick="saveRecord();">{!$Label.IPM_SAVE}</div>
                                                                        <apex:actionFunction name="saveRecord" action="{!saveFinancials}" reRender="errorPanel,rolloutPanel,tabContentPanel" status="loadingStatus" oncomplete="finScriptCallBack()">
                                                                            <apex:param name="isEditMode" value="false" assignTo="{!isEditMode}"/>
                                                                        </apex:actionFunction>
                                                                    </apex:outputPanel>
                                                                </div>
                                                                <apex:outputText rendered="{!IF(AND( NOT(project.Sustainability_Period_Changed__c), (project.IPM_Phase__c == 'Ideas'),isEditable=true), TRUE, FALSE)}">
                                                                    <div class="sdropDownDiv">
                                                                        <div>{!$Label.IPM_SELECT_SUSTAINABILITY_PERIOD}</div>
                                                                        <div class="requiredInput">
                                                                            <div class="requiredBlock"></div>
                                                                            <apex:selectList styleClass="fieldFont drpfield" value="{!selectedSustainabilityPeriod}" multiselect="false" size="1" disabled="{!NOT(isEditable)}">
                                                                                <apex:selectOptions value="{!lstSustainabilityPeriod}" />
                                                                                <apex:actionSupport event="onchange" action="{!changeSustainabilityPeriod}" rerender="tabContentPanel,pollerPanel" status="loadingStatus" oncomplete="finScriptCallBack()"/>
                                                                            </apex:selectList>
                                                                        </div>
                                                                    </div>
                                                                </apex:outputText>
                                                                <apex:outputPanel rendered="{!IF(OR(project.Sustainability_Period_Changed__c, (project.IPM_Phase__c != 'Ideas')), TRUE, FALSE)}">
                                                                    <div class="sdropDownDiv">
                                                                        {!$Label.IPM_Sustainability_Period}
                                                                        <apex:outputText value="{!project.Sustainability_Period__c}" />
                                                                    </div>
                                                                </apex:outputPanel>
                                                                <apex:outputPanel id="pollerPanel" rendered="{!sustainabilityPeriodChanging}">
                                                                    <div class="sdropDownDiv">
                                                                        <apex:actionPoller action="{!checkSustainabilityPeriodChanged}" rerender="tabContentPanel,pollerPanel" interval="15" oncomplete="finScriptCallBack()" />
                                                                        {!$Label.IPM_WAIT_WHILE_SUSTAINABILITY_PERIOD_CHANGING}
                                                                    </div>
                                                                </apex:outputPanel>
                                                            </div> 
                                                            
                                                             <apex:outputText rendered="{!AND(NOT(showTopDownTab),NOT(showRollupTab),(associatedCountryList.size >0))}">
                                                             <div class="countryListDiv">
                                                                <apex:outputPanel styleClass="countryLabel" rendered="{!associatedCountryList.size >0 }">{!$Label.IPM_RolloutCountriesLabel}</apex:outputPanel>
                                                                    <div class="countryCheckList clearfix">
                                                                        <apex:variable value="{!1}" var="rowNum"/>
                                                                        <apex:repeat value="{!associatedCountryList}" var="clist" rendered="{!associatedCountryList.size >0}" >
                                                                            <apex:inputCheckbox value="{!clist.Calculation_Index__c}" onchange="UpdateCheckbox('{!clist.ID}',this.checked )" disabled="{!Or(project.IPM_Phase__c <> 'Ideas',!isEditable)}"/>
                                                                            <label>{!clist.Country_Name__c}</label>                                                                                                                          
                                                                        <apex:variable var="rowNum" value="{!rowNum + 1}"/>
                                                                    </apex:repeat>
                                                              </div>
                                                             </div>
                                                            </apex:outputText>
     
                                                             <c:IPM_FinancialTabHeader ipmFinancial="{!currentFinancial}" fieldSuffix="{!fieldSuffix}" /> 
                                                             <apex:actionFunction name="ActionUpdate" oncomplete="" action="{!updateCountry}">  
                                                                      <apex:param name="country" value="" assignTo="{!Country}"/>  
                                                                      <apex:param name="check" value="" assignTo="{!CheckCountry}"/> 
                                                                </apex:actionFunction>
                                                                
                                                               
                                                                
                                                                <c:IPM_FinancialTable ipmFinancial="{!currentFinancial}"
                                                                    finWrapper="{!financialsInnovation}"
                                                                    colSpan="{!colSpan}"
                                                                    sustainabilityPeriod="{!sustainabilityPeriod}"
                                                                    isInnovation="TRUE"
                                                                    isEditMode="{!isEditMode}"
                                                                    showMisalignment="{!showMisalignment}"
                                                                    fieldSuffix="{!fieldSuffix}"                                                                    
                                                                    isy0TurnoverInvalid="{!isy0TurnoverInvalid}"
                                                                    isValidationError="{!isValidationError}"
                                                                    validationErrorMessage="{!validationErrorMessage}"
                                                                    isy0GrossProfitInvalid="{!isy0GrossProfitInvalid}"
                                                                    isy0ProfitInvalid="{!isy0ProfitInvalid}"
                                                                    
                                                                />
                                                        
                                                                <c:IPM_FinancialSummaryTable ipmFinancial="{!currentFinancial}"
                                                                    fieldSuffix="{!fieldSuffix}"
                                                                    isEditMode="{!isEditMode}"
                                                                    showMisalignment="{!showMisalignment}"
                                                                />
                                                        
                                                                <c:IPM_FinancialTable ipmFinancial="{!currentFinancial}"
                                                                    finWrapper="{!financialsCalendar}"
                                                                    colSpan="{!colSpan}"
                                                                    sustainabilityPeriod="{!sustainabilityPeriod}"
                                                                    isInnovation="FALSE"
                                                                    isEditMode="{!isEditMode}"
                                                                    showMisalignment="{!showMisalignment}"
                                                                    fieldSuffix="{!fieldSuffix}"                                                                    
                                                                    isy0TurnoverInvalid="{!isy0TurnoverInvalid}"
                                                                    isValidationError="{!isValidationError}"
                                                                    validationErrorMessage="{!validationErrorMessage}"
                                                                    isy0GrossProfitInvalid="{!isy0GrossProfitInvalid}"
                                                                    isy0ProfitInvalid="{!isy0ProfitInvalid}"
                                                                />
                                                        </div>

                                                        <!-- Top Down Summary Tab -->
                                                        <apex:outputText rendered="{!IF(currentTab == 'topdown', 'true', 'false')}">
                                                          
                                                            <div class="countryListDiv">
                                                                    <apex:outputPanel styleClass="countryLabel" rendered="{!associatedCountryList.size >0 }">{!$Label.IPM_RolloutCountriesLabel}</apex:outputPanel>
                                                                        <div class="countryCheckList clearfix">
                                                                            <apex:variable value="{!1}" var="rowNum"/>
                                                                            <apex:repeat value="{!associatedCountryList}" var="clist" rendered="{!associatedCountryList.size >0}" >
                                                                                <apex:inputCheckbox value="{!clist.Calculation_Index__c}" onchange="UpdateCheckbox('{!clist.ID}',this.checked )" disabled="{!Or(project.IPM_Phase__c <> 'Ideas',!isEditable)}"/>
                                                                                <label>{!clist.Country_Name__c}</label>                                                                                                                          
                                                                            <apex:variable var="rowNum" value="{!rowNum + 1}"/>
                                                                        </apex:repeat>
                                                                  </div>
                                                              </div>
                                                         </apex:outputText>
                                                        <div role="tabpanel" class="tab-pane {!IF(currentTab == 'topdown', 'active', '')}" id="topDown">
                                                            <c:IPM_FinancialTabContent ipmFinancial="{!currentFinancial}"
                                                                financialsInnovation="{!financialsInnovation}"
                                                                financialsCalendar="{!financialsCalendar}"
                                                                colSpan="{!colSpan}"
                                                                sustainabilityPeriod="{!sustainabilityPeriod}"
                                                                fieldSuffix="{!fieldSuffix}"
                                                            />
                                                         
                                                        </div>
    
                                                        <!-- Rollup Summary Tab -->
                                                        <div role="tabpanel" class="tab-pane {!IF(currentTab == 'rollup', 'active', '')}" id="rollup">
                                                            <c:IPM_FinancialTabContent ipmFinancial="{!currentFinancial}"
                                                                financialsInnovation="{!financialsInnovation}"
                                                                financialsCalendar="{!financialsCalendar}"
                                                                colSpan="{!colSpan}"
                                                                sustainabilityPeriod="{!sustainabilityPeriod}"
                                                                fieldSuffix="{!fieldSuffix}"
                                                            />
                                                        </div>                            
                                                    </div>
                                                </apex:outputPanel>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                </div>  
            </apex:form>
            <div id="ipmConfirmModalDiv">
                <c:IPM_ConfirmModal />
            </div>     
        </apex:define>
    </apex:composition>
    
    <script src="{!URLFOR($Resource.IPM_Resource, 'js/IPM_Accordion.js')}" type="text/javascript"></script>
    <!--<script>
        var jq = jQuery.noConflict();
       
        function finScriptCallBack(){ 
                             
            jq(".initAccordian").on("click", function(){
                var $this = jq(this);
                if($this.parent().nextUntil(".leftsidemenu").is(":hidden")){
                   $this.parent().nextUntil(".leftsidemenu").show(); 
                   $this.removeClass("fa-plus-square");
                   $this.addClass("fa-minus-square");
                }else{
                   $this.parent().nextUntil(".leftsidemenu").hide(); 
                   $this.removeClass("fa-minus-square");
                   $this.addClass("fa-plus-square");
                }
            });
            function loadCurrencyPage(){ 
                window.location='/apex/IPM_Financial_Currency?id='+IPMFINAPP.projectid;
            }
            
       
            jq(document).on('click', '#ipmDeleteModal .confirmAction.refreshFromLocal', function(){
                jq('#ipmDeleteModal').modal('hide');
                refreshFromLocal();     
            });
            
            jq(document).on('click', '#ipmDeleteModal .confirmAction.refreshFromRegional', function(){
                jq('#ipmDeleteModal').modal('hide');
                refreshFromRegional();
            });
        }
        function defKeyPrev(){
            if((event.keyCode < 48 && event.keyCode != 46) || (event.keyCode > 57 && event.keyCode != 190 && event.keyCode != 110)){ 
                return false;
            }
        }
        
        jq(document).ready(function(){
                      
            jq('[data-toggle="tooltip"]').tooltip();
            jq('.ipmFinancetable > tbody > tr').each(function(){
            var $this = jq(this);
            $this.find('td.iPLBorderGay:first').addClass('finTabletr');
            }); 
        
            jq(document).on('click', '.finArrow', function(){
            var $this = jq(this);
            var finFilter = jq('.finFilter');
            var finTable = jq('.finTableData');
                if($this.children().hasClass('fa-angle-left')){
                    finFilter.hide();
                    finTable.removeClass('col-sm-10');
                    finTable.addClass('col-sm-12');
                    $this.children().removeClass('fa-angle-left');
                    $this.children().addClass('fa-angle-right');
                }else{
                    finTable.removeClass('col-sm-12');
                    finTable.addClass('col-sm-10');
                    finFilter.show();
                    $this.children().removeClass('fa-angle-right');
                    $this.children().addClass('fa-angle-left');
                }
            });
        });
        
        
        function refreshFromLocalJs(title, confirmMsg){
            modalFunc(title, confirmMsg);
            var delModal = jq('#ipmDeleteModal .confirmAction');
            delModal.removeClass('refreshFromRegional');
            delModal.addClass('refreshFromLocal');
            finScriptCallBack();
        }
        
        
        function refreshFromRegionalJs(title, confirmMsg){
            modalFunc(title, confirmMsg);
            var delModal = jq('#ipmDeleteModal .confirmAction');
            delModal.removeClass('refreshFromLocal');
            delModal.addClass('refreshFromRegional');
            finScriptCallBack();
        }
        
        
        function modalFunc(title, confirmMsg){
            jq('#ipmDeleteModal .modal-title').html(title);
            jq('#ipmDeleteModal .confirmMsg').html(confirmMsg);
        }
        
        function UpdateCheckbox(Country, check){
            ActionUpdate(Country,check);
        }
        
        
        var dots;
        function progressDots(){
            var currSel = document.getElementById(IPMApp.compSlst).options[document.getElementById(IPMApp.compSlst).selectedIndex].text;
            document.getElementById(IPMApp.compOtl).textContent = 'Currency: ' + currSel + ': exchange rate is being applied..';  
            dots = window.setInterval( function() {
            var wait = document.getElementById("wait");                
            if ( wait.innerHTML.length > 3 ) 
                wait.innerHTML = "";
            else 
                wait.innerHTML += ".";
            }, 500);
        }
        function stopDots(){
            window.clearInterval(dots);                                                    
            document.getElementById("wait").innerHTML='';
        }
        
        jq('#button').on('click',function() {
            var div = jq('#newpost');
            if (div.style.display !== 'none') {
                div.style.display = 'none';
                return false;
            }
            else {
                div.style.display = 'block';
                return false;
            }
        });
    </script>-->
   <script src="{!URLFOR($Resource.IPM_Resource, 'js/IPM_Financial.js')}" type="text/javascript"></script>
</apex:page>