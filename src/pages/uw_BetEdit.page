<!--
VERSION AUTHOR                  DATE            DETAIL  FEATURES/CSR/TTP
1.1     Kendre Dnyaneshwar      19 Mar 2015     T1- code changes to make custom buttons(Save, cancel, Archieve BET)
                                                action progress visible.                                                 
-->
<apex:page standardController="uw_BET__c" extensions="uw_BetEditController" showHeader="false">  
  <apex:includeScript value="{!URLFOR($Resource.jscolor_1_4_1, 'jscolor/jscolor.js')}" />
    <apex:includeScript value="{!$Resource.BETApp}/js/jquery.min.js" />    
    <apex:includeScript value="{!$Resource.BETApp}/js/jquery.qtip.min.js" />    
    <apex:stylesheet value="{!$Resource.BETEditBetStyles}" />
    <script>
    jQuery.noConflict();
    jQuery( document ).ready(function( $ ) {
        jQuery('.question-icon[data-tooltip!=""]').qtip({content: { attr: 'data-tooltip' } });
        jQuery('.question-icon-left[data-tooltip!=""]').qtip({content: { attr: 'data-tooltip' },position: { my: 'bottom right', at: 'top left' } });
        jQuery('.launchDateArea a').attr('href', null);
        jQuery('.launchDateArea a').on('click', function() {var name = jQuery('.launchDateArea input').attr('name');
            jQuery('input[name="'+name+'"]').focus(); return false;});      
        jQuery('#clearCurrentBanner').on('click', function(){jQuery('#banner-container').hide('');clearBannerAction();});
        jQuery('#clearFutureBanner').on('click', function(){
            var input = jQuery('[id$="upload_banner"]');input.replaceWith(input.val('').clone(true));});
        jQuery('#clearCurrentIcon').on('click', function(){jQuery('#icon-container').hide('');clearIconAction();}); 
        jQuery('#clearFutureIcon').on('click', function(){ var input = jQuery('[id$="upload_icon"]');input.replaceWith(input.val('').clone(true));});
        if (jQuery('[id$="runJsSuccess"]').val() == "true" ){
            window.top.postMessage({action: 'saveBetPreferences',moveHome:{!if(moveHome,'true','false')}}, document.location.protocol + '//' + document.domain);
        }
    });

    function areYouSureToArchive(element){
        if(confirm('{!$Label.BET_ArchiveConfirmation}')){
            element.value = '{!$Label.BET_Archiving}';
            return true;
        }
        return false;
    }

    function areYouSureToUnArchive(element){
        if(confirm('{!$Label.BET_UnArchiveConfirmation}')){
            element.value = '{!$Label.BET_UnArchiving}';
            return true;
        }
        return false;
    }

    </script>
            
    <apex:form >
        <apex:pageMessages escape="false"/>
        <apex:inputHidden value="{!runJsSuccess}" id="runJsSuccess"/>

        <apex:tabPanel switchType="server" id="AccountTabPanel" tabClass="activeTab" value="{!tabInFocus}" inactiveTabClass="inactiveTab">
            <apex:tab label="Toolkit Info" name="name1" id="tabOne">

                <div class="form-item-wrapper">
                  <div class="form-item">
                    <div class="item-label">
                        <apex:outputLabel >{!$Label.BET_MandatoryStar}{!$Label.BET_Name}</apex:outputLabel>
                        <apex:outputPanel layout="inline" styleClass="question-icon"
                                    rendered="{!!isBlank($ObjectType.uw_BET__c.Fields.Name.inlineHelpText)}"
                                    html-data-tooltip="{!$ObjectType.uw_BET__c.Fields.Name.inlineHelpText}" />
                    </div>
                    <div class="item-input">
                        <apex:inputfield id="betnameid" value="{!bet.Name}"/>
                    </div>
                  </div>             
                </div>

                <div class="form-item">
                  <div class="item-label">
                    <apex:outputLabel >{!$Label.BET_Owner}</apex:outputLabel>
                  </div>
                  <div class="item-input">
                    <apex:inputfield styleClass="hideOwner" value="{!bet.ownerId}"/>
                  </div>
                </div>

                <div>
                    <c:BET_CategoryBrandSelectionComponent betobj="{!bet}" cdata="{!compData}"/>

                    <div class="clear">&nbsp;</div>

                    <div class="form-item">
                        <div class="item-label">
                            <apex:outputLabel >{!$Label.BET_MandatoryStar}{!$Label.BET_TargetLaunchDate}</apex:outputLabel>
                            <apex:outputPanel layout="inline" styleClass="question-icon"
                                    rendered="{!!isBlank($ObjectType.uw_BET__c.Fields.Launch_Date__c.inlineHelpText)}"
                                    html-data-tooltip="{!$ObjectType.uw_BET__c.Fields.Launch_Date__c.inlineHelpText}" />
                        </div>
                        <div class="item-input-date">
                            <apex:inputField id="tldid" value="{!bet.Launch_Date__c}"/>
                            <script>document.getElementById('{!$Component.tldid}').disabled = {!compData.leadIPM}</script>
                        </div>
                        </div>
                    </div>

                    <div>
                
                    <div class="form-item">
                        <div class="item-label">
                            <apex:outputLabel >{!$ObjectType.uw_BET__c.Fields.Description__c.Label}</apex:outputLabel>
                            <apex:outputPanel layout="inline" styleClass="question-icon"
                                        rendered="{!!isBlank($ObjectType.uw_BET__c.Fields.Description__c.inlineHelpText)}"
                                        html-data-tooltip="{!$ObjectType.uw_BET__c.Fields.Description__c.inlineHelpText}" />
                        </div>
                        <div class="item-input">
                            <apex:inputTextarea id="descid" rows="5" value="{!bet.Description__c}"/>
                        </div>
                    </div>

                </div>
            </apex:tab>

            <apex:tab label="Branding options" name="name2" id="tabTwo">
                <apex:actionFunction action="{!clearBanner}" name="clearBannerAction"></apex:actionFunction>
                <div id="banner-container">
                    <apex:outputPanel rendered="{!showClearBanner}"> 
                        <div id="banner-area">
                            <apex:image width="325" height="62" rendered="{! bet.Banner_1_Location__c!=''  }" value="/servlet/servlet.FileDownload?file={!bet.Banner_1_Location__c }"/>
                        </div>
                        <button type="button" id="clearCurrentBanner" class="clearButton">Clear</button> 
                    </apex:outputPanel>
                </div>
                <div>
                    <apex:outputPanel layout="inline" styleClass="question-icon"
                        rendered="{!!isBlank($ObjectType.uw_BET__c.Fields.Banner_1_Location__c.inlineHelpText)}"
                        html-data-tooltip="{!$ObjectType.uw_BET__c.Fields.Banner_1_Location__c.inlineHelpText}" />
                    <apex:outputLabel >Banner (640x150 pixels)</apex:outputLabel>
                    <apex:inputFile id="upload_banner" value="{!banner.body}" filename="{!banner.name}"/>
                    <button type="button" id="clearFutureBanner" class="clearButton">Clear</button> 
                </div>
                <div class="clear">&nbsp;</div> 

                <apex:actionFunction action="{!clearIcon}" name="clearIconAction"></apex:actionFunction>

                <div id="icon-container">
                    <apex:outputPanel rendered="{!showClearIcon}"> 
                        <div id="icon-area">
                            <apex:image width="40" height="40" rendered="{! bet.Icon_Location__c!=''  }" value="/servlet/servlet.FileDownload?file={!bet.Icon_Location__c }"/>
                        </div>
                        <button type="button" id="clearCurrentIcon" class="clearButton">Clear</button>  
                    </apex:outputPanel>         
                </div>
                <div>
                    <apex:outputPanel layout="inline" styleClass="question-icon"
                        rendered="{!!isBlank($ObjectType.uw_BET__c.Fields.Icon_Location__c.inlineHelpText)}"
                        html-data-tooltip="{!$ObjectType.uw_BET__c.Fields.Icon_Location__c.inlineHelpText}" />
                    <apex:outputLabel >Icon (40x40 pixels)</apex:outputLabel>
                    <apex:inputFile id="upload_icon" value="{!icon.body}" filename="{!icon.name}"/>
                    <button type="button" id="clearFutureIcon" class="clearButton">Clear</button> 
                </div>              
                <div class="clear">&nbsp;</div> 
                <div class="clear">&nbsp;</div> 
            </apex:tab>

            <apex:tab label="{!$Label.BET_LinkedProjectsTabName}" 
                      name="tabThree" id="tabThree">
                <c:BET_LinkedProjectsComponent betId="{!bet.id}" betadmin="{!currentUserIsBetAdmin}"/>
            </apex:tab>

            <apex:tab label="{!$Label.BET_ApproveProjectsTabName}"
                      name="tabFour" id="tabFour" rendered="{!hasProjectsToApprove}">
                <c:BET_ApproveProjectsComponent betId="{!bet.id}" id="apcComponent" owner="{!currentUserIsOwner}"/>
            </apex:tab>

        </apex:tabPanel>

        <apex:outputPanel id="bottomButtonsPanel" rendered="{!IF(OR(tabInFocus == 'tabFour',tabInFocus == 'tabThree'),false,true)}">
            <div class="clear">&nbsp;</div>
            <div style="float:right">

                <apex:commandButton value="{!$Label.BET_ArchiveBET}" styleClass="btn-save" 
                    action="{!archiveBET}" rendered="{!AND(currentUserIsOwner,bet.Is_Archived__c == false)}" 
                    onclick="return areYouSureToArchive(this);"/>

                <apex:outputPanel layout="inline" styleClass="question-icon-left question-icon-large"
                    html-data-tooltip="Archived BETs are moved to the Archive area on the Home Page and Search" 
                    rendered="{!AND(currentUserIsOwner,bet.Is_Archived__c == false)}"/>

                <apex:commandButton value="{!$Label.BET_UnArchiveBET}" styleClass="btn-save" 
                    action="{!unArchiveBET}" rendered="{!AND(currentUserIsOwner,bet.Is_Archived__c == true)}" 
                    onclick="return areYouSureToUnArchive(this);"/>

                <apex:outputPanel layout="inline" styleClass="question-icon-left question-icon-large"
                    html-data-tooltip="Unarchived BETs are moved from the Archive area on the Home Page and Search" 
                    rendered="{!AND(currentUserIsOwner,bet.Is_Archived__c == true)}"/>
                </div>

            <div style="float:left;">
                <apex:commandButton value="{!$Label.BET_Save}" styleClass="btn-save" action="{!saveBET}" onclick="this.value = '{!$Label.BET_Saving}'"/>
                <apex:commandButton value="{!$Label.BET_Cancel}"  styleClass="btn-cancel" action="{!cancelBET}"  onclick="this.value = '{!$Label.BET_Canceling}'"/>
            </div>
        </apex:outputPanel>

    </apex:form>

    
</apex:page>