<apex:page showHeader="false" sidebar="false" docType="html-5.0" controller="Oblix_CampaignAddAssetController">
    <style>
        .removeAssetCss {
            background-image: url("{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/images/redcross.png')}") !important;
            background-size: 12px 12px !important;
            background-repeat: no-repeat !important;
        }
        .removeAssetCss:hover {
            background-image: url("{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/images/redcross.png')}") !important;
            background-size: 12px 12px !important;
            background-repeat: no-repeat !important;
        }
        .error {
            display: none;
        }
        .hide_button {
            display: none;
        }
    </style>
    <apex:composition template="Oblix_OuterPageTemplate">
        <apex:define name="top_breadcrumb">
            <p><a href="/apex/oblix_sowmain">SWOP Home</a>&nbsp;<span>&#9658;</span>&nbsp;<a href="/apex/oblix_sowmaindetail?sowId={!helper.project_in_scope.Financial_Year__r.Id}">{!helper.project_in_scope.Financial_Year__r.Name}</a>&nbsp;<span>&#9658;</span>&nbsp;<a href="/apex/oblix_campaignsummary?projectId={!helper.project_in_scope.Id}">{!helper.project_in_scope.Name}</a> &nbsp;
                        <span>&#9658;</span>&nbsp;Add campaign assets</p>
        </apex:define>
        <apex:define name="header_text" />

        <apex:define name="top_option_links" />

        <apex:define name="top_right_panel">
        </apex:define>
        <apex:define name="body_content">
            <div class="row">
                <div class="col-lg-6 col-md-6">
                    <h1 class="SOW_header_title">Add Assets to {!helper.project_in_scope.Name}</h1>
                </div>
                <apex:outputPanel id="campaignBasketSummary">
                    <table class="SOW_header_value_summary">
                        <tr>
                            <td class="SOW_header_value_title">Campaign Fees Total</td>
                            <td class="SOW_header_value">
                                <h2>€
                                    <apex:outputText value="{0, number,###,###,##0}">
                                        <apex:param value="{!helper.basket_total_fee}" />
                                    </apex:outputText>
                                </h2>
                            </td>
                        </tr>
                        <tr>
                            <td class="SOW_header_value_subtitle">Fees to be Paid in Current FY</td>
                            <td class="SOW_header_value_subvalue">€ 
                                    <apex:outputText value="{0, number,###,###,##0}">
                                        <apex:param value="{!helper.total_fees_this_FY}" />
                                    </apex:outputText>
                            </td>
                        </tr>
                    </table>
                </apex:outputPanel>
            </div>
            <hr class="divider" />
            <div class="row confirm_assets_welcome_message">
                <div>
                    <img src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/images/arrow-blue-down-left.png')}" width="96" height="77" alt="Add assets arrow" />
                    <h1>{!helper.project_in_scope.Name} was successfully created.<br/>Select assets from below to add them to your campaign basket.</h1>
                    <img src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/images/arrow-green-down-right.png')}" width="96" height="77" alt="Basket arrow" />
                </div>
            </div>
            <div class="row">
                <div class="col-lg-9 confirm_assets_accordion">
                    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="false">
                        <apex:repeat value="{!helper.assetOfferingWrapper.list_asset_types_in_order}" var="typeName">

                            <!-- [LVL 1] TYPE ACCORDION -->
                            <apex:variable var="offeringWrapper" value="{!helper.assetOfferingWrapper.map_asset_type_wrapper[typeName]}" />
                            <apex:outputText rendered="{!offeringWrapper.is_visible}">
                                <div class="oblix-type-navigation panel panel-default">
                                    <div class="panel-heading" role="tab">
                                        <h4 class="panel-title">
                                        <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse{!offeringWrapper.index}" aria-expanded="{!if(offeringWrapper.index == 0,'true','false')}" aria-controls="collapse{!offeringWrapper.index}">{!offeringWrapper.type_name}<img alt="add assets plus" src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/images/plus.png')}" width="14" height="14" class="pull-right"/></a>
                                        </h4>
                                    </div>
                                    <div id="collapse{!offeringWrapper.index}" class="oblix-type-container panel-collapse collapse {!if(offeringWrapper.index == 0,'in','')}" role="tabpanel">
                                        <div class="oblix-sub-category-navigation panel-body">
                                            <ul class="nav nav-tabs assets_tab_background" data-tabs="tabs">
                                                <!--<apex:repeat value="{!offeringWrapper.map_type_subCategoriesSet[offeringWrapper.type_name]}" var="subcategory">-->
                                                <apex:repeat value="{!offeringWrapper.list_sub_categories_in_order}" var="subcategory">

                                                    <!-- [LVL 2] SUB CATEGORY TAB LABELS -->
                                                    <apex:outputText rendered="{!offeringWrapper.map_sub_categories[subcategory].is_visible}">
                                                        <li role="presentation" class="{!IF(offeringWrapper.map_sub_categories[subcategory].index == 0,'active','')}">
                                                            <a href="#{!offeringWrapper.index}_{!offeringWrapper.map_sub_categories[subcategory].index}" data-toggle="tab">{!offeringWrapper.map_sub_categories[subcategory].sub_category_name} </a>
                                                        </li>
                                                    </apex:outputText>
                                                </apex:repeat>
                                            </ul>
                                            <!--tab body-->
                                            <div class="tab-content">
                                                <!--<apex:repeat value="{!offeringWrapper.map_type_subCategoriesSet[offeringWrapper.type_name]}" var="subcategory">-->
                                                <apex:repeat value="{!offeringWrapper.list_sub_categories_in_order}" var="subcategory">

                                                    <!-- [LVL 2] SUB CATEGORY TAB CONTENT -->
                                                    <apex:outputText rendered="{!offeringWrapper.map_sub_categories[subcategory].is_visible}">
                                                        <div class="oblix-sub-category-container tab-pane asset_accordion_body {!IF(offeringWrapper.map_sub_categories[subcategory].index == 0,'active','')}" id="{!offeringWrapper.map_sub_categories[subcategory].type_index}_{!offeringWrapper.map_sub_categories[subcategory].index}" >
                                                            <p class="asset_accordion_intro">{!offeringWrapper.map_sub_categories[subcategory].sub_category_description} </p>
                                                            <div class="tabbable">
                                                                <div class="col-lg-6">

                                                                    <ul class="oblix-option-navigation nav nav-pills nav-stacked">
                                                                        <!--<apex:repeat value="{!offeringWrapper.map_sub_categories[subcategory].map_subcategories_options_set[subcategory]}" var="eachSubcategoryOption">-->
                                                                        <apex:repeat value="{!offeringWrapper.map_sub_categories[subcategory].list_asset_options_in_order}" var="eachSubcategoryOption">

                                                                            <!-- [LVL 3] OPTION PILL LABELS -->

                                                                            <apex:variable var="option" value="{!offeringWrapper.map_sub_categories[subcategory].map_asset_options[eachSubcategoryOption]}" />
                                                                            <apex:variable var="optionSelector" value="#{!option.type_index}_{!option.sub_category_index}_{!option.index}" />
                                                                            <apex:outputText rendered="{!option.is_visible}">
                                                                                <li class="accordion_body_options {!IF(option.index == 0,'active','')}" >
                                                                                    <a href="{!optionSelector}" data-toggle="tab"><strong>{!option.option_name}</strong>&nbsp;{!option.option_description}</a>
                                                                                </li>
                                                                            </apex:outputText>
                                                                        </apex:repeat>
                                                                    </ul>
                                                                </div>
                                                                <div class="col-lg-6">
                                                                    <div class="add_asset_panel">
                                                                        <div class="row">
                                                                            <div class="tab-content">
                                                                                <!--<apex:repeat value="{!offeringWrapper.map_sub_categories[subcategory].map_subcategories_options_set[subcategory]}" var="eachSubcategoryOption">-->
                                                                                <apex:repeat value="{!offeringWrapper.map_sub_categories[subcategory].list_asset_options_in_order}" var="eachSubcategoryOption">

                                                                                    <!-- [LVL 3] OPTION PILL CONTENT -->

                                                                                    <apex:variable var="option" value="{!offeringWrapper.map_sub_categories[subcategory].map_asset_options[eachSubcategoryOption]}" />
                                                                                    <apex:variable var="optionSelector" value="{!option.type_index}_{!option.sub_category_index}_{!option.index}" />
                                                                                    <apex:outputText rendered="{!option.is_visible}">
                                                                                        <div class="oblix-option-container tab-pane {!IF(option.index == 0,'active','')}" id="{!optionSelector}" >
                                                                                            <h2>{!option.option_name} selection</h2>

                                                                                            <div class="col-lg-4">
                                                                                                <p class="create_SOW_form_titles asset_panel_titles"></p>
                                                                                                <p class="create_SOW_form_titles asset_panel_titles">Asset name*</p>
                                                                                                <p class="create_SOW_form_titles asset_panel_titles quantity_label">Quantity*
                                                                                                    <br/><span class="form_bracket_text">(Numerics only)</span>
                                                                                                </p>
                                                                                                <p class="create_SOW_form_titles asset_panel_titles">Other Info
                                                                                                    <br/><span class="form_bracket_text">(Optional)</span>
                                                                                                </p>
                                                                                            </div>
                                                                                            <div class="col-lg-6">
                                                                                                <apex:variable var="assetNameMap" value="{!option.map_asset_names}" rendered="true" />
                                                                                                <apex:variable var="assetNameOrderedList" value="{!option.list_asset_names_in_order}" rendered="true" />

                                                                                                <apex:outputPanel id="optionPanel">
                                                                                                    <apex:actionRegion >
                                                                                                        <select class="asset-selector">
                                                                                                            <option value="null">--None--</option>
                                                                                                            <apex:repeat value="{!assetNameOrderedList}" var="assetName">

                                                                                                                <!-- [LVL 4] ASSET NAME SELECTOR -->
    
                                                                                                                <apex:outputText rendered="{!assetNameMap[assetName].is_active}" >
                                                                                                                    <option value="{!assetNameMap[assetName].mdm_id}" >{!assetName}</option>
                                                                                                                </apex:outputText>
                                                                                                            </apex:repeat>
                                                                                                        </select>
                                                                                                        <div class="trDescribe hidden">
                                                                                                            <p class="form_bracket_text">Please describe if not listed* &nbsp;</p>
                                                                                                            <input class="input_init descMend assetOtherName" maxlength="255" name="assetOtherName" size="20" type="text" />
                                                                                                        </div>
                                                                                                        <input type="number" name="assetQuantity" value="" class="assetQuantity" />
                                                                                                        <br/>
                                                                                                        <input type="text" name="assetNotes" value="" class="assetNotes" />
                                                                                                        <br/>

                                                                                                        <button id="addButton-{!optionSelector}" class="btn btn-primary btn_plus btn_asset_add" onclick="checkAddValuesForBasket(this); return false;">ADD</button>
                                                                                                        <button id="updateButton-{!optionSelector}" class="btn btn-primary hidden" onclick="checkUpdateValuesForBasket(this); return false;">UPDATE</button>
                                                                                                    </apex:actionRegion>
                                                                                                </apex:outputPanel>

                                                                                            </div>
                                                                                        </div>
                                                                                    </apex:outputText>
                                                                                </apex:repeat>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </apex:outputText>
                                                </apex:repeat>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </apex:outputText>
                        </apex:repeat>
                    </div>
                </div>
                <div class="col-lg-3 asset_shopping_basket_margin">
                    <div class="asset_shopping_basket">

                        <apex:outputPanel id="campaignBasket">
                            <div class="asset_shopping_basket_title_bar">
                                <h2>Campaign Basket ({!helper.quantity_in_basket} asset{!IF(helper.quantity_in_basket == 1, '', 's')})</h2>
                            </div>
                            <input type="hidden" value="{!helper.map_assets_in_basket_json}" id="basketJSON" />
                            <!--<apex:repeat value="{!helper.set_basket_AssetNames}" var="basketItemMDMID">-->
                            <apex:repeat value="{!helper.list_reverese_order}" var="basketItemMDMID">
                                <apex:variable value="{!helper.map_assets_in_basket[basketItemMDMID]}" var="basketAssetWrapper" />
                                <apex:variable value="{!basketAssetWrapper.type_index}_{!basketAssetWrapper.sub_category_index}_{!basketAssetWrapper.option_index}" var="indexSelector" />
                                <div class="asset_shopping_basket_item">
                                    <div class="campaign_create_agency_hub_split_table_subtitle" id="{!indexSelector}">
                                        <apex:outputPanel rendered="{!IF(can_edit,true,false)}">
                                            <div class="row">
                                                <div class="col-sm-1">
                                                    <apex:commandButton action="{!removeAssetFromBasket}" reRender="campaignBasket, campaignBasketSummary, page_message_id" onclick="blockBasket(); assetToBeRemovedMDMId = '{!basketItemMDMID}';" oncomplete="unblockBasket(); handleBasketChange()" styleClass="removeAssetCss btn" style="width:12px;height:12px" value="">
                                                        <apex:param name="selectedAssetMDMId" assignTo="{!helper.selectedAssetMDMId}" value="{!basketItemMDMID}" />
                                                    </apex:commandButton>
                                                </div>
                                                <div class="col-sm-9">
                                                    <apex:commandLink onclick="focusOnAsset('{!basketItemMDMID}'); return false;" reRender=""> {!basketAssetWrapper.sub_category_name} / {!basketAssetWrapper.option_name} / {!basketAssetWrapper.asset_name}{! IF(LEN(TRIM(basketAssetWrapper.other_name))=0, '', ' - ' + basketAssetWrapper.other_name) }
                                                    </apex:commandLink>
                                                </div>
                                                <div class="col-sm-1">
                                                    <apex:commandLink onclick="focusOnAsset('{!basketItemMDMID}'); return false;" reRender="">
                                                        {!basketAssetWrapper.quantity_in_basket}
                                                    </apex:commandLink>
                                                </div>
                                            </div>
                                        </apex:outputPanel>
                                        <apex:commandLink onclick="focusOnAsset('{!basketItemMDMID}'); return false;" reRender="">
                                        </apex:commandLink>
                                    </div>
                                </div>
                            </apex:repeat>
                            <div class="asset_shopping_basket_total">
                                <div class="row asset_basket_row">
                                    <p class="asset_shopping_basket_total_fee_text">Campaign Fees Total</p>
                                    <h2 class="asset_shopping_basket_total_fee_value">
                                    €
                                    <apex:outputText value="{0, number,###,###,##0}">
                                        <apex:param value="{!helper.basket_total_fee}" />
                                    </apex:outputText>
                                    </h2>
                                </div>
                                <div class="row asset_basket_row">
                                    <p class="asset_shopping_basket_total_FY_text">Fees to be Paid in Current FY</p>
                                    <p class="asset_shopping_basket_total_FY_value">€ 
                                    <apex:outputText value="{0, number,###,###,##0}">
                                        <apex:param value="{!helper.total_fees_this_FY}" />
                                    </apex:outputText></p>
                                </div>
                            </div>
                        </apex:outputPanel>
                        <div class="asset_shopping_basket_btn">
                            <button type="button" class="btn btn-primary btn-xs btn_check btn_finish_basket" onclick="finishWithBasket(); return false;">FINISH WITH BASKET</button>
                        </div>
                    </div>
                </div>
            </div>
            <br/>
            <!--{!assetOfferingWrapper}-->
            <br/>
            <!--{!mainType[0].map_sub_categories[""]}-->
            <br/>
            <apex:actionFunction action="{!addAssetToBasket}" name="addToBasket" reRender="campaignBasket, campaignBasketSummary, page_message_id" oncomplete="unblockBasket(); handleBasketChange()">
                <apex:param name="selectedAssetName" assignTo="{!helper.selectedAssetName}" value="" />
                <apex:param name="selectedAssetMDMId" assignTo="{!helper.selectedAssetMDMId}" value="" />
                <apex:param name="selectedAssetOtherName" assignTo="{!helper.selectedAssetOtherName}" value="" />
                <apex:param name="selectedAssetQuantity" assignTo="{!helper.selectedAssetQuantity}" value="" />
                <apex:param name="selectedAssetNotes" assignTo="{!helper.selectedAssetNotes}" value="" />
            </apex:actionFunction>
            <apex:actionFunction action="{!updateAssetInBasket}" name="updateInBasket" reRender="campaignBasket, campaignBasketSummary, page_message_id" oncomplete="unblockBasket(); handleBasketChange()">
                <apex:param name="selectedAssetName" assignTo="{!helper.selectedAssetName}" value="" />
                <apex:param name="selectedAssetMDMId" assignTo="{!helper.selectedAssetMDMId}" value="" />
                <apex:param name="selectedAssetOtherName" assignTo="{!helper.selectedAssetOtherName}" value="" />
                <apex:param name="selectedAssetQuantity" assignTo="{!helper.selectedAssetQuantity}" value="" />
                <apex:param name="selectedAssetNotes" assignTo="{!helper.selectedAssetNotes}" value="" />
            </apex:actionFunction>
            <apex:actionFunction action="{!finishWithBasket}" name="finishWithBasket" reRender="page_message_id"/>
            <input type="hidden" id="initWithAssetMDMId" value="{!helper.assetMDMId}" />
            <input type="hidden" id="assetOtherNameLabel" value="{!helper.assetOtherNameLabel}" />
        </apex:define>
    </apex:composition>

    <script src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/js/Oblix_AddAsset.js')}" />

</apex:page>