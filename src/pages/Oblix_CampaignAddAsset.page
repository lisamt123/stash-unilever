<apex:page showHeader="false" sidebar="false" docType="html-5.0" controller="Oblix_CampaignAddAssetController" standardStylesheets="true">
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/s/bs-3.3.5/jqc-1.11.3,dt-1.10.10/datatables.min.css" />
    <script type="text/javascript" src="https://cdn.datatables.net/s/bs-3.3.5/jqc-1.11.3,dt-1.10.10/datatables.min.js"></script>
    <link rel="stylesheet" type="text/css" href="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/css/unilever-style.css')}" />
    <script src="{!URLFOR($Resource.Oblix_JQueryBlockUI)}"></script>
    <script src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/js/swopJS.js')}" />
    <script src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/js/Oblix_CampaignAddAsset.js')}" />
    <script type="text/javascript" src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/js/jquery.sticky.js')}"></script>
    <style>
        .removeAssetCss {
            background-image: url("{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/images/redcross.png')}") !important;
            background-size: 12px 12px !important;
            background-repeat: no-repeat !important;
        }
        .removeAssetCss:hover {
            background-image: url("{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/images/redcross.png')}") !important;
            background-size: 12px 12px !important;
            background-repeat: no-repeat !important;
        }
        .error {
            display: none;
        }
        .hide_button {
            display: none;
        }
    </style>
    <apex:form >

        <div class="Oblix_header_bkgd">
            <header class="Oblix_header_panel">
                <img alt="Unilever Logo" src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/images/Oblix_Unilever_logo.png')}" width="54" height="60" />
                <div class="header_divider_vertical"></div>
                <div class="header_panel_text">
                    <h2>Hi {!userConnected.Name}, Welcome to SWOP the Scope of Work Online Planner</h2>
                    <!-- <p><a href="/apex/oblix_sowmain">SWOP Home</a>&nbsp;<span>&#9658;</span>&nbsp;<a href="#">SOW name</a>&nbsp;<span>&#9658;</span>&nbsp;<a href="#">Add new campaign</a>
                    </p> -->

                    <p><a href="/apex/oblix_sowmain">SWOP Home</a>&nbsp;<span>&#9658;</span>&nbsp;<a href="/apex/oblix_sowmaindetail?sowId={!selected_sow.Id}">{!selected_sow.Name}</a>&nbsp;<span>&#9658;</span>&nbsp;<a href="/apex/oblix_campaignsummary?projectId={!project.Id}">{!project.Name}</a> &nbsp;
                        <span>&#9658;</span>&nbsp;Add campaign assets</p>

                </div>
                <apex:commandButton styleClass="btn btn-xs pull-right btn_cross btn_exit_swop" action="{!exitSwop}" value="DONE FOR TODAY? EXIT SWOP">
                </apex:commandButton>
                <apex:commandLink styleClass="btn btn-xs pull-right btn-danger btn_report btn_go_to_reports" id="swopExitButton" action="{!goToReportsHome}" value="REPORTS" target="_blank">
                </apex:commandLink>

            </header>
        </div>
        <div class="container SOW_body">
            <div class="row">
                <div class="col-lg-6">
                    <h1 class="SOW_header_title">{!project.Name} Added!</h1>
                </div>
                <apex:outputPanel id="campaignFeeId">
                    <table class="SOW_header_value_summary">
                        <tr>
                            <td class="SOW_header_value_title">{!$ObjectType.Oblix_SOW_Projects__c.fields.Campaign_Fees_Total__c.label}</td>
                            <td class="SOW_header_value">
                                <h2>
                               €
                               <apex:outputText value="{0, number,###,###,##0}">
                                 <apex:param value="{!project.Campaign_Fees_Total__c}"/>
                               </apex:outputText>
                                
                            </h2>
                            </td>
                        </tr>
                        <tr>
                            <td class="SOW_header_value_subtitle"> {!$ObjectType.Oblix_SOW_Projects__c.fields.Value_to_be_paid_in_Current_FY__c.label} </td>
                            <td class="SOW_header_value_subvalue">
                                €
                                <apex:outputText value="{0, number,###,###,##0}">
                                    <apex:param value="{!project.Value_to_be_paid_in_Current_FY__c}" />
                                </apex:outputText>
                            </td>
                        </tr>
                    </table>
                </apex:outputPanel>
            </div>
            <hr class="divider" />
            <div class="row confirm_assets_welcome_message">
                <div>
                    <img src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/images/arrow-blue-down-left.png')}" width="96" height="77" alt="Add assets arrow" />
                    <h1>{!project.Name} was successfully created.<br/>Select assets from below to add them to your campaign basket.</h1>
                    <img src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/images/arrow-green-down-right.png')}" width="96" height="77" alt="Basket arrow" />
                </div>
            </div>
            <apex:outputPanel id="rowID">
                <div class="row">
                    <div class="col-lg-9 confirm_assets_accordion">
                        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
                            <apex:variable var="accordianCounter" value="{!1}" />
                            <apex:repeat value="{!lstRecordType}" var="recordType">
                                <div class="panel panel-default">
                                    <div class="panel-heading" role="tab" id="heading{!accordianCounter}">
                                        <h4 class="panel-title">
                                    <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse{!accordianCounter}" aria-expanded="{!if(accordianCounter == 1,'true','false')}" aria-controls="collapse{!accordianCounter}"><apex:outputText value="{!recordType}" styleClass="recordTypeValue" /> {!mapRecordTypeDescription[recordType]}<img alt="Add" src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/images/plus.png')}" width="14" height="14" class="pull-right"/></a>
                                </h4>
                                    </div>
                                    <div id="collapse{!accordianCounter}" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading{!accordianCounter}">
                                        <div class="panel-body" id="{!mapRTIdCSS[recordType]}_tabs">
                                            <ul class="nav nav-tabs assets_tab_background" data-tabs="tabs">
                                                <apex:variable var="count" value="{!1}" />
                                                <apex:repeat value="{!mapRTSUBCat[recordType]}" var="subCat">

                                                    <li class="{!if(count == 1,'active','')}">
                                                        <a href="#{!mapRTIdCSS[recordType]}_tabs-{!count}" data-toggle="tab">{!subCat}</a>
                                                    </li>
                                                    <apex:variable var="count" value="{!count + 1}" />
                                                </apex:repeat>

                                            </ul>
                                            <!-- tab body-->
                                            <apex:outputPanel id="tab-contentPanel">
                                                <div id="my-tab-content" class="tab-content">
                                                    <apex:variable var="count2" value="{!1}" />
                                                    <apex:repeat value="{!mapRTSUBCat[recordType]}" var="subCat">
                                                        <apex:variable var="selectionCount" value="{!1}" />
                                                        <div class="tab-pane asset_accordion_body {!if(count2 == 1,'active','')}" id="{!mapRTIdCSS[recordType]}_tabs-{!count2}">
                                                            <p class="asset_accordion_intro">{!mapSubCategOptionDefinition[subCat]}</p>
                                                            <div class="tabbable">
                                                                <div class="col-lg-6" id="{!mapRTIdCSS[recordType]}_tabs{!count2}">
                                                                    <ul class="nav nav-pills nav-stacked">
                                                                        <apex:variable var="count_opt" value="{!1}" />
                                                                        <apex:repeat value="{!mapSubCategOption[subCat]}" var="opt">
                                                                            <li class="accordion_body_options {!if(count_opt == 1,'active','')}"><a href="#{!mapRTIdCSS[recordType]}_tabs-{!count2}{!opt}" title="Score {!opt}" onclick="if($('.hideOptionAsset').is(':visible')) ReInitializeInstanceAF('{!subCat}');" data-toggle="tab"><strong> {!$Label.Oblix_lbl_UIUX_Option} {!count_opt} : </strong> {!mapSubCategOptionDescription[subCat+opt]}</a> </li>
                                                                            <apex:variable var="count_opt" value="{!count_opt + 1}" />
                                                                        </apex:repeat>
                                                                    </ul>

                                                                </div>
                                                                <div class="col-lg-6">
                                                                    <div class="add_asset_panel">
                                                                        <div class="row">
                                                                            <div class="tab-content">
                                                                                <apex:repeat value="{!mapSubCategOption[subCat]}" var="opt">

                                                                                    <div class="tab-pane {!if(selectionCount == 1,'active','')}" id="{!mapRTIdCSS[recordType]}_tabs-{!count2}{!opt}">
                                                                                        <apex:outputPanel id="countedID">
                                                                                            <h2 class="optionSelectionClass">Option {!selectionCount} selected</h2>
                                                                                        </apex:outputPanel>

                                                                                        <apex:outputPanel id="assetPart">
                                                                                            <apex:actionRegion >




                                                                                                <!--styleClass="removeBreak"-->
                                                                                                <div class="col-lg-4">
                                                                                                    <p class="create_SOW_form_titles asset_panel_titles"></p>
                                                                                                    <p class="create_SOW_form_titles asset_panel_titles">{!$ObjectType.Oblix_Project_Assets__c.fields.Asset_Picklist__c.label}*</p>
                                                                                                    <p class="create_SOW_form_titles asset_panel_titles quantselector">{!$ObjectType.Oblix_Project_Assets__c.fields.Quantity__c.label}*
                                                                                                        <br/><span class="form_bracket_text">(Numerics only)</span>
                                                                                                    </p>
                                                                                                    <p class="create_SOW_form_titles asset_panel_titles">Other info
                                                                                                        <br/><span class="form_bracket_text">(Optional)</span>
                                                                                                    </p>
                                                                                                </div>
                                                                                                <div class="col-lg-6">
                                                                                                    <apex:inputField value="{!mapAssetsPerSubCat[subCat].Sub_Category__c}" style="display:none" styleClass="{!subCat} subCatPicklist" />
                                                                                                    <apex:inputField id="assetNamePicklist" value="{!mapAssetsPerSubCat[subCat].Asset_Picklist__c}" onchange="showhideDetail($(this),{!opt},'{!project.Id}'); return false;" />
                                                                                                    <span class="error">error</span>
                                                                                                    <div style="display:none" class="trDescribe">
                                                                                                        <p class="form_bracket_text">
                                                                                                            {!$Label.Oblix_lbl_UIUX_Please_describe} &nbsp;</p>
                                                                                                        <apex:inputField styleClass="input_init descMend" value="{!mapAssetsPerSubCat[subCat].Location__c}" />
                                                                                                    </div>
                                                                                                    <apex:inputField value="{!mapAssetsPerSubCat[subCat].Quantity__c}" styleClass="assetQuantity" />

                                                                                                    <apex:inputField style="width:100%;min-height:100px" value="{!assetInstance.Additional_Description__c}" styleClass="assetNotes" />
                                                                                                    <!--apex:outputPanel rendered="{!IF(hasEditAccess || $Profile.Name =='System Administrator',true,false)}"-->
                                                                                                    <apex:outputpanel id="overallPanel">
                                                                                                        <apex:outputPanel rendered="{!AND(hasEditAccess,NOT(isUpdate))}" id="AddButton">
                                                                                                            <apex:commandButton value="ADD" onclick="if(addAsset(this, '{!subCat}' , '{!recordType}')); return false;" oncomplete="$.unblockUI();location.reload();" reRender="assetPart,campaignFeeId,Oblix_card" styleClass="btn btn-primary btn_plus btn_asset_add">

                                                                                                            </apex:commandButton>
                                                                                                            <!--input value="Add" onclick="addAsset(this, '{!subCat}' , '{!recordType}'); if(setMendatory($(this))) return false;" class="btn btn-primary" style="width:70px" type="submit" data-asset-id='{!selectedAssetId}' /-->
                                                                                                        </apex:outputPanel>
                                                                                                        <!-- <apex:commandButton value="UPDATE" onclick="updateAsset(this, {!selectionCount}); if(setMendatory($(this))) blockme(); return false;" styleclass="btn btn-primary hide_button" style="width:70px" reRender="tab-contentPanel,assetPart,campaignFeeId,Oblix_card"/>-->
                                                                                                        <apex:outputPanel rendered="{!AND(hasEditAccess, isUpdate)}" id="UpdateButton">
                                                                                                            <input value="UPDATE" onclick="updateAsset(this, {!selectionCount}); if(setMendatory($(this))) blockme(); return false;" class="btn btn-primary" style="width:70px" type="submit" data-asset-id='{!selectedAssetId}' />
                                                                                                            <!--return false;reRender="assetPart,campaignFeeId,estimateId,Oblix_card" -->
                                                                                                        </apex:outputPanel>
                                                                                                    </apex:outputPanel>
                                                                                                </div>

                                                                                            </apex:actionRegion>

                                                                                        </apex:outputPanel>
                                                                                        <apex:variable var="selectionCount" value="{!selectionCount + 1}" />
                                                                                    </div>
                                                                                    <!--/div-->

                                                                                </apex:repeat>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <!--                                    tab body end-->
                                                        <!--                                    tab body-->

                                                        <apex:variable var="count2" value="{!count2 + 1}" />
                                                    </apex:repeat>

                                                    <!--apex:variable var="selectionCount" value="{!selectionCount + 1}" /-->
                                                </div>
                                            </apex:outputPanel>
                                            <!--                                    tab body end-->
                                            <!--                                    panel body end-->
                                        </div>
                                    </div>
                                </div>
                                <apex:variable var="accordianCounter" value="{!accordianCounter + 1}" />
                            </apex:repeat>
                        </div>
                    </div>
                    <div class="col-lg-3 asset_shopping_basket_margin">
                        <apex:outputPanel id="Oblix_card">
                            <div class="asset_shopping_basket">
                                <div class="asset_shopping_basket_title_bar">
                                    <h2>Campaign Basket ({!countAssetNumberForCampaign} assets)
                                 
                            </h2>
                                </div>
                                <div class="asset_shopping_basket_body">
                                    <div class="asset_shopping_basket_item_title ">

                                        <!--
                                <apex:repeat value="{!lstAssetsForCard}" var="asset">
                                        <div class="Oblix_card_elmt">
                                            <div>
                                               <div class="Oblix_button_table_align">
                                                <apex:commandButton styleClass="removeAssetCss" style="width:12px;height:12px"  onclick="removeAsset('{!asset.Id}'); return false"/> <span>{!asset.Asset_Title__c}</span><!--value="{!$Label.Oblix_lbl_UIUX_Delete}" -->
                                        <!--<apex:commandButton value="{!$Label.Oblix_lbl_UIUX_Edit}" onclick="editAset(this, '{!asset.Id}); return false;"/>-->
                                        <!--<input type="button" value="{!$Label.Oblix_lbl_UIUX_Edit}" onclick="editAsset1(this, '{!asset.Id}')" class="btn" />
                                                </div>
                                            </div>
                                        </div>
                                </apex:repeat> 
                                -->


                                        <apex:repeat value="{!lstAssetsForCard}" var="wrapAsset">
                                            <div class="Oblix_card_elmt asset_shopping_basket_item">
                                                <div>
                                                    <div class="Oblix_button_table_align">
                                                        <apex:outputPanel rendered="{!IF(hasEditAccess || $Profile.Name =='System Administrator',true,false)}">
                                                            <apex:commandButton styleClass="removeAssetCss" style="width:12px;height:12px" onclick="removeAsset('{!wrapAsset.Id}', '{!project.Id}'); return false" />
                                                        </apex:outputPanel>
                                                        <span>
                                                                <apex:commandLink onclick="editAsset(this, '{!wrapAsset.Id}'); return false;" reRender="tab-contentPanel,assetPart,campaignFeeId,Oblix_card">
                                                                    {!wrapAsset.Asset_Picklist__c}
                                                                    <apex:outputText rendered="{!wrapAsset.Asset_Picklist__c=='Other'}">  {!wrapAsset.Location__c}    </apex:outputText>
                                                                     {!wrapAsset.Option_Name__c}
                                                                    ( Quantity {!wrapAsset.Quantity__c} )
                                                                   
                                                                </apex:commandLink>
                                                            </span>
                                                    </div>
                                                </div>
                                            </div>

                                        </apex:repeat>
                                    </div>
                                </div>

                                <div class="asset_shopping_basket_total">
                                    <div class="row asset_basket_row">
                                        <p class="asset_shopping_basket_total_fee_text">{!$ObjectType.Oblix_SOW_Projects__c.fields.Campaign_Fees_Total__c.label}</p>
                                        <h2 class="asset_shopping_basket_total_fee_value">€
                                        <apex:outputText value="{0, number,###,###,##0}">
                                             <apex:param value="{!estimateCost}"/>
                                         </apex:outputText></h2>
                                    </div>
                                    <div class="row asset_basket_row">
                                        <p class="asset_shopping_basket_total_FY_text">{!$ObjectType.Oblix_SOW_Projects__c.fields.Value_to_be_paid_in_Current_FY__c.label}</p>
                                        <p class="asset_shopping_basket_total_FY_value">€
                                            <apex:outputText value="{0, number,###,###,##0}">
                                                <apex:param value="{!project.Value_to_be_paid_in_Current_FY__c}" />
                                            </apex:outputText>
                                        </p>
                                    </div>
                                </div>
                                <div class="asset_shopping_basket_btn">
                                    <apex:commandButton styleClass="btn btn-primary btn-xs btn_check btn_finish_basket" value="FINISH WITH BASKET" action="{!finishBasket}" />

                                    <!--button type="button" class="btn btn-primary btn-xs"><img src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/images/check.png')}" width="12" height="12" />
                                </button
                                -->
                                </div>
                                <apex:actionFunction action="{!AddToProjectAction}" name="setToProjectAction" reRender="">
                                    <apex:param assignTo="{!recordType}" name="recordType" value="" />
                                    <apex:param assignTo="{!subCat}" name="subCat" value="" />
                                    <apex:param assignTo="{!complexity}" name="complexity" value="" />
                                    <apex:param assignTo="{!selectionCountvar}" name="selectionCountvar" value="" />
                                    <apex:param assignTo="{!assetDescription}" name="addDesc" value="" />
                                    <apex:param assignTo="{!assetLocation}" name="location" value="" />
                                    <apex:param assignTo="{!assetQuantity}" name="quantity" value="" />
                                    <apex:param assignTo="{!assetPicklist}" name="addPick" value="" />
                                </apex:actionFunction>
                                <apex:actionFunction action="{!refresh}" name="refreshAsset" reRender="campaignFeeId,Oblix_card" oncomplete="$.unblockUI()">
                                    <apex:param name="updatedAssetInstance" assignTo="{!updatedAssetInstance}" value="" />
                                </apex:actionFunction>
                                <apex:actionFunction action="{!existsInBasket}" name="existsInBasket" reRender="overallPanel,UpdateButton,AddButton" oncomplete="$.unblockUI();">
                                    <apex:param name="basketKey" assignTo="{!basketKey}" value="" />
                                    <apex:param name="selectedAssetId" assignTo="{!selectedAssetId}" value="" />
                                </apex:actionFunction>
                            </div>
                        </apex:outputPanel>
                    </div>
                </div>
            </apex:outputPanel>
            <!--end div  class row -->
        </div>
    </apex:form>
</apex:page>