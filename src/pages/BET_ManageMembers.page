<!--
VERSION AUTHOR                  DATE            DETAIL  FEATURES/CSR/TTP
1.1     Kendre Dnyaneshwar      19 Mar 2015     T1- code changes to make custom buttons(Add members,Approve,Deny,Delete)
                                                action progress visible.        
1.2     Kendre Dnyaneshwar      27 Apr 2015     T2- Rendered attribute added in delete commnad button to hide delete option
                                                for owner of the BET.                                                                                
-->

<apex:page standardController="BET_Member_Request__c" showHeader="false" extensions="BET_ManageMembersController"  id="memberpage">

  <apex:stylesheet value="{!$Resource.BETManageMembersStyles}" />

  <script>

  function updateRoleOnMember(memId, role, idx){
    var idid = 'memberpage:form:repeater:'+idx+':role';
    document.getElementById(idid).innerHTML = 'Processing ...';
    Visualforce.remoting.Manager.invokeAction(
      '{!$RemoteAction.BET_ManageMembersController.updateMemberRole}',
      memId,
      role,
      function(result, event){
        if (event.status) {
          document.getElementById(idid).innerHTML = role;
        }
      },
      {escape: true}
    );
  }

  function selectOrDeselectkAllBrowse(){
    var ch;
    var a = document.querySelectorAll(".browseMembersheaderStyle input[type=checkbox]");
    for (var i = 0; i < a.length; i++){
       ch = a[i].checked;
    }
    var aa = document.querySelectorAll(".memberRow input[type=checkbox]");
    for (var i = 0; i < aa.length; i++){
       aa[i].checked = ch;
    }
  }

  function selectOrDeselectkAll(){
    var ch;
    var a = document.querySelectorAll(".approveMembersheaderStyle input[type=checkbox]");
    for (var i = 0; i < a.length; i++){
       ch = a[i].checked;
    }
    var aa = document.querySelectorAll(".memberRequestRow input[type=checkbox]");
    for (var i = 0; i < aa.length; i++){
       aa[i].checked = ch;
    }
  }
  </script>

  <apex:form id="form">
  <apex:outputpanel id="showpage">
  <apex:pageMessages /> 

  <apex:tabPanel switchType="client" selectedTab="browseMembers" id="MembersTabPanel" tabClass="activeTab" 
                       inactiveTabClass="inactiveTab">

    <apex:tab label="{!$Label.BET_Browse_members}" name="browseMembers" id="browseMembersid">
     
        <div>
          <apex:outputText value="{!$Label.BET_Add_Internal_User}" styleClass="addMembersUserLabel"/>
        </div>
        <table>
          <tr>
            <td>
              <apex:selectList value="{!betMemberRequest.Role__c}" styleClass="addMembersDropdown" required="false" size="1" multiselect="false">
                <apex:selectOptions value="{!memberRequestRoles}" />
              </apex:selectList>
            </td>
            <td>
              <div class="hideOwner">   
                <apex:inputField value="{!betMemberRequest.UserId__c}"/>
              </div>
            </td>
            <td>
              <div style="padding-left:40px;">
                <apex:commandButton value="{!$Label.BET_Add_Member}" action="{!addMember}" rendered="{!isBetOwnerOrManager}"
                                    styleClass="buttong2y" style="background: #e6007e; color:white;" />
              </div>
            </td>
          </tr>
        </table>
    
        <div>
          <apex:outputText value="{!$Label.BET_External_Agency_User}" styleClass="addMembersUserLabel"/>
        </div>
          <table>
            <tr>
              <td>
                  <apex:inputField value="{!betMemberRequest.External_User_Email__c}" styleClass="addmemberEmailInput" />
              </td>
              <td>
                <div style="padding-left:5px;">
                <apex:commandButton value="{!$Label.BET_Add_Member}" action="{!addExternalMember}" rendered="{!isBetOwnerOrManager}"
                                    styleClass="buttong2y" style="background: #e6007e; color:white;"/> 
                </div>
              </td>
            </tr>
          </table>


        <div class="headerButtonsBrowsMembers">
        
          <apex:commandButton value="{!$Label.BET_Delete_selected}" action="{!massDelete}"  rendered="{!isBetOwnerOrManager}"
            styleClass="buttong2y" style="background: #e6007e; color:white;height: 30px;"/> 
       
        </div>

        <table width="100%">
          <th class="browseMembersheaderStyle" style="{!IF(isBetOwnerOrManager,'','display:none')}">
            <apex:inputCheckbox value="{!selectAll}" id="globcheckboxbrowse" onchange="selectOrDeselectkAllBrowse();"/>
          </th>
          <th class="browseMembersheaderStyle">
            {!$Label.BET_Photo}
          </th>
          <th class="browseMembersheaderStyle">
            {!$Label.BET_Name}
          </th>
          <th class="browseMembersheaderStyle">
            {!$ObjectType.BET_Member_Request__c.Fields.Role__c.Label}
          </th>
          <th class="browseMembersheaderStyle" style="{!IF(isBetOwnerOrManager,'','display:none')}">
            {!$ObjectType.BET_Member_Request__c.Fields.Role__c.Label}
          </th>
          <th class="browseMembersheaderStyle" style="{!IF(isBetOwnerOrManager,'','display:none')}">
            {!$Label.BET_Delete}
          </th>
          <apex:variable var="cnt" value="{!0}" /> 
          <apex:repeat value="{!members}" var="member" id="repeater">
            <tr class="memberRow" id="{!member.objectId}" >
              <td style="{!IF(isBetOwnerOrManager,'','display:none')}">
                <apex:inputCheckbox value="{!member.isSelected}" rendered="{!NOT(member.isbetOwner)}"/>
              </td>
              <td>
                <apex:image url="{!member.photo}"/>
              </td>
              <td>
                <apex:outputText value="{!member.firstName} {!member.lastName}"/>
              </td>
              <td>
                <apex:outputText id="role" value="{!member.role}"/>
              </td>
              <td style="{!IF(isBetOwnerOrManager,'','display:none')}">
                <apex:selectList value="{!member.obj.Role__c}" required="false" size="1" disabled="{!member.isbetOwner}" multiselect="false" onchange="updateRoleOnMember('{!member.objectId}',this.value,{!cnt})">
                  <apex:selectOptions value="{!memberRoles}" />
                </apex:selectList>
              </td>
              <td style="{!IF(isBetOwnerOrManager,'','display:none')}">
                <apex:commandLink action="{!doDelete}" value="{!$Label.BET_Delete}" rendered="{!NOT(member.isbetOwner)}">
                  <apex:param name="obid" assignTo="{!selectedMemberId}" value="{!member.objectId}"/>
                </apex:commandLink>
              </td>
            </tr>
            <apex:variable var="cnt" value="{!cnt+1}"/>
          </apex:repeat>
        </table>

    </apex:tab>

    <apex:tab label="{!$Label.BET_Approve_members}" name="approveMembers" id="approveMembersid">

      <div class="headerButtons">
        
        <apex:commandButton value="{!$Label.BET_Approve_selected}" action="{!massApprove}" rendered="{!isBetOwnerOrManager}"
          styleClass="buttong2y" style="background: #e6007e; color:white;height: 30px;"/> 
       
        <apex:commandButton value="{!$Label.BET_Deny_selected}" action="{!massDeny}" rendered="{!isBetOwnerOrManager}"
          styleClass="buttong2y" style="background: #e6007e; color:white;height: 30px;"/> 
       
      </div>

      <table width="100%">
        <th class="approveMembersheaderStyle" style="{!IF(isBetOwnerOrManager,'','display:none')}">
            <apex:inputCheckbox value="{!selectAll}" id="globcheckbox" onchange="selectOrDeselectkAll();"/>
        </th>
        <th class="approveMembersheaderStyle">
            {!$Label.BET_Photo}
        </th>
        <th class="approveMembersheaderStyle">
            {!$Label.BET_Name}
        </th>
        <th class="approveMembersheaderStyle">
            {!$Label.BET_Project}
        </th>
        <th class="approveMembersheaderStyle" style="{!IF(isBetOwnerOrManager,'','display:none')}">
            {!$Label.BET_Approve}
        </th>

        <apex:repeat value="{!memberRequests}" var="memberRequest">
          <tr class="memberRequestRow">
            <td style="{!IF(isBetOwnerOrManager,'','display:none')}">
              <apex:inputCheckbox value="{!memberRequest.isSelected}"/>
            </td>
            <td>
              <apex:image url="{!memberRequest.photo}"/>
            </td>
            <td>
              <apex:outputText value="{!memberRequest.firstName} {!memberRequest.lastName}"/>
            </td>
            <td>
              <apex:outputText value="{!memberRequest.projectName }"/>
            </td>
            <td style="{!IF(isBetOwnerOrManager,'','display:none')}">
              <apex:commandLink action="{!doApprove}" value="{!$Label.BET_Approve}">
                <apex:param name="obid" assignTo="{!selectedRequestId}" value="{!memberRequest.objectId}"/>
              </apex:commandLink>
              &nbsp;|&nbsp; 
              <apex:commandLink action="{!doDeny}" value="{!$Label.BET_Deny}">
                <apex:param name="obid" assignTo="{!selectedRequestId}" value="{!memberRequest.objectId}"/>
              </apex:commandLink>
            </td>
          </tr>
        </apex:repeat>

      </table>

  
    </apex:tab>

  </apex:tabPanel>
    
  </apex:outputpanel>
  </apex:form>
</apex:page>