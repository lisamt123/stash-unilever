<apex:page standardcontroller="FAU_Email__c" extensions="FAU_SendEmail_Custom" id="mailPage"  recordSetVar="participants" sidebar="true" standardStylesheets="true">
    <apex:includescript value="{!URLFOR($Resource.FAU_CkEditor_Full,'ckeditor/ckeditor.js')}" />
    
    <style type="text/css">
        
        .customPopup {
        background-color: #f8f8f8;
        border-style: solid;
        border-width: 1px;
        border-color:#1797c0;  
        border-radius:1em;
        padding: 10px;
        position: fixed;
        z-index: 10000;
        width: 75%;
        height:80%;     
        top: 10%;
        left:15%;
        margin:0 Auto;
        }
        
        .popupBg
        {
        background-color:black;
        opacity: 0.20;
        filter: alpha(opacity = 70);
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 9999;
        }    
        h3{
        color:black;     
        font-size:1.3em;
        }         
    </style> 
    
    <script type="text/javascript">        
     var foo = function foo( shp){
        console.log( 'shp : ', document.getElementById(shp).value);
    }
</script>


    <div class="bPageTitle">
        <div class="ptBody">
            <div class="content">
                <img src="/s.gif" alt="Home" class="pageTitleIcon" title="Home"/>
                <h1 class="pageType">Task<span class="titleSeparatingColon">:</span></h1>
                <h2 class="pageDescription"> Send an Email</h2>
                <div class="blank">&nbsp;</div>
            </div>
            <div class="links"><a href="javascript:openPopupFocusEscapePounds(%27https://help.salesforce.com/apex/htdoor?loc=help&target=email_send.htm&section=Email&language=en_US&release=186.12.16&instance=CS15%27, %27Help%27, 1024, 768, %27width=1024,height=768,resizable=yes,toolbar=yes,status=yes,scrollbars=yes,menubar=yes,directories=no,location=yes,dependant=no%27, false, false);"
                                  title="Help for this Page (New Window)"><span class="helpLink">Help for this Page</span><img src="/s.gif" alt="" class="helpIcon"/></a>
            </div>
        </div>
        <div class="ptBreadcrumb"></div>
    </div>
    
    <apex:form id="form1">
        <apex:pageBlock id="theBlock" >
            <apex:pageMessages ></apex:pageMessages>
            <div style="padding-left:300px;">
                <!-- ------------------------------------PageBlock buttons-------------------------------------------- -->
                <apex:pageBlockButtons >
                    <apex:commandButton id="send" value="Send" action="{!SendEmail}" />
                   
                    <apex:commandButton id="select_template" action="{!openTemplatePopup}" value="Select Template" rerender="templatepopup"/> 
                 
                    <!-- <apex:commandButton value="Attach File" action="{!OpenAttachmentPopup}" rerender="popup"/> -->
                    <apex:commandButton id="cancel" value="Cancel" action="{!cancel}" immediate="true"/>
                    <apex:commandButton id="save" value="Save" action="{!Save}" immediate="true" />
                </apex:pageBlockButtons>
                
            </div> 
            
            <!------------------------------- From Address section ------------------------------------------------->
            
            <div class="pbSubheader brandTertiaryBgr first tertiaryPalette" id="head_1_ep">
                <font color="Black" size="2"><span class="pbSubExtra"><span class="requiredLegend brandTertiaryFgr">
                    <span class="requiredExampleOuter"><span class="requiredExample "></span>
                    </span>
                    <span class="requiredMark">*</span>
                    <span class="requiredText pbSubExtra"> = Required Information</span>
                    </span>
                    </span>
                    <h3>Edit Email<span  class="titleSeparatingColon">:</span></h3></font>
            </div>
            <apex:pageblocksection columns="1" >
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="From" style="margine-left:200px;"/>
                    <apex:outputPanel >
                        <apex:outputText value="{!FromAddresses}" style="width:31%;"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
            </apex:pageblocksection>
            
            <!------------------------------------------------To Field Section -------------------------------------->
            
            <apex:pageblockSection >
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="To"/>
                    <apex:outputPanel >
                        <apex:inputTextarea rows="3" cols="40" id="targetcontactTo"  value="{!ToField}" />
                        <apex:image url="/s.gif" alt="Lookup (New Window)" styleClass="lookupIcon"
                                    onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';"
                                    onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';"
                                    onclick="openLookupPopup3('{!$Component.targetcontactTo}','{!$Component.targetcontactToId}','Contact','Contact'); return false" title="Lookup (New Window)"/>
                        <apex:commandLink value="Clear" action="{!clearToField}"/> 
                        <apex:inputhidden id="targetcontactToId" value="{!ToFieldId}"/>
                        <apex:inputhidden id="targetcontactToEmail" value="{!ToFieldEmail}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Start Date"/>
                    <apex:inputfield value="{!emailsave.FAU_Email_Start_Date__c}"  id="date1" />
                </apex:pageBlockSectionItem>
                
            </apex:pageblockSection>
            
            <!--------------------------------------AdditionAl To Field Section -------------------------------->
            
            <apex:pageblockSection id="myoutputid">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Additional To:"/> 
                    <apex:outputPanel >
                        
                        <apex:inputTextArea rows="2" cols="50"  value="{!ShowAdditionalFieldValue}" id="AdditionalTofield"  />
                        <!-- <apex:image url="/s.gif" alt="Lookup (New Window)" styleClass="lookupIcon" 
onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';"
onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';" 
onclick="openLookupPopup3('{!$Component.AdditionalTofield}','{!$Component.AdditionalTofieldId}','Contact','Contact'); return false"
title="Lookup (New Window)"/> -->
                        <apex:inputhidden value="{!AdditionalToFieldValue}" id="AdditionalTofieldId" /> 
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                
            </apex:pageblockSection>
            
            <apex:pageblockSection >
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="CC:"/>
                    <apex:outputPanel >
                        
                        <apex:inputTextArea rows="2" cols="50"  value="{!CcFieldValue}" id="CcFieldValue" />
                        <!--<apex:image url="/s.gif" alt="Lookup (New Window)" styleClass="lookupIcon"   
onmouseout="this.className = 'lookupIcon';this.className = 'lookupIcon';"
onmouseover="this.className = 'lookupIconOn';this.className = 'lookupIconOn';"
onclick="openLookupPopup3('{!$Component.CcFieldValue}','{!$Component.CcFieldValueId}','Contact','Contact'); return false"
title="Lookup (New Window)"/> -->
                        <apex:inputhidden value="{!CcIdFieldValue}" id="CcFieldValueId" /> 
                    </apex:outputPanel>
                    
                </apex:pageBlockSectionItem>
            </apex:pageblockSection>
            
            <!--------------------------- Email SubjectLine Section -------------------------------->
           
                <apex:pageblockSection columns="1" id="emailSec">
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="Subject"/>
                        <apex:outputPanel >
                            <div class="requiredInput">
                                
                                <div class="requiredBlock"></div>
                                <apex:inputText maxlength="100" size="70" value="{!subjectLine}" id="subLine"/>
                            </div>
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem> 
                    
                    <!------------------------------------------- Email Body Section ---------------------------------->
                    <apex:pageBlockSectionItem id="emailbdy">
                        
                        <apex:outputLabel value="Body"/> 
                        <apex:outputPanel >
                            <div class="requiredInput">
                                <apex:inputTextArea styleclass="ckeditor" richtext="false"  rows="15" cols="93" value="{!BodyContent}" id="EmailBody" onchange="foo('{!$Component.EmailBody}')" />
                            </div>
                            
                            <apex:inputhidden value="{!BodyHiddenContentvalue}" id="EmailBodyId" /> 
                        </apex:outputPanel>
                        
                    </apex:pageBlockSectionItem>
                    
                </apex:pageBlockSection>
        </apex:pageBlock>
        
        <!-- -----------------------------------Template Popup Section ----------------------------------------------------->
       
        <apex:outputPanel id="templatepopup" >
            <apex:outputPanel styleClass="popupBg" layout="block" rendered="{!ShowTemplatepopup}"/>
            <apex:outputPanel id="templatepopInnerOutputPnl" styleClass="customPopup" layout="block" rendered="{!ShowTemplatepopup}" >
                
                <apex:pageBlock title="Templates">
                    <apex:outputPanel rendered="{!IF((Templatelist.size>0),'true','false')}"> 
                        <div style="height:250px;overflow:auto;">
                            <apex:pageBlockTable columns="3" border="1" value="{!Templatelist}" var="a" align="center" cellpadding="10" columnsWidth="30px,10px,20px" >
                                <apex:column headerValue="Name" >   
                                    <apex:commandlink action="{!SelectTemplate}" rerender="templatepopup,theBlock" oncomplete="ReloadCKEditor();"> {!a.Name}
                                        <apex:param name="TempID" assignTo="{!templateId}" value="{!a.id}" />
                                    </apex:commandlink>
                                </apex:column>
                                <apex:column value="{!a.TemplateType }" headerValue="Type"/>  
                                <apex:column value="{!a.Description}" headerValue="Description"/>      
                            </apex:pageBlockTable>
                        </div>
                    </apex:outputPanel>      
                    <apex:outputPanel rendered="{!IF((Templatelist.size>0),'false','true')}">
                        <div style="border: 1px solid #e0e3e5; width:100%;height:15%;margin-top:3px;">
                            <h4>
                                No Templates
                            </h4>
                        </div>
                    </apex:outputPanel>      
                </apex:pageBlock>
                
                <apex:commandButton value="Cancel" title="Close the popup" action="{!closeTemplatePopup}" rerender="templatepopup" >
                </apex:commandButton>
                
            </apex:outputPanel>
        </apex:outputPanel> 
       
        <script>
        
        var newWin=null;
        var lookUpNamex=null;
        
        //Pop up closure function
        function closeLookupPopup()
        {
            
            if (null!=newWin)
            {
                newWin.close();
            }
        }
        
        //Lookup for Selecting Contacts(To,BCC,CC,AdditionTo fields)
        function openLookupPopup3(name, id,Email,objtype,objname)
        {       var pid = "{!$CurrentPage.parameters.id}";
         var url="/apex/FAU_CustomLookupSelectionPage?namefield=" + name + "&idfield=" +id + "&ObjType="+objtype+"&ObjectName="+objname+"&id="+pid;  
         newWin=window.open(url, 'Popup','height=500,width=600,left=100,top=100,resizable=no,scrollbars=yes,toolbar=no,status=no');
         if (window.focus) 
         {
             newWin.focus();
         }
         return false;
        }
        //Function for rendering Emailbody   
        function ReloadCKEditor() {
            for(name in CKEDITOR.instances)
            {
                
                delete CKEDITOR.instances[name];
            }
            
            var editor = CKEDITOR.replace('{!$Component.mailPage:form1:theBlock:emailSec:emailbdy:EmailBody}');
            
        }  
        
        </script>  
    </apex:form>
</apex:page>