<!-- 
***************************************************************************************
*@Description:This component is used for the UI side for the Monitoring Performance break down in Market
*@Author: Cognizant
*@Created Date: 09/02/2016
*@Copyright Â© 2015  Unilever 
***************************************************************************************
-->

<apex:page Controller="IPM_PerformanceBreakdownController" sidebar="false" showHeader="false" >
    <apex:stylesheet value="{!URLFOR($Resource.IPM_Resource, 'css/IPM_GateDocument.css')}"/> 
    <apex:composition template="IPM_TemplateForPlainStyling">  
        <apex:define name="body">
            <apex:form >    
                <div class="perfBreakMsg">
                    <!-- validation error message -->
                    <apex:outputPanel id="displayError" >
                        <apex:outputPanel rendered="{!isgreaterThan && !isAppendix}" layout="block" styleClass="perfBreakdownMsgContainer">
                            <div class="brkdownErrMsg">{!$Label.IPM_Error}</div>
                            <apex:repeat value="{!greaterThanSet}" var="validErr">
                                <span class="perfBrkMsg">{!validErr}</span> 
                            </apex:repeat>
                        </apex:outputPanel>
                    </apex:outputPanel> 
                    <!-- Misaligned error message -->
                    <apex:outputPanel id="displayError2" >
                        <apex:outputPanel rendered="{!isMisaligned && !isAppendix}" layout="block" styleClass="perfBreakdownMsgContainer">
                            <div class="brkdownWarningMsg">{!$Label.IPM_Warning}</div> 
                            <apex:repeat value="{!misAlignedList}" var="validErr">
                                <span class="perfBrkMsg">{!validErr}</span>
                            </apex:repeat>
                        </apex:outputPanel>
                    </apex:outputPanel>   
                </div>
                <apex:actionStatus startText="" id="Loading" startStyleClass="cust-overlay"/>
                <!-- Currency change  -->
                <apex:outputPanel layout="block" styleClass="performanceDrpdownContainer" Rendered="{!!isAppendix}">
                    <apex:outputLabel styleClass="selCur" value="{!$Label.IPM_Please_select_country}"/> 
                    <apex:selectList styleClass="selCur" id="slst" size="1" value="{!selectedCurrency}"> 
                        <apex:actionSupport status="Loading" event="onchange" action="{!applyRate}" reRender="monitoringPerformaceTable,displayError2"/> 
                        <apex:selectOptions value="{!items}"/>
                    </apex:selectList>
                </apex:outputPanel>
                <!-- Market performance fields Name -->
                <apex:outputPanel id="monitoringPerformaceTable" layout="block" styleClass="breakdown_Container"> 
                    <div class="scrollContainer">   
                        <div class="performanceContainer1">
                            <div class="performanceHead"> {!$Label.IPM_Financial_Target_Months} </div>
                            <apex:repeat value="{!$ObjectType.IPM_MarketPerformanceBreakdown__c.FieldSets.UML_KeyMetrics}" var="field">
                                <div class="performanceHead">
                                    <apex:outputText value="{!field.Label}"/>  
                                </div>             
                            </apex:repeat>
                        </div>
                        <!-- Market performance data details -->
                        <apex:outputPanel id="marketPerformance" layout="block" styleClass="performanceContainer2">
                            <div class="performanceSecHead">{!$Label.IPM_Market_Performance}</div>
                            <apex:repeat value="{!$ObjectType.IPM_MarketPerformance__c.FieldSets.UML_Breakdown}" var="field" >
                                <div class="performanceSecHead {!If(contains(sMisalignmentMsg, field.Label) , 'misaligned','')}">
                                    <apex:outputfield value="{!marketperformance[field]}" rendered="{!AND(field='TargetLaunchDate__c' , marketperformance[field]!=null)}"/>
                                    <apex:outputText value="{!marketperformance[field]}" rendered="{!AND(field!='TargetLaunchDate__c',field!='IPM_Gross_Turnover__c',field!='IPM_Gross_BMI__c',field!='IPM_Gross_PBI__c',field!='AverageRetailPrice__c',field!='MediaSpend__c')}"/>
                                    <apex:outputText value="{!grossTurnover}" rendered="{!field='IPM_Gross_Turnover__c'}"/>
                                    <apex:outputText value="{!grossBMI}" rendered="{!field='IPM_Gross_BMI__c'}"/>
                                    <apex:outputText value="{!grossPBI}" rendered="{!field='IPM_Gross_PBI__c'}"/>
                                    <apex:outputText value="{!averageRetailPrice}" rendered="{!field='AverageRetailPrice__c'}"/>
                                    <apex:outputText value="{!mediaSpend}" rendered="{!field='MediaSpend__c'}"/>
                                </div>
                            </apex:repeat>
                        </apex:outputPanel>
                        <!-- CMI,Finance,PL,DPL user has to fill below 13 records -->
                        <apex:outputPanel id="marketPerformances" layout="block" styleClass="performanceContainer3">
                            <apex:repeat value="{!marketPerformanceBreakdownList}" var="marketBrkDwn">
                                <div class="performanceCell">  
                                </div>
                                <apex:repeat value="{!$ObjectType.IPM_MarketPerformanceBreakdown__c.FieldSets.UML_KeyMetrics}" var="field">
                                    <div class="performanceCell">
                                        <apex:variable value="{!marketBrkDwn.id}{!field}" var="rowNum"/>
                                        
                                        <div class="">
                                            <apex:inputfield styleClass="celltext {!mapWithRecordNCell[rowNum]}" value="{!marketBrkDwn[field]}"  rendered="{!AND(isEditable,field!='Period__c')}" html-onpaste="return paste(event,this);" onkeypress="return isNumber(event,this);"/>
                                        </div>
                                        
                                        <apex:outputText value="{!marketBrkDwn[field]}"  rendered="{!AND(isEditable,field='Period__c')}"/>
                                        <apex:outputText value="{!marketBrkDwn[field]}" rendered="{!!isEditable}"/>  
                                    </div>             
                                </apex:repeat>          
                            </apex:repeat>
                        </apex:outputPanel>
                        
                    </div>
                    <!-- Save button -->    
                    <apex:outputPanel layout="block" id="showbuttons" styleClass="performancebuttonContainer">
                        <apex:commandButton styleClass="ipmButton primary" action="{!saveRecords}" value="{!$Label.IPM_SAVE}" id="theButton" reRender="marketPerformance,marketPerformances,performanceHeaderValues,slst,displayError,displayError2" status="Loading" rendered="{!isEditable}"/>
                    </apex:outputPanel> 
                </apex:outputPanel>
            </apex:form>
        </apex:define>
    </apex:composition>
    <script src="{!URLFOR($Resource.IPM_Resource, 'js/iframeResizer.contentWindow.min.js')}" type="text/javascript"></script>
</apex:page>