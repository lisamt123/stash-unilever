<apex:page showHeader="false" sidebar="false" docType="html-5.0" controller="Oblix_SOWCampaignCreateController" standardStylesheets="true">
    <apex:composition template="Oblix_OuterPageTemplate">
        <apex:define name="top_breadcrumb">
            <a href="/apex/oblix_sowmain">SWOP Home</a>&nbsp;<span>&#9658;</span>&nbsp;<a href="/apex/oblix_sowmaindetail?sowId={!IF(campaignHelper.isEdit,  campaignHelper.selectedProject.Financial_Year__c, campaignHelper.selectedSow.Id)}">{!IF(campaignHelper.isEdit,  campaignHelper.selectedProject.Financial_Year__r.Name, campaignHelper.selectedSow.Name)}</a>&nbsp;<span>&#9658;</span>&nbsp;{!campaignHelper.selectedProject.Name}
        </apex:define>
        <apex:define name="header_text" />

        <apex:define name="top_option_links" />

        <apex:define name="top_right_panel">
        </apex:define>
        <apex:define name="body_content">


            <apex:actionFunction name="setInfoCountries" action="{!setInfoCountries}" reRender="investmentPriority" immediate="true">
                <apex:param name="mainRegion" assignTo="{!selectedMainRegions}" value="" />
                <apex:param name="region" assignTo="{!campaignHelper.selectedProject.OblixRegion__c}" value="" />
                <apex:param name="countries" assignTo="{!campaignHelper.selectedProject.Campaign_Countries__c}" value="" />
            </apex:actionFunction>

            <apex:actionFunction name="setAgencyHubAndSavePage" action="{!setAgencyHubSplit}" rerender="jqueryId">
                <apex:param name="splitId" assignTo="{!agencyHubSplitWrapperListJSONString}" value=""/>
                <apex:param name="cloneName" assignTo="{!cloneName}" value=""/>
            </apex:actionFunction>

            <apex:actionFunction name="setCampaignScale" action="{!setCampaignScale}" reRender="agencyScale" immediate="true">
                <apex:param name="numberOFSelectedCountries" assignTo="{!campaignHelper.numberOFSelectedCountries}" value="" />
            </apex:actionFunction>

            <apex:actionFunction name="setCampaignScaleOneGlobal" action="{!setCampaignScaleOneGlobal}" rerender="investmentPriority" immediate="true">
            
            </apex:actionFunction>

            <!-- <apex:actionFunction name="setInfoDrivers" action="{!setInfoDrivers}" reRender="false">
                <apex:param name="innovation" assignTo="{!campaignHelper.selectedProject.Innovation_Projects__c}" value="" />
                <apex:param name="innov" assignTo="{!campaignHelper.selectedBrandInnovation}" value="{!campaignHelper.selectedBrandInnovation}" />
                <apex:param name="brand" assignTo="{!campaignHelper.selectedBrandBrand}" value="{!campaignHelper.selectedBrandBrand}" />
                <apex:param name="idea" assignTo="{!campaignHelper.selectedProject.Campaign_Idea__c}" value="" />
                <apex:param name="scale1" assignTo="{!campaignHelper.selectedProject.Project_Scale_1__c}" value="" />
                <apex:param name="scale2" assignTo="{!campaignHelper.selectedProject.Project_Scale_2__c}" value="" />
            </apex:actionFunction> -->

            <apex:outputPanel rendered="{!campaignHelper.doClone}">
                <div class="row">
                    <div class="col-lg-8 col-md-8">
                        <div class="alert alert-info" role="alert">
                            To clone this campaign please enter a new unique name and check all campaign set up fields below e.g Investment Priority, Agency Hub Splits, Clusters/Countries etc
                        </div>
                    </div>
                </div>
            </apex:outputPanel>

            <div class="row">
                <div class="col-lg-6 col-md-6">
                    <apex:outputText rendered="{!campaignHelper.isEdit && !campaignHelper.doClone}"><h1 class="SOW_header_title">Edit {!campaignHelper.selectedProject.Name}</h1></apex:outputText>
                    <apex:outputText rendered="{!campaignHelper.isEdit && campaignHelper.doClone}"><h1 class="SOW_header_title">Clone {!campaignHelper.selectedProject.Name}</h1></apex:outputText>
                    <apex:outputText rendered="{!!campaignHelper.isEdit}"><h1 class="SOW_header_title">Add campaign to {!campaignHelper.selectedSow.Name}</h1></apex:outputText>
                </div>

            </div>
            <hr class="divider" />
            <apex:outputText rendered="{!NOT(campaignHelper.onlyShowProjectedChevron)}">
                <div class="row new_sow_form">
                    <div class="col-lg-4 col-md-4">
                        <div>
                            <div class="form-group" id="campaignNameLabel">
                                <label for="SOWName" class="create_SOW_form_titles">Campaign Name*</label>
                                <apex:inputField styleClass="form-control" id="CampaignName" value="{!campaignHelper.selectedProject.Name_Prefix__c}" rendered="{!!campaignHelper.doClone}"/>
                                <apex:inputText styleClass="form-control" id="CloneName" value="{!cloneName}" rendered="{!campaignHelper.doClone}"/>
                            </div>
                            <!-- <div class="form-group" id="campaignNameLabel">
                                <label for="SOWName" class="create_SOW_form_titles">Campaign Name*</label>
                                <apex:outputText styleClass="form-control" id="CampaignName" value="{!campaignHelper.selectedProject.Name}" rendered="{!!campaignHelper.doClone}"/>
                                <apex:inputText styleClass="form-control" id="CloneName" value="{!cloneName}" rendered="{!campaignHelper.doClone}"/>
                            </div> -->
                            <div class="form-group">
                                <p>Description&nbsp;<span class="form_bracket_text">(Optional)</span>
                                </p>
                                <apex:inputField styleClass="form-control multi_line_form_style" value="{!campaignHelper.selectedProject.Description__c}" />
                            </div>
                            <div id="agencyHubSplitLabel">
                                <apex:actionRegion >
                                    <apex:outputPanel id="projectsplitSelections">
                                        <table class="campaign_create_agency_hub_split_table">
                                            <tr>
                                                <td colspan="4" class="create_SOW_form_titles">Agency hub split*</td>
                                            </tr>
                                            <tr>
                                                <td class="campaign_create_agency_hub_split_table_subtitle" colspan="4">List lead agency market and any other supporting agency hub with %</td>
                                            </tr>

                                            <apex:variable value="{!1}" var="display" />
                                            <apex:repeat value="{!campaignHelper.agencySplitHubs}" var="split">
                                                <tr>
                                                    <td class="{!if(display == 1,'campaign_create_agency_hub_split_table_subhead','')} "> <strong><div style="display :{!if(display == 1,'block','none')} ">&nbsp;{!$Label.Oblix_lbl_UIUX_Lead_Agency}</div></strong>
                                                    </td>
                                                    <td style="display:none">
                                                        <div class="idSplit_{!display}" style="display:none">{!split.id}</div>
                                                    </td>
                                                    <td>
                                                        <apex:selectList value="{!split.OblixCountry__c}" multiselect="false" size="1" styleClass="countrySplit_{!display}" onchange="setAgencyHubSplit();">
                                                            <apex:selectOptions value="{!campaignHelper.countryOptions}" />
                                                        </apex:selectList>
                                                    </td>
                                                    <td class="agency_hub_last_cell_spacing">
                                                        <apex:inputText html-type="number" html-step="0.01" value="{!split.Percentage__c}" style="width:60px" styleClass="campaign_create_agency_hub_split_table_value percentage percentageSplit_{!display}" html-onPaste="return false;" onkeypress="return onKeyPress_IsDigitAndDecimalValidation(event, this);"/> %</td>
                                                </tr>
                                                <apex:variable var="display" value="{!display + 1}" />
                                            </apex:repeat>
                                        </table>
                                    </apex:outputPanel>
                                </apex:actionRegion>
                                <div class="campaign_create_agency_hub_split_table_subtitle">
                                    <apex:commandLink action="{!addOneMoreProjectSplitInstance}" value="Add Row" rerender="projectsplitSelections" onClick="incrementCounter();"></apex:commandLink>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4">
                        <div>
                            <div class="form-group">
                                <p>Platform&nbsp;<span class="form_bracket_text">(Optional)</span>
                                </p>
                                <apex:inputField styleClass="form-control" id="platform" value="{!campaignHelper.selectedProject.Platform__c}" />
                            </div>
                            <div class="form-group">
                                <p>Jobs to be done&nbsp;<span class="form_bracket_text">(Optional)</span>
                                </p>
                                <apex:inputField styleClass="form-control multi_line_form_style" value="{!campaignHelper.selectedProject.Jobs_to_be_Done__c}" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-8 status_completion_chevron_bar campaign_create_chevron">
                        <a id="stagesPopover" class="text-info campaignCreateChevronTooltip" href="#" rel="popover" data-placement="right" data-title="Select Stage Percentage Values" data-html="true" data-content="<b>Briefing</b> - 10%<br/><b>Strategy & Planning</b> - 20%<br/><b>Creative Ideation</b> - 30%<br/><b>Creative Execution</b> - 25%<br/><b>Production</b> - 15%<br/>" data-trigger="hover focus" data-toggle="popover">See recommended %</a>
                        <div class="chevron_width_control">
                            <div class="status_completion_chevron_bar_main_styling">
                                <p class="create_SOW_form_titles" id="stagesLabel">Choose stages for this FY*</p>
                                <p class="campaign_create_agency_hub_split_table_subtitle">Confirm which stages of the project will be completed in the current year.</p>
                            </div>
                            <c:Oblix_CampaignStage StageIdentifier="{!stage_identifier}" AutoSave="false" />
                        </div>
                    </div>
                </div>
                <div class="row">

                    <div class="col-lg-8">
                    <div id="countriesLabel">
                        <div class="countries_multi_select">
                            <div class="campaign_region_picklist">
                                <p class="create_SOW_form_titles">Clusters / Countries*</p>
                                <p class="campaign_create_agency_hub_split_table_subtitle">Please indicate which markets your campaign will be developed for. Global OR a whole cluster and/or specify individual countries.</p>      
                            </div> 
                            <div>
                                <div class="ms-container" id="ms-country-select">
                                    <div class="ms-selectable">
                                        <div class="campaign_create_agency_hub_split_table_subtitle global_region_picklist" style="display:flex;">
                                            <input type="checkbox" name="FYprojectStages" class="countries_global_checkbox" onchange="setAsGlobal()" />Set as global (only for campaigns in all clusters)
                                        </div>
                                        <ul class="ms-list region_margin_top" tabindex="-1">
                                            <apex:repeat value="{!campaignHelper.unileverRegions}" var="eachRegion">
                                                <li class="ms-elem-selectable clusters" id="region-selectable-{!eachRegion}" ><span class="regionArea">{!eachRegion}</span><span class="region_select_info_text"></span></li>
                                            </apex:repeat>
                                        </ul>
                                    </div>
                                    <div class="ms-selectable ms_select_margin">
                                        <input type="text" id="search_input" class="search-input" autocomplete="off" placeholder="Search for countries"/>
                                        <ul id="search_list" class="ms-list" tabindex="-1">
                                            <apex:repeat value="{!campaignHelper.allCountries}" var="eachCountry">
                                                <li class="ms-elem-selectable countries" id="selectable-{!campaignHelper.countriesWithRegionsMap[eachCountry]}-{!eachCountry}"><span class="countryArea">{!eachCountry}</span><span class="country_select_info_text">{!campaignHelper.countriesWithRegionsMap[eachCountry]}</span></li>
                                            </apex:repeat>
                                        </ul>
                                    </div>
                                    <div class="ms-selection">
                                        <ul class="ms-list ms_basket" tabindex="-1">
                                            <li class="ms_basket_title" id="-770596381-selection"><span><strong>Your selection</strong></span><a href="" id="clearAllCountries deselect-all-countries" onclick="removeAllFromBasket()">Remove all</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-8 investment_project_box">
                        <div class="col-lg-6" id="innovationLabel">
                            <h2>Investment Priority</h2>
                            <apex:variable var="innovationSelected" value="{!campaignHelper.selectedBrandInnovation != null && campaignHelper.selectedBrandBrand == null}"/>
                            <apex:variable var="brandSelected"      value="{!campaignHelper.selectedBrandBrand != null && campaignHelper.selectedBrandInnovation == null}"/>
                            <div>
                                <p class="create_SOW_form_titles">Please Choose Innovation Projects or Brand Led Growth*</p>
                                <apex:outputText rendered="{! innovationSelected}">
                                    <input class="Innovation" type="radio" name="innovation" value="Innovation" onchange="$('.projBrandBrand').attr('disabled','disabled');$('.projBrandBrand')[0].selectedIndex=0;$('.projBrandInnov').removeAttr('disabled');" checked="checked"/>
                                </apex:outputText>
                                <apex:outputText rendered="{! NOT(innovationSelected)}">
                                    <input class="Innovation" type="radio" name="innovation" value="Innovation" onchange="$('.projBrandBrand').attr('disabled','disabled');$('.projBrandBrand')[0].selectedIndex=0;$('.projBrandInnov').removeAttr('disabled');" />
                                </apex:outputText>
                                <apex:selectList value="{!campaignHelper.selectedBrandInnovation}" multiselect="false" size="1" styleClass="investment_project_dropdowns_left input_init projBrandInnov" onchange="setInvestmentPriorityInnovationProject();">
                                    <apex:selectOptions value="{!campaignHelper.innovationOptions}" />
                                </apex:selectList>
                                <br/>
                                <p class="campaign_create_agency_hub_split_table_subtitle" style="padding:0;">{!$Label.Oblix_lbl_UIUX_Identifying_priorities}</p>
                            </div>
                            <div>
                                <apex:outputText rendered="{! brandSelected }">
                                    <input class="Brand_Led_Growth" type="radio" name="innovation" value="Brand Led Growth" onchange="$('.projBrandBrand').removeAttr('disabled');$('.projBrandInnov').attr('disabled','disabled');$('.projBrandInnov')[0].selectedIndex=0;" checked="checked"/>
                                </apex:outputText>
                                <apex:outputText rendered="{! NOT(brandSelected)}">
                                    <input class="Brand_Led_Growth" type="radio" name="innovation" value="Brand Led Growth" onchange="$('.projBrandBrand').removeAttr('disabled');$('.projBrandInnov').attr('disabled','disabled');$('.projBrandInnov')[0].selectedIndex=0;" />
                                </apex:outputText>
                                <apex:selectList value="{!campaignHelper.selectedBrandBrand}" multiselect="false" size="1" styleClass="investment_project_dropdowns_left input_init projBrandBrand" onchange="setInvestmentPriorityBrandLedGrowth();">
                                    <apex:selectOptions value="{!campaignHelper.brandOptions}" />
                                </apex:selectList>
                                <br/>
                                <p class="campaign_create_agency_hub_split_table_subtitle" style="padding:0;">{!$Label.Oblix_lbl_UIUX_Identifying_priorities2} </p>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="create_SOW_form_titles_investment">
                                <div id="campaignIdeaLabel" class="margin_top20">
                                    <p class="create_SOW_form_titles">{!$ObjectType.Oblix_SOW_Projects__c.fields.Campaign_Idea__c.label}*</p>
                                    <apex:inputField value="{!campaignHelper.selectedProject.Campaign_Idea__c}" style="width:80%" styleClass="investment_project_dropdowns_right projCampaignIdea" />
                                </div>
                                <apex:actionRegion >
                                    <apex:outputPanel id="investmentPriority">
                                        <div id="geographicCoverage" class="margin_top40">
                                            <p class="create_SOW_form_titles" id="geographicCoverage">{!$ObjectType.Oblix_SOW_Projects__c.fields.Project_Scale_1__c.label}*</p>
                                            <apex:inputField value="{!campaignHelper.selectedProject.Project_Scale_1__c}" style="width:80%" styleClass="input_init projScale1" />
                                        </div>
                                    </apex:outputPanel>
                                    <apex:outputPanel id="agencyScale">
                                        <div id="campaignScaleLabel" class="margin_top40">
                                            <p class="create_SOW_form_titles" id="campaignScaleLabel">{!$ObjectType.Oblix_SOW_Projects__c.fields.Project_Scale_2__c.label}*</p>
                                            <apex:inputField value="{!campaignHelper.selectedProject.Project_Scale_2__c}" style="width:80%" styleClass="input_init projScale2" />
                                        </div>
                                    </apex:outputPanel>
                                </apex:actionRegion>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-8 create_campaign_priority no_padding">
                        <div class="col-lg-6 no_padding">
                            <p>{!$ObjectType.Oblix_SOW_Projects__c.fields.Project_Priority__c.label}&nbsp;<span class="form_bracket_text">(Optional)</span>
                            </p>
                            <apex:inputField value="{!campaignHelper.selectedProject.Project_Priority__c}" styleClass="priority_input"/>
                        </div>
                        <div class="col-lg-6">
                            <p>BET Required?&nbsp;<span class="form_bracket_text">(Optional)</span>
                            </p>
                            <apex:inputField value="{!campaignHelper.selectedProject.BET_Required__c}" styleClass="priority_input"/>
                        </div>
                        <div class="col-lg-12 no_padding">
                            <hr class="divider" />
                        </div>
                        <div class="col-lg-8">
                            <p>Dates to show on the campaign timeline&nbsp;<span class="form_bracket_text">(Optional)</span>
                            </p>
                            <table>
                                <tr>
                                    <td class="campaign_create_agency_hub_split_table_subtitle">Campaign start</td>
                                    <td class="table_date_formatting">
                                        <apex:inputField value="{!campaignHelper.selectedProject.Project_Start_Date__c}" />
                                    </td>
                                    <td class="campaign_create_agency_hub_split_table_subtitle">First air date</td>
                                    <td class="table_date_formatting">
                                        <apex:inputField value="{!campaignHelper.selectedProject.First_Air_Date__c}" styleclass="dateFAD" />
                                    </td>
                                    <td class="campaign_create_agency_hub_split_table_subtitle">Preview date</td>
                                    <td class="table_date_formatting">
                                        <apex:inputField value="{!campaignHelper.selectedProject.Preview_Date__c}" styleclass="dateProjPREV" />
                                    </td>
                                </tr>
                                <tr>
                                    <td class="campaign_create_agency_hub_split_table_subtitle">Campaign completion</td>
                                    <td class="table_date_formatting">
                                        <apex:inputField value="{!campaignHelper.selectedProject.Project_Completion_Date__c}" styleclass="dateProjCD" />
                                    </td>
                                    <td class="campaign_create_agency_hub_split_table_subtitle">BET first release</td>
                                    <td class="table_date_formatting">
                                        <apex:inputField value="{!campaignHelper.selectedProject.BET_first_release__c}" styleclass="dateProjBFR" />
                                    </td>
                                    <td class="campaign_create_agency_hub_split_table_subtitle">BET final release</td>
                                    <td class="table_date_formatting">
                                        <apex:inputField value="{!campaignHelper.selectedProject.Final_release__c}" styleclass="dateProjFR" />
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>  
                </div>
            </apex:outputText>
            <apex:outputText rendered="{!campaignHelper.onlyShowProjectedChevron}">
                <div class="row">
                    <div class="col-lg-8 campaign_create_chevron">
                        <div class="chevron_width_control">
                            <div class="status_completion_chevron_bar_main_styling">
                                <p class="create_SOW_form_titles" id="stagesLabel">Choose stages for this FY*</p>
                                <p class="campaign_create_agency_hub_split_table_subtitle">Confirm which stages of the project will be completed in the current year.</p>
                            </div>
                            <c:Oblix_CampaignStage StageIdentifier="{!stage_identifier}" AutoSave="false" displayMode="3" showTotalPercentage="true"/>
                        </div>
                    </div>
                </div>
            </apex:outputText>
            <div class="row">
                <div class="col-lg-8">
                    <div class="campaign_create_buttons">
                        <apex:commandButton value="SAVE CAMPAIGN" rendered="{!NOT(campaignHelper.onlyShowProjectedChevron)}" onclick="validateCountrySplit(); return false; " styleClass="btn btn-primary btn-sm pull-right btn_save_campaign btn_check" disabled="{!IF(can_edit,FALSE,TRUE)}" oncomplete="window.scrollTo(0,0);"/>
                        <apex:commandButton value="SAVE CAMPAIGN" rendered="{!campaignHelper.onlyShowProjectedChevron}" action="{!saveProjectAction}" styleClass="btn btn-primary btn-sm pull-right btn_save_campaign btn_check" disabled="{!IF(can_edit,FALSE,TRUE)}"/>
                        <apex:commandButton value="CANCEL" action="{!backAction}" title="Cancel" styleClass="btn btn-sm pull-right btn_cancel btn_cross" immediate="true" html-formnovalidate="formnovalidate" />
                    </div>
                </div>
            </div>
        </apex:define>
        <apex:define name="page_scripts">
            <script src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/js/swopJS.js')}" />
            <script src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/js/fastLiveFilter.min.js')}" />
            <script src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/js/underscore.min.js')}" />
            <script src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/js/biMap.js')}" type="text/javascript"></script>
            <script>
                var mapRegionCountries = {!campaignHelper.regionsWithCountriesMapJSON};
                var preSelectedCountries = {!if (campaignHelper.selectedCountriesJSON <> null, campaignHelper.selectedCountriesJSON, '[]')};
                var preSelectedMainRegions = {!if (campaignHelper.selectedMainRegionJSON <> null, campaignHelper.selectedMainRegionJSON, '[]')};
                var preSelectedRegions = {!if (campaignHelper.selectedRegionsJSON <> null, campaignHelper.selectedRegionsJSON, '[]')};
                var unileverRegions = "{!campaignHelper.unileverRegions}";
                var isGlobalCampaign = {!campaignHelper.isGlobalCampaign};
                var counter = {!campaignHelper.numberOfAgencyHubSplits};
                var bimap = new BiMap;
                bimap.push(mapRegionCountries);
                var selectedCountries = [];
                var selectedRegions = [];
                var currentUnion = [];
                console.log(unileverRegions);
                window.scrollTo(0,0);
            </script>
            <script src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/js/Oblix_CampaignCreate.js')}" type="text/javascript"></script>
        </apex:define>
    </apex:composition>
</apex:page>