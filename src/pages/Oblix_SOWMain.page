<apex:page sidebar="false" controller="Oblix_SowMainController" docType="html-5.0" showHeader="false" standardStylesheets="false">

    <apex:composition template="Oblix_OuterPageTemplate">

        <apex:define name="top_breadcrumb"/>
        <apex:define name="header_text">
            SOW List
        </apex:define>

        <apex:define name="top_option_links"/>

        <apex:define name="top_right_panel">
            <apex:commandButton value="CREATE SOW" action="{!CreateSOWAction}" styleClass="btn btn-primary btn-xs pull-right btn_plus btn_create_sow" onclick="blockme()" rendered="{!IF(can_create_sow,true,false)}" reRender="jqueryId,jqueryId2" />
        </apex:define>

        <apex:define name="body_content">

            <apex:outputPanel rendered="{!IF(thousandBlocks.size == 0,true,false)}" id="welcomeMessage">
                <div class="row SOW_homepage_welcome_message">
                    <div class="col-lg-8 col-lg-offset-3">
                        <h1>Hi {!userConnected.Name}</h1>
                        <h5>You have not created any SOW yet. Click the button to get started</h5>
                        <img alt="Create SOW" src="{!URLFOR($Resource.Oblix_SwopAssets, 'Oblix_SwopAssets/images/arrow-green-up-right.png')}" width="96" height="77"/>
                    </div>
                </div>
            </apex:outputPanel>

            <hr class="divider" />
            <apex:outputPanel rendered="{!IF(thousandBlocks.size > 0,true,false)}" id="sowListItems">
                <div class="row">
                    <div class="col-lg-6 col-md-6">
                        <!--p>Showing 1 to 10 of 17 entries&nbsp;&nbsp;|&nbsp;&nbsp;Show
                        <select class="Oblix_picklist id=" name="" placeholder="10">
                            <option value="5">5</option>
                            <option value="10" selected="selected">10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                            entries</p-->
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12 ">
                        <div class="pull-right SOW_homepage_find">
                            <label>Find a specific SOW</label>
                            <input type="text" name="findSOW" id="searchBox" />
                        </div>

                        <div class="Oblix_table" id="Oblix_DashId">
                            <table class="table table-striped" id="sowListTable">
                                <thead>
                                    <tr>
                                        <th style="display:none;width:0px !important">{!$ObjectType.Marketing_SOW__c.fields.Id.label}</th>
                                        <th>{!$ObjectType.Marketing_SOW__c.fields.Name.label}</th>
                                        <th>{!$ObjectType.Marketing_SOW__c.fields.OblixBrand__c.label}</th>
                                        <th>{!$ObjectType.Marketing_SOW__c.fields.Oblix_AgencyEstimate__c.label}</th>
                                        <th>{!$Label.Oblix_Lbl_UIUX_Last_updated}</th>
                                        <th>{!$ObjectType.Marketing_SOW__c.fields.SOW_Status__c.label}</th>
                                        <th>Current SOW Total</th>

                                    </tr>
                                </thead>
                                <tbody>
                                    <apex:repeat value="{!thousandBlocks}" var="block">
                                        <apex:repeat value="{!block.lstMarketingSows}" var="sow">
                                            <tr>
                                                <td style="display:none;width:0px !important">{!sow.Id}</td>
                                                <td>{!sow.Name}</td>
                                                <td>{!sow.OblixBrand__r.Name}</td>
                                                <td width="15%">{!sow.Oblix_AgencyEstimate__r.name}</td>
                                                <td>
                                                    <apex:outputText value="{0,date,MM'/'dd'/'yyyy}">
                                                        <apex:param value="{!sow.LastModifiedDate}" /></apex:outputText>
                                                </td>
                                                <td>{!sow.SOW_Status__c}</td>
                                                <td>â‚¬&nbsp;
                                                    <apex:outputText value="{0, number,###,###,##0}">
                                                        <apex:param value="{!sow.Total_Campaigns_This_FY__c+sow.OblixTotalOtherItemsFees__c}" />
                                                    </apex:outputText>
                                                </td>
                                            </tr>
                                        </apex:repeat>
                                    </apex:repeat>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </apex:outputpanel>

            <apex:actionFunction name="redirectToSOWDetailPage" action="{!redirectToSOWDetailPage}" reRender="jqueryId,jqueryId2">
                <apex:param name="selectedSowId" assignTo="{!selectedSowId}" value="" />
            </apex:actionFunction>
        </apex:define>
        <apex:define name="page_scripts">
            <script type="text/javascript">
            $(document).ready(function() {
                $.unblockUI();
                var table = $('#sowListTable').DataTable({
                    "dom": 'lrtip',
                    'pagingType': 'full_numbers'
                });
                $('#searchBox').on('keyup', function() {
                    table.search(this.value).draw();

                });
                $('#sowListTable tbody').on('click', 'tr', function() {
                    blockme();
                    $(this).toggleClass('selected');
                    $(this).addClass('bg_selected');
                    var ids = $.map(table.rows('.selected').data(), function(item) {
                        return item[0];
                    });
                    redirectToSOWDetailPage(ids);
                });

            });
        </script>
        </apex:define>
    </apex:composition>
</apex:page>