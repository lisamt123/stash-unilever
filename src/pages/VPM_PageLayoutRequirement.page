<apex:page standardController="VPM_PurchasingRequests__c" extensions="VPM_PurchaseRequestsControllerExtension" standardStylesheets="true" sidebar="false" >
    <script>

  function func()
  {
  alert('Only relevant for Manual Blocks/Unblocks/Deletes/Undeletes'); 
  }
  function openAdvanceform()
  {
  debugger;
  window.location = 'apex/VPM_AdvancedForm?id={!VPM_PurchasingRequests__c.Id}'; 
  var localhost = document.domain;
  window.top.location='https://'+localhost+'/apex/VPM_AdvancedForm?id={!VPM_PurchasingRequests__c.Id}';
  }
   function PageReload()
  {
  debugger;
  var localhost = document.domain;
  window.top.location='https://'+localhost+'/{!VPM_PurchasingRequests__c.id}';
  return false;
  }
    function reworkBtnClick(){
        debugger;
        var purId="{!VPM_PurchasingRequests__c.Id}";
        var currentstatus="{!VPM_PurchasingRequests__c.VPM_Status__c}"; 
        var LastGroup = "{!VPM_PurchasingRequests__c.VPM_RequestLastWithGroup__c}"; 
        var FinanceApproveRequired ="{!VPM_PurchasingRequests__c.VPM_FinanceApprovalRequired__c}"; 
        var ProcurementApproveRequired = "{!VPM_PurchasingRequests__c.VPM_ProcurementApprovalRequired__c}"; 
        var CreatedBy="{!VPM_PurchasingRequests__c.CreatedById}"; 
        var rework ="{!VPM_PurchasingRequests__c.VPM_Rework__c}";
        debugger;
            if ((currentstatus.indexOf('Draft') >= 0 )||(rework=='Yes') || (currentstatus.indexOf('MDM Ops') >= 0 ))    
            { 
                if(rework=='Yes') 
                { 
                    alert('Already send for rework'); 
                } 
                else 
                { 
                    alert('Business Requestor & MDM Ops cannot send for rework'); 
                } 
                
            }
        else
        {
            var r = confirm("Are you sure you want to rework the request? \nPlease provide guidance via the Chatter feed"); 
            if(r == true) 
               {
                    ReworkAction();
                    return false;
               }
            
            else 
                alert("Rework Cancelled");
            
        } 
        }
     
  </script>
    <apex:form >
        <apex:commandButton value="Send to SAP" action="{!callCreateVendorAPI}" rendered="{!RenderSAPBtn}" 
        disabled="{!NOT(enableSendToSAPBtn)}" />
        <apex:commandButton value="Manually Mark as complete" rendered="{!ManuallyMarkasCompletebtn}" action="{!ManuallyMarkAsCompleteAction}" />
        <!--apex:commandButton value="Rework" rendered="{!ReworkBtn}" onclick='reworkBtnClick()'/-->  
         <apex:commandButton value="Rework"  disabled="{!NOT(ReworkBtn)}" onclick="reworkBtnClick();return false;"/> 
        <apex:commandButton value="Submit Request"  action="{!SubmitRequestAction}" />
      
        <apex:actionFunction name="ReworkAction" action="{!ReworkAction}" reRender="out" oncomplete="PageReload()"/>
          <apex:outputText value="{!callJavaScriptAlert}" escape="false"></apex:outputText>
    </apex:form>    
</apex:page>