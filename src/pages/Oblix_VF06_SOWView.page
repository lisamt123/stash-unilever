<apex:page sidebar="false" controller="Oblix_Ctrl06SOWView_CC" docType="html-5.0">

  <!--<apex:form id="jqueryId">-->
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <script src="//cdn.datatables.net/1.10.0/js/jquery.dataTables.js"></script>
    <script type="text/javascript" src="{!URLFOR($Resource.jquerydataTablescolumnFilter)}"></script>
    <link rel="stylesheet" href="//cdn.datatables.net/1.10.0/css/jquery.dataTables.css" />
    
    <link rel="stylesheet"  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.css" />
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css"/>
    <script src="{!URLFOR($Resource.JQueryBlockUI)}" ></script>

    <script type="text/javascript" src="https://code.highcharts.com/highcharts.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
    
   
    <script type="text/javascript">
    
    $(document).ready(function() {
           $.unblockUI();
    });
    $j = jQuery.noConflict();
    
    function blockme() {
       $.blockUI({ css: { 
            border: 'none', 
            padding: '15px', 
            backgroundColor: '#000', 
            '-webkit-border-radius': '10px', 
            '-moz-border-radius': '10px', 
            opacity: .5, 
            color: '#fff' 
        } }); 
    }
  
   </script>  
    
     <script>
          $ = jQuery.noConflict(); 
           $(document).ready(function(){
              $('#example').dataTable({
                     
                     })
                     .columnFilter({
                      
                        aoColumns: [
                                null,
                                null,
                                null,
                                null,
                                null,
                                null,
                                null,
                                null
                            ]
            
                    });
                     var table = $('#example').DataTable();
                 $('#example tbody').on( 'click', 'tr', function () {
                    blockme();
                    $(this).toggleClass('selected');
                     $(this).addClass('bg_selected');
                     var ids = $.map(table.rows('.selected').data(), function (item) {
                        return item[0];
                    });
                       //alert(ids);
                    ViewProject(ids);
                } );
              });
     </script>
     <style>
        /**** Header and container CSS ****/
        .Oblix_Container{
            background-image : url("{!URLFOR($Resource.assetUI,'bg_pattern.png')}");
            background-repeat: no-repeat;
            position:relative;
            top: -11px;
        }
        
        .Oblix_header_title{
            font-size: 30px;
            margin: 4px;   
            padding-top: 7px;   
            position:relative;
            left: 30px;               
        }
        .Oblix_header_activeArrow{       
            background-image : url("{!URLFOR($Resource.assetUI,'currentlevel_arrow_down.png')}");
            background-repeat: no-repeat;
            color:white;
        }
        .Oblix_header_activeArrow span{ 
             font-size: 20px !important;
             left: 18px !important;
         }
        .Oblix_header{
            background-image : url("{!URLFOR($Resource.assetUI,'header_panel.png')}");
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            height:100px;
            position: relative;
            line-height: 65%;
            width:95%;
            letter-spacing: 1px;         
        }
        .Oblix_header span{
            line-height: 140%;
            position:relative;
            left: 39px;
            font-size: 10px;
        }
        .Oblix_header td{
             font-family: Georgia, "DejaVu Serif", Norasi, serif;
        }
        /**** Content CSS ****/
        .Oblix_sowDetail{
            display: block;
            padding: 9.5px;
            margin: 0 58px 23px;
            line-height: 1.42857143;
            color: #333;
            word-break: break-all;
            word-wrap: break-word;
            background-color: rgb(202, 212, 190);
            border: 1px solid #D6D6D6;
            border-radius: 4px;
            font-family: 'Source Sans Pro', 'Helvetica Neue', Helvetica, Arial, sans-serif !important;
        }
        .bg_selected{
            background-color:#00573F !important;
        }
        table tr th h1{
            font-size: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        #tabs-centre h1{
            font-size: 18px;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: transparent !important;
            padding-left: 26px;
            top: 22px;
            position: relative;
         }
        .topAlign tr{
            vertical-align: top;
        }
        .Oblix_sowDashboard{
            height:300px;
        }
        .Oblix_tableDetails tr h1{
            font-size:16px;
        }
        .search_init{
            transition: all .2s linear;
            background: #fff;
            padding: 5px 9px;
            margin: 0;
            border-radius: 4px;
            width: 100%;
            font-size: 13px;
            height: 32px;
        }        
        .Oblix_attachment{
            width:85%;
        }
        .column1,.column2 {
            width: 49%; 
            float: left;
        }
        .column3{
            width: 100%; 
            float: left;
        }   
        .column5{
            width: 40%; 
            float: left;
            vertical-align:center;
        }
        .column4{
            width: 55%; 
            float: left;
        }
        .column4 h1{
             font-size:17px;
        }
        .Oblix_Dash{
                display:{!if(seriesProject == '' || seriesProject == '[]','none','block')};
                padding: 9.5px;
                margin: 0 58px 23px;
                font-size: 13px;
                line-height: 1.42857143;
                color: #333;
                word-break: break-all;
                word-wrap: break-word;
                background-color: #f5f5f5;
                border: 1px solid #ccc;
                border-radius: 4px;
        }
        .topAlign tr{
            vertical-align: top;
        }
         .Oblix_table{
                display:block;
                padding: 9.5px;
                margin: 0 58px 23px;
                font-size: 13px;
                line-height: 1.42857143;
                color: #333;
                word-break: break-all;
                word-wrap: break-word;
                background-color: #f5f5f5;
                border: 1px solid #ccc;
                border-radius: 4px;
        }
  
        /**** Button CSS ****/
         .Oblix_large_btn{
            border-style:none;
            width: 160px;
            height: 30px;
            background-position: 0 0;
            border : 1px solid rgb(158, 145, 145);
          }       
        .Oblix_large_btn:hover{
           border-style:none;
            border : 1px solid rgb(223, 213, 213);
            background-position: 0 0;
        }
        .Oblix_large_btn:active{
            border-style:none;
            border : 1px solid rgb(223, 213, 213);
            background-position: 0 0;
        }
         .Oblix_btn{
            border-style:none;
            width: 80px;
            height: 30px;
            background-position: 0 0;
            border : 1px solid rgb(158, 145, 145);
        }
        
        .Oblix_btn:hover{
            border-style:none;
            border : 1px solid rgb(223, 213, 213);
            background-position: 0 0;
        }
        .Oblix_btn:active{
            border-style:none;
            border : 1px solid rgb(223, 213, 213);
            background-position: 0 0;
        }
        .Oblix_notes{
            PADDING-right: 41px;
        }
        .Oblix_attachment{
            width:85%;
        }
       .Oblix_filter_btn{
           color: #333;
            background: #fff !important;
            border: 1px solid #b5b5b5 !important;
            display: inline-block;
            padding: 4px 12px !important;
            width:100px;
            margin-bottom: 0;
            font-weight: normal;
            line-height: 1.42857143;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            -ms-touch-action: manipulation;
            touch-action: manipulation;
            cursor: pointer;
            -webkit-user-select: none;
        }
       
       .Oblix_filter_btn:hover, .Oblix_filter_btn:active{
           background: #eaeaea !important;
           border: 1px solid #b5b5b5 !important;
       }
       .Oblix_projects_btn{
            color: #333;
            background: #fff !important;
            border: 1px solid #b5b5b5 !important;
            display: inline-block;
            padding: 4px 12px !important;
            width:200px;
            margin-bottom: 0;
            font-weight: normal;
            line-height: 1.42857143;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            -ms-touch-action: manipulation;
            touch-action: manipulation;
            cursor: pointer;
            -webkit-user-select: none;
         }    
       /**** ui tooltip CSS ****/
       .ui-tooltip, .arrow:after {
        background: black;
        border: 2px solid white;
      }
      .ui-tooltip {
        padding: 10px;
        color: white;
        width:150px;
        border-radius: 2px;
        border-color:black;
        font-size:12px;
        box-shadow: 0 0 2px black;
        text-align:center;
      }
      .arrow {
        width: 70px;
        height: 16px;
        overflow: hidden;
        position: absolute;
        left: 50%;
        border-color:black;
        margin-left: -35px;
        bottom: -16px;
      }
      .arrow.top {
        top: -16px;
        bottom: auto;
      }
      .arrow.left {
        left: 20%;
      }
      .arrow:after {
        content: "";
        position: absolute;
        left: 20px;
        top: -20px;
        width: 25px;
        height: 25px;
        border-color:black;
        box-shadow: 6px 5px 9px -9px black;
        -webkit-transform: rotate(45deg);
        -ms-transform: rotate(45deg);
        transform: rotate(45deg);
      }
      .arrow.top:after {
        bottom: -20px;
        top: auto;
      }

    /* for 900px or less */
    @media screen and (max-width: 1200px) {
     
        .column1,.column2,.column3,.column4,.column5{
            width: 100%;
        }
    }
    /* Toggle Chart/Table CSS */
     .ui-widget-header {
        border: 0px;
        background: #E8E8E8;
    }
    
    .ui-widget-content {
        border: 0px;
    }
   
    .ui-tabs .ui-tabs-panel {
        display: block;
        border-width: 0;
        padding: 1em 1.4em;
        background: #E8E8E8;
        cursor: pointer;
    }
    .ui-tabs {
       padding:0em;
    } 
    .ui-tabs .ui-tabs-nav li {
        border-bottom-width: 1px;
    }  
    textarea,select,input {
        vertical-align: top;
    }
    .ui-widget-content{
        background: none;
    }    
    #tabs-centre .ui-tabs-nav { 
        height: 2.35em; 
        text-align: center; 
    } 
    #tabs-centre .ui-tabs-nav li { 
        display: inline-block; 
        float: none; 
        top: 0px; 
        margin: 0em; 
        padding-bottom: 0px; 
    }
    #tabs-centre .ui-widget-header {
        background: whitesmoke!important;
    }
     #tabs-centre .ui-tabs-panel {    
        background: whitesmoke!important;
    }
    #tabs-centre .ui-corner-all, .ui-corner-top, .ui-corner-right, .ui-corner-tr,.ui-corner-all,.ui-corner-top,.ui-corner-left,.ui-corner-tl{
        border-top-left-radius :0 !important;
        border-top-right-radius :0 !important;
    }

    </style>
    <script>
    function Popup(){
             $("#dialog").dialog({
             width: 600,
             modal:true,
             close: function(event,ui){
                 $("pop").dialog('destroy');          
                    }
             }); 
            
     }
     
     $(function() {
        $( "#tabs-centre" ).tabs();
     });

       blockme();
   </script>
    <div class="Oblix_Container">
    <div id="dialog" title="Attachment list" style="display:none">   
      <apex:pageBlock >
       <apex:pageBlockTable value="{!lstAttachements}" var="attach">
           <apex:column headerValue="Name">
               
               <apex:outputLink value="{!attach.Id}">{!attach.Name}</apex:outputLink>
           </apex:column>
            <apex:column headerValue="Parent Name">
                 <apex:outputField value="{!attach.Parent.Name}"/>
           </apex:column>
       </apex:pageBlockTable>
     </apex:pageBlock>
   </div>


   <!-- </div> -->
    <center>
    <div class="Oblix_header">
        <apex:form >
            <apex:actionFunction name="ViewProject" action="{!ViewProject}" reRender="jqueryId" oncomplete="$.unblockUI()"><!--  -->
                 <apex:param name="selectedProjectId" assignTo="{!selectedProjectId}" value=""/>
             </apex:actionFunction>
         </apex:form>
         <table width="90%" height="90%">
            <tr>
                <td width="5%">
                <apex:image value="{!$Resource.Unilever_logo}" width="60px" height="60px" />
                </td>
                <td width="15%">
                <div class="Oblix_header_title">SWOP</div><br/><span>Scope of Work<br/>Online Planner</span>
                </td>
                <td width="20%" class="Oblix_header_activeArrow">
                <span><apex:outputPanel rendered="{!sowId == null}" > Create SOW <br/></apex:outputPanel>
                <apex:outputPanel rendered="{!sowId != null}" > View SOW <br/></apex:outputPanel></span>
                </td>
                <td width="15%">
                <div></div><br/>
                </td>
                <td></td>
                <td>
                <div style="float:right"><p>Hi {!userConnected.Name} !</p></div>
                </td>
            </tr>
        </table>
       
    </div>
    </center>
    <br/><br/>
    <div class="Oblix_sowDetail">
       <apex:outputPanel rendered="{!sowId != null}" Id="sowDetailId">
            <table cellspacing="20px">
            <tr>
            <td width="40%">
           <section class="column1">
              <table width="100%" class="Oblix_tableDetails topAlign ">
                 <tr>
                      <td width="50%"><strong>SOW Name</strong></td>
                      <td>{!selSow.Name}</td>
                 </tr>
                 <tr><td colspan="2">&nbsp;</td></tr>   
                 <tr>
                     <td><strong>BD/BD</strong></td>
                     <td>{!selSow.BB_or_BD__c}</td>
                 </tr>   
                 <tr><td colspan="2">&nbsp;</td></tr>   
                 <tr>
                     <td><strong>Brand</strong></td>
                     <td>{!selSow.OblixBrand__r.Name}</td>
                 </tr>
                 <tr><td colspan="2">&nbsp;</td></tr>   
                 <tr>
                     <td><strong>Big Category</strong></td>
                     <td>{!selSow.BigOblixProductCategory__r.name}</td>
                 </tr>
                 <tr><td colspan="2">&nbsp;</td></tr>   
                 <tr>
                     <td><strong>Small Category</strong></td>
                     <td>{!selSow.SmallProductCategory__r.name}</td>
                 </tr>
               </table>
           </section>
           
           <section class="column2">
               <table width="100%" class="topAlign "> 
                   <tr>    
                      <td width="50%"><strong>Agency Contact</strong></td>
                      <td>{!selSow.Agency_Contact__r.name}</td>
                   </tr>
                   <tr><td colspan="2">&nbsp;</td></tr>   
                   <tr>
                      <td><strong>Unilever Contact</strong></td>
                      <td>{!selSow.Unilever_Lead__r.name}</td>
                   </tr>
                   <tr><td colspan="2">&nbsp;</td></tr>   
                   <tr>
                     <td><strong>FY 2015</strong></td>
                     <td>{!selSow.Financial_Year__c}</td>
                   </tr>
                   <tr><td colspan="2">&nbsp;</td></tr>   
                   <tr>
                     <td><strong>Lastest</strong></td>
                     <td>.........$ </td>
                   </tr>
                   <tr>
                     <td><strong>Approuved</strong></td>
                     <td>.........$ </td>
                   </tr>
               </table>
           </section> 
           </td>
           <td width="20%">
           <section class="column3">   
              <strong>Notes</strong><br/>
              <p class="Oblix_notes">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. 
              
              </p> 
              <br/>          
               <apex:form >
                  <c:DragDrop_Attachment parentId="{!selSow.id}" DragDropHeight="30px" />                 
               <br/>
                <apex:commandButton value="View {!lstAttachements.size} Attachments" title="View list of Attachment " onclick="Popup();return false" styleClass="Oblix_large_btn Oblix_attachment" rendered="{!lstAttachements.size<>0}"/> 
               </apex:form>
           </section>
           </td>
           <td>
           <section class="column4">
               <table width="100%" class="topAlign">  
                   <tr> 
                      <td width="50%" colspan="2"><span style="text-decoration: underline;">Updated</span> &nbsp;<apex:outputText value="{0,date,MM'/'dd'/'yyyy}"><apex:param value="{!selSow.LastModifiedDate}" /></apex:outputText><br/> by {!selSow.LastModifiedBy.Name}</td>
                   </tr>
                   <tr><td colspan="2">&nbsp;</td></tr>         
                   <tr><td colspan="2">&nbsp;</td></tr>    
                   <tr><td colspan="2">&nbsp;</td></tr>    
                   <tr>
                       <td colspan = "2"><h1><center><br/>{!selSow.SOW_Status__c}</center></h1></td>
                   </tr>
              </table>
          </section>
         
          <section class="column5">
             <center>
                 <apex:form >
                     <apex:commandButton value="Back To Dashboard" title="View Campaign details"  action="{!backAction}" styleClass="Oblix_large_btn Oblix_view_btn"/><br/>
                     <apex:commandButton value="Share" onclick="" title="Share SOW with others"  styleClass="Oblix_large_btn"/><br/>
                     <apex:commandButton value="Export" onclick="" title="View PDF format"  styleClass="Oblix_btn"/><apex:commandButton value="Reporting" onclick="" title="View PDF format"  styleClass="Oblix_btn"/><br/>
                     <apex:commandButton value="Approve" title="Change status"  onclick="" styleClass="Oblix_large_btn"/>
                 </apex:form>
             </center>  
          </section>   
          </td>
          </tr>
          </table>
       </apex:outputPanel>
       <apex:form >
       <apex:outputPanel rendered="{!sowId == null}" id="sowNewId">
            <table cellspacing="20px">
            <tr>
            <td width="55%">
            <section class="column1">
              
               <table width="100%" class="Oblix_tableDetails">
                 <tr>
                      <td width="50%"><strong>SOW Name</strong></td>
                      <td><apex:inputField value="{!selSow.Name}" required="true"/></td>
                 </tr>
                 <tr>
                     <td><strong>BD/BD</strong></td>
                     <td><apex:inputField value="{!selSow.BB_or_BD__c}" required="true"/></td>
                 </tr>   
                 <tr>
                     <td><strong>Brand</strong></td>
                     <td><apex:inputField value="{!selSow.OblixBrand__r.Name}"/></td>
                 </tr>
                 <tr>
                     <td><strong>Big Category</strong></td>
                     <td><apex:inputField value="{!selSow.BigOblixProductCategory__r.name}"/></td>
                 </tr>
                 <tr>
                     <td><strong>Small Category</strong></td>
                     <td><apex:inputField value="{!selSow.SmallProductCategory__r.name}"/></td>
                 </tr>
               </table>
             
           </section>
           
           <section class="column2">
               <table width="100%"> 
                   <tr>    
                      <td width="50%" colspan="2"><strong>Agency Contact</strong><apex:inputField value="{!selSow.Agency_Contact__c}"/></td>
                   </tr>
                   <tr>
                      <td colspan="2"><strong>Unilever Contact </strong><apex:inputField value="{!selSow.Unilever_Lead__c}"/></td>
                   </tr>
                   <tr>
                     <td><strong>FY </strong></td>
                     <td><apex:inputField value="{!selSow.Financial_Year__c}"/></td>
                   </tr>
                   <tr>
                     <td><strong>Currency</strong></td>
                     <td><apex:inputField value="{!selSow.Currency__c}"/></td>
                   </tr>
                   <tr>
                   </tr>
               </table>
           </section> 
           </td>
           <td width="20%">
           <section class="column3">   
              <strong>Notes</strong><br/>
              <p class="Oblix_notes">
                  Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                  Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.               
              </p>               
               <apex:commandButton value="Add Attachments" title="Add Attachments to this SOW " styleClass="Oblix_large_btn Oblix_attachment"/>  
           </section>
           </td>
           <td>
           <section class="column4">
               <table width="100%" >  
                   <tr> 
                      <td><strong>Created today by </strong> <br/>{!userConnected.Name}</td>
                   </tr>
                   
                    <tr>
                     <td><strong><br/>Current</strong></td>
                   </tr>
                   <tr>
                       <td><h1><center><br/>Unsaved</center></h1></td>
                   </tr>
              </table>
          </section>
         
          <section class="column5">
             <center>
                 
                     <apex:commandButton value="Back" action="{!backAction}" title="Back to Sow" styleClass="Oblix_large_btn"/><br/>
                     <apex:commandButton value="Share" onclick="" title="Share SOW with others"  styleClass="Oblix_large_btn"/><br/>
                     <apex:commandButton value="Save"   action="{!SaveSOW}"  title="Save Sow"  styleClass="Oblix_large_btn"/><br/>
                     <apex:commandButton value="Submit" title="Return"  onclick="" styleClass="Oblix_large_btn"/>
                 
             </center>  
          </section>   
          </td>
          </tr>
          </table>
          
       </apex:outputPanel>
     </apex:form>
     
     </div><!-- SowDetail -->
     <!-- Chatter Feed -->
         <apex:outputPanel rendered="{!IF(sowId == null, false, true)}" id="sowFeed">
          <div class="Oblix_table padding_remove">
             <div class="Oblix_projects_container">  
                <table width="100%">
                <tbody>   
                 <tr class="Oblix_projects_header">
                    <th>
                        <table width="100%">
                            <tr>
                                <td width="20%" class="Oblix_title_H1">
                                    Chatter Feed for {!selSow.Name}
                                </td>
                                <td>
                                </td>
                                <td width="10%">
                                   
                                </td>
                                <td width="6%" class="Oblix_icon">
                                    {!countOfUpdatesFeed} Updates &nbsp;
                                    <i class="fa fa-2x fa-sort-desc"></i>
                                </td>
                            </tr>
                        </table>
                    </th>   
                </tr>
                <tr>
                       <td width="100%">
                           <chatter:feedWithFollowers entityId="{!sowID}"/>
                       </td>
                       
                </tr>
                </tbody>
                </table>
            </div>
         </div>
     </apex:outputPanel>
 
    <div class="Oblix_table" id="Oblix_DashId">
          
         <apex:outputPanel id="projectButtonId">
                <table width="100%" class="Oblix_TableTitle">
                    <tr>
                        <td width="20%">
                            
                        </td>
                        <td>
                        </td>
                        
                        <td  width="15%">
                            <apex:form >
                                <apex:commandButton value="Add Campaign" title="Add Campaign"  action="{!AddProject}" styleClass="Oblix_projects_btn" disabled="{!IF(sowId == null, true, false)}"/><br/>
                            </apex:form>
                        </td>
                        <td  width="15%">
                            <apex:form >
                                <apex:commandButton value="Add Non Campaign" title="Add Non Campaign items" action="{!Null}" styleClass="Oblix_projects_btn" disabled="{!IF(sowId == null, true, false)}"/><br/>
                            </apex:form>
                        </td>
                    </tr>
                </table>
         </apex:outputPanel>
         
        <apex:outputPanel rendered="{!thousandBlocks.size<>0}" id="lstProj">
            <div id="tabs-centre">
                   <h1>All SOW Items</h1>
               <ul>
                  
                <li><a href="#tabs-centre-1">View as list</a></li>
                <li><a href="#tabs-centre-2">View Campaign TimeLine</a></li>
              </ul>
              <div id="tabs-centre-1">
                <table cellpadding="0" cellspacing="0" border="0" class="display" id="example">
                 <thead>
                  <tr>
                    <th style="display:none;width:0px !important">Project Id</th>
                    <th>Name </th>
                    <th>Type</th>
                    <th>Regions</th>
                    <th>Platform</th>
                    <th>Stage</th>
                    <th>Status</th>
                    <th>Current</th>                   
                  </tr>
                </thead>
                <tbody>
                   <apex:repeat value="{!thousandBlocks}" var="block">
                    <apex:repeat value="{!block.lstProjects}" var="projOtherItem">
                        <apex:outputPanel rendered="{!projOtherItem.objName == 'Campaign'}">
                             <tr class="odd gradeX Oblix_view_btn">
                                <td style="display:none;width:0px !important">{!projOtherItem.objectDyn['Id']}</td>
                                <td>{!projOtherItem.objectDyn['Name']}</td>
                                <td>{!projOtherItem.objName}</td>
                                <td>{!projOtherItem.objectDyn['OblixRegion__c']}</td>
                                <td>{!projOtherItem.objectDyn['Platform__c']}</td>
                                <td>{!projOtherItem.objectDyn['Project_Stage__c']}</td>
                                <td></td>
                                <td></td>
                            </tr>
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!projOtherItem.objName == 'Non Campaign'}">
                             <tr class="odd gradeX Oblix_view_btn">
                                <td style="display:none;width:0px !important">{!projOtherItem.objectDyn['Id']}</td>
                                <td>{!projOtherItem.objectDyn['Name']}</td>
                                <td>{!projOtherItem.objName}</td>
                               <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td>{!projOtherItem.objectDyn['OblixOtherItemFee__c']}</td>                              
                            </tr>
                        </apex:outputPanel>
                    </apex:repeat>
                  </apex:repeat>  
                </tbody>                
              </table>  
              </div>
              <div id="tabs-centre-2">
                    <div id="lease-gantt-chart" style="margin: 0 58px 23px; width:90%"></div>
              </div>            
            </div>          
     </apex:outputPanel>
     </div> 

</div><!--  End Container 
</apex:form>-->
 <script>   
     
    (function () {
          
    var leaseData = {!seriesProject};

    // create new set of data structure for rendering chart

    var groupUnitData = _.groupBy(leaseData, 'unitName');
    var uniqueUnitNames = _.sortBy(_.keys(groupUnitData), function (name) {
        return name;
    });
    console.log(JSON.stringify(groupUnitData, null, 4));


    var getLeaseIntervals = function (unitLeases, unitName) {
        // Find highest rent for the unit
        var highestRent = _.max(unitLeases, function (unitLease) {
            return unitLease.rent;
        })['rent'];

        // Get all the intervals for the unit
        var leaseIntervals = [];
        
        $.each(unitLeases, function (i, unitLeaseVal) {
            
            leaseIntervals.push({
                    x: unitLeaseVal.beginTimestamp,
                    y: _.indexOf(uniqueUnitNames, unitName),
                    start: unitLeaseVal.beginTimestamp,
                    end: unitLeaseVal.endTimestamp,
                    name:"Project Start date "
                },{
                    x:unitLeaseVal.endTimestamp,
                    y:_.indexOf(uniqueUnitNames, unitName),
                    start:unitLeaseVal.beginTimestamp,
                    end:unitLeaseVal.endTimestamp,
                    name:"Project Finish date "
                },{
                    x: unitLeaseVal.x1Timestamp,
                    y: _.indexOf(uniqueUnitNames, unitName),
                    start: unitLeaseVal.beginTimestamp,
                    end: unitLeaseVal.endTimestamp,
                    name:"Project Completion date "
                },{
                    x:unitLeaseVal.x2Timestamp,
                    y:_.indexOf(uniqueUnitNames, unitName),
                    start:unitLeaseVal.beginTimestamp,
                    end:unitLeaseVal.endTimestamp,
                    name:"First Air date "
                },{
                    x:unitLeaseVal.x3Timestamp,
                    y:_.indexOf(uniqueUnitNames, unitName),
                    start:unitLeaseVal.beginTimestamp,
                    end:unitLeaseVal.endTimestamp,
                    name:"Production Completion date "
                }
                );
            if (unitLeases[i + 1]) {
                leaseIntervals.push(
                    [(unitLeaseVal.endTimestamp + unitLeases[i + 1].beginTimestamp)/2 , null]
                )
            }
        });

        return leaseIntervals;

    };

    var leaseRent = _.map(groupUnitData, function (unitLeases, unitName) {
        var lease = getLeaseIntervals(
            _.sortBy(unitLeases, function (obj) {
                return obj.beginTimestamp;
            }),
            unitName
        );

        return {
            name:unitName,
            data:lease
        };

    });
    //Sort the data, otherwise Highchart will complain error15
    var series = _.sortBy(leaseRent, function (obj) {
        return obj.name;
    });

    console.log(series);
    //Render Gantt Chart
    var chart = new Highcharts.Chart({
        chart:{
            renderTo:'lease-gantt-chart',
            backgroundColor: null
        },
        title:{
            text:''
        },
        xAxis:{
            type:'datetime'
        },
        yAxis:{
            tickInterval:1,
            startOnTick:true,
            endOnTick:false,
            labels:{
                // apartment names
                formatter:function () {
                    if (series[this.value]) {
                        return uniqueUnitNames[this.value];
                    }
                }
            },

            title:{
                text:"Projects"
            },
            minPadding:0.2,
            maxPadding:0.2

        },
        credits: {
                  enabled: false
            },
       
        legend:{
            enabled:false
        },
        tooltip:{
            formatter:function () {
               
                return '<b>' + uniqueUnitNames[this.y] + ' : </b> <br/>'
                     +this.point.options.name +'<br/>'
                     +Highcharts.dateFormat('%e, %b %Y', this.point.options.x);
            }
        },
        plotOptions:{
            line:{
                lineWidth:5,
                 marker : {
                    enabled : true,
                    symbol: 'url(http://www.highcharts.com/demo/gfx/sun.png)',
                    width: 20,
                    height: 20
                }
               
            },
        },
        series:series,
        exporting: {
            buttons: {
                contextButton: {
                        menuItems: [{
                            textKey: 'downloadPNG',
                            onclick: function () {
                                this.exportChart();
                            }
                        }, {
                            textKey: 'downloadJPEG',
                            onclick: function () {
                                this.exportChart({
                                    type: 'image/jpeg'
                                });
                            }
                        }]
                }
            }
        }
    });

})();

</script>
      

</apex:page>