<apex:page controller="Amr_JobSheetController" sidebar="false" id="pageId" >
    <apex:form >
        <div class="subcontainer">
            <div class="filter_section width30">
                <div class="filters width20">
                    <div id = "newDiv" style="display:{!IF(permissionSetName != 'CAP' , 'None', '')}">
                        <div class="filter_section">
                            <h4>Allocation
                            <!--  <span><img src="/resource/1451457838000/Ad_Manager/Ad-Manager/images/Subtract.png" class="addlicon" data-id="allocation-id" alt="number"/></span>-->
                            <div class="minusclass commonall" data-id="allocation-id">                                      
                            </div>
                            </h4>
                        </div>
                        <div class="box_content filteralert jobsallocation allocation-id">
                            <div class="subbox" style="height:64px;">
                                <div class="subbox-first" style="float: left;margin-top: 23px;width: 370px;" >
                                    <span style=" font-size: 15px;margin-right: 8px;margin-top: 10px;">
                                    Allocate this job to
                                    </span>
                                    <apex:selectList label="Select the user Name"  size="1" value="{!selectedRAPUser}">
                                        <apex:selectOptions value="{!selectUsername}"></apex:selectOptions>
                                    </apex:selectList>
                                </div>
                                <div class="subbox-second" style="float:left;margin-top:16px;font-size: 15px;">
                                    <apex:commandButton styleClass="allocationbtn btn1 accepted" value="Allocate" action="{!Reallocate}"  reRender="msgs"/>
                                </div>
                                <div class="subbox-third" style="float:left;margin-top:17px; margin-left:16px;">
                                    <!--  
                                        <span class="canceltxt">
                                            <apex:commandLink value="Cancel this job" action="{!cancelJob}" reRender="msgs" />
                                        </span>
                                        -->
                                    <apex:commandButton value="Cancel" action="{!cancelJob}" reRender="msgs" styleClass="btn allocationbtn btn1 acceptedLike decline" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="rapDivNew" style="display:{!IF(permissionSetName != 'RAP' , 'None', '')}">
                        <div class="filter_section">
                            <h4>Allocation
                            <!--  
                            <span><img src="/resource/1451457838000/Ad_Manager/Ad-Manager/images/Subtract.png" class="addlicon" alt="number" data-id="allocation-id" /></span>
                            -->
                            <div class="minusclass commonall" data-id="allocation-id">                                      
                            </div>                            
                            </h4>
                        </div>
                        <div class="allocation-id">
                        <div class="jobsallocation">
                            <h3>
                                <span style="display:{!IF(jobStatus == 'Accepted' , 'None', '')}">You have a  new job {!addManagerNumber} allocated to you. </span>
                                <span style="display:{!IF(jobStatus != 'Accepted' , 'None', '')}">{!addManagerNumber}</span>
                                <span class="rightimg">
                                    <span  style="display:{!IF( jobCancelled  , 'None', '')}">
                                        <apex:commandButton styleClass="btn allocationbtn btn1 acceptedLike decline" value="Cancel" action="{!cancelRapJob}" />
                                    </span>
                                    <span style="display:{!IF(jobStatus == 'Accepted' || jobCancelled  , 'None', '')}">
                                        <apex:commandButton style="margin-right: 12px;padding: 6px 24px 5px;" styleClass="allocationbtn btn1 accepted" value="Accept" action="{!acceptJob}" />
                                    </span>
                                </span>
                                <span>
                                </span>
                            </h3>
                            <div class="clear"></div>
                        </div>
                        <div class="formgroup" >
                            <div class="form-field" style="display:{!IF(!primaryRap , 'None', '')}">
                                <label>
                                Re-allocate
                                </label>
                                <apex:selectList label="Select the user Name"  size="1" value="{!selectedRapName}" >
                                    <apex:selectOptions value="{!selectUsername}"></apex:selectOptions>
                                </apex:selectList>
                                <span style="margin-left:10px">
                                    <apex:commandButton styleClass="allocationbtn btn1 acceptedLike decline" action="{!reAllocateRAP}" value="Re-allocate" style="float:none;width:115px"/>
                                </span>
                                <!-- <button type="button" class="btn Reallocate">Re allocate</button> -->
                            </div>
         
                            <div class="form-field">
                                <label>
                                Set status </label>                         
                                <apex:inputField value="{!jobList.Job_Status__c}"/>
                                <span style="margin-left:10px">
                                    <apex:commandButton styleClass="allocationbtn btn1 acceptedLike decline" action="{!changePriority}" value="Apply" style="float:none;width:115px"/>
                                </span>
                            </div>
                        </div>
                        <apex:outputPanel id="jobunshare">
                        <div class="formgroup">
                            <div class="form-field" style="display:{!IF(jobStatus != 'Accepted' , 'None', '')}">
                                <label>
                                Share this job with
                                </label>
                                <apex:selectList id="sel12" value="{!listOfRAPSelected}" multiselect="true" style="width:197px" size="4">
                                    <apex:selectOptions value="{!selectusername}"/>
                                </apex:selectList>
                                &nbsp;                                                      
                                <span style="margin-left:10px">
                                    <apex:commandButton action="{!recordShare}" value="Share" styleClass="allocationbtn btn1 acceptedLike decline"  reRender="msgs,jobunshare" style="float:none;width:115px"/>
                                </span>
                            </div>
                        </div>
                       <div class="formgroup">
                          <div class="form-field" style="display:{!if( jobStatus != 'Accepted', 'None', if(sharedListSize  == 0,'none', '') )}">
                                <label>
                                Shared With
                                </label>
                                 
                 <!--               <apex:selectList label="Select the user Name"  size="2" value="{!selectedUnshareRapName}" multiselect="true">
                                    <apex:selectOptions value="{!sharedRapOption}"></apex:selectOptions>
                                </apex:selectList> <br/> -->
                                
                                
                                
                                  <div style="width:530px">  
                                    <apex:repeat value="{!jobSharedList}" var="jbList">
                                         
                                        <div style="background-color:silver;font-size:15px; width:120px;height:27px;margin-left: 10px; margin-top: 10px;float:left;position:relative;">
                                            <apex:outputLabel value="{!jbList.User__r.Name}" />
                                            
                                            <span class="unshare">
                                                <img src="{!URLFOR($Resource.Ad_Manager,'Ad-Manager/images/close.png')}"  alt="number" style="height:25px;width:25px;position:absolute;top:0;right:0;" />
                                                <input type="hidden" value = "{!jbList.User__c}" />
                                            </span> 
                                        </div>
                                    </apex:repeat>
                                   </div>
                                    <br/>
                            <!--
                            
                                <span style="margin-left:10px">
                                    <apex:commandButton styleClass="allocationbtn btn1 acceptedLike decline" action="{!jobUnShare}" value="Un Share" style="float:none;width:115px" />
                                </span>
                               -->
                                <!-- <button type="button" class="btn Reallocate">Re allocate</button> -->
                            </div>
                          </div>
                          </apex:outputPanel>
                        <div class="rapsubDivNew" style="background:#fff;display:none;">
                            <apex:outputPanel >
                                <apex:outputLabel value="Cancel" style="font-weight:bold;" />
                                <br/><br/><br/><br/><br/><br/>
                                <apex:commandButton value="Submit" action="{!cancelRapJob}"  styleClass="allocationbtn" reRender="msgs"/>
                            </apex:outputPanel>
                            <!--     <apex:outputPanel >
                                <apex:outputLabel value="Re - Allocate" style="font-weight:bold;"/>
                                <br/><br/>
                                <apex:selectList label="Select the user Name"  size="1" value="{!selectedRapName}" >
                                    <apex:selectOptions value="{!selectUsername}"></apex:selectOptions>
                                </apex:selectList>
                                <br/>
                                <apex:commandButton value="Re Allocate" styleClass="allocationbtn" action="{!reallocateRAP}" reRender="pgbt,msgs"/>
                                </apex:outputPanel>  -->
                            <!--       <apex:outputPanel >
                                <apex:outputLabel value="Priority" style="font-weight:bold;"/>
                                <br/>
                                <apex:selectRadio layout="pageDirection" styleClass="radio_pick" value="{!priority}">
                                    <apex:selectOption itemLabel="Priority" itemValue="Priority"   />
                                    <apex:selectOption itemLabel="Pending" itemValue="Pending" />
                                    <apex:selectOption itemLabel="Live" itemValue="Live" />
                                    <apex:selectOption itemLabel="Dormant" itemValue="Dormant" />
                                </apex:selectRadio>
                                <apex:commandButton value="Submit" styleClass="allocationbtn" action="{!changePriority}"/>
                                </apex:outputPanel> -->
                            <div>
                                <!-- display:{!IF(jobStatus != 'Accepted' , 'None', '')} -->
                                <!--      <apex:outputPanel >
                                    <apex:outputLabel value="Record Share" style="font-weight:bold;"/>
                                    <br/>
                                    <apex:selectList id="sel1" value="{!listOfRAPSelected}" multiselect="true" style="width:150px" size="1">
                                        <apex:selectOptions value="{!Selectusername}"/>
                                    </apex:selectList>
                                    <br/>
                                    <apex:commandButton action="{!recordShare}" value="Share" styleClass="allocationbtn"  reRender="msgs" />
                                    </apex:outputPanel>  -->
                            </div>
                        </div>
                        </div>
                    </div>
                    <!--  
                        <div id="rapDiv" style="display:{!IF(permissionSetName != 'RAP' , 'None', '')}">
                            <apex:pageBlock >
                                <table class = "alloc_table" width = "100%" style="text-align:center">
                                    <tr>
                                        <td style="display:{!IF(jobStatus == 'Accepted' , 'None', '')}">
                                            <apex:outputPanel >
                                                <apex:outputLabel value="Accept" style="font-weight:bold;"/>
                                                <br/><br/><br/><br/><br/><br/>
                                                <apex:commandButton styleClass="allocationbtn" value="Accept" action="{!acceptJob}" />
                                            </apex:outputPanel>
                                        </td>
                                        <td>
                                            <apex:outputPanel >
                                                <apex:outputLabel value="Re - Allocate" style="font-weight:bold;"/>
                                                <br/><br/>
                                                <apex:selectList label="Select the user Name"  size="1" value="{!selectedRapName}" >
                                                    <apex:selectOptions value="{!selectUsername}"></apex:selectOptions>
                                                </apex:selectList>
                                                <br/>
                                                <apex:commandButton value="Re Allocate" styleClass="allocationbtn" action="{!reallocateRAP}" reRender="pgbt,msgs"/>
                                            </apex:outputPanel>
                                        </td>
                                        <td  style="display:{!IF(jobStatus != 'Accepted' , 'None', '')}">
                                            
                                            <apex:outputPanel >
                                                <apex:outputLabel value="Record Share" style="font-weight:bold;"/>
                                                <br/>
                                                <apex:selectList id="sel1" value="{!listOfRAPSelected}" multiselect="true" style="width:150px" size="1">
                                                    <apex:selectOptions value="{!Selectusername}"/>
                                                </apex:selectList>
                                                <br/>
                                                <apex:commandButton action="{!recordShare}" value="Share" styleClass="allocationbtn"  reRender="msgs" />
                                            </apex:outputPanel>
                                        </td>
                                        <td  style="display:{!IF(primaryRap != true , 'None', '')}">
                                            <apex:outputPanel >
                                                <apex:outputLabel value="Cancel" style="font-weight:bold;" />
                                                <br/><br/><br/><br/><br/><br/>
                                                <apex:commandButton value="Submit" action="{!cancelRapJob}"  styleClass="allocationbtn" reRender="msgs"/>
                                            </apex:outputPanel>
                                        </td>
                                        <td>
                                            <apex:outputPanel >
                                                <apex:outputLabel value="Priority" style="font-weight:bold;"/>
                                                <br/>
                                                <apex:selectRadio layout="pageDirection" styleClass="radio_pick" value="{!priority}">
                                                    <apex:selectOption itemLabel="Priority" itemValue="Priority"   />
                                                    <apex:selectOption itemLabel="Pending" itemValue="Pending" />
                                                    <apex:selectOption itemLabel="Live" itemValue="Live" />
                                                    <apex:selectOption itemLabel="Dormant" itemValue="Dormant" />
                                                </apex:selectRadio>
                                                <apex:commandButton value="Submit" styleClass="allocationbtn" action="{!changePriority}"/>
                                            </apex:outputPanel>
                                        </td>
                                    </tr>
                                </table>
                            </apex:pageBlock>
                        </div>
                        -->
                </div>
            </div>
        </div>
        <apex:actionFunction name="unshareRapJob" action="{!jobUnShare}" reRender="view">
            <apex:param id="aname" assignTo="{!selectedUnshareRapName }" name="selectedUnshareRapName " value="{!selectedUnshareRapName }" />
        </apex:actionFunction>
    </apex:form>
     <script src="//code.jquery.com/jquery-1.10.2.js"></script>
      <script>
        $j('.unshare').click( function() {
                         var id = $j(this).find('input').val();
                          alert('YOOOOO ->  ' + id);
                          $j(this).parent().hide();
           unshareRapJob(id);
                        
        });
      </script>
</apex:page>